!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var n={exports:{}};!function(e,n){(function(){var t=this,r=t._,i=Array.prototype,o=Object.prototype,a=Function.prototype,s=i.push,c=i.slice,u=o.toString,l=o.hasOwnProperty,f=Array.isArray,d=Object.keys,p=a.bind,h=Object.create,m=function(){},g=function(t){return t instanceof g?t:this instanceof g?void(this._wrapped=t):new g(t)};e.exports&&(n=e.exports=g),n._=g,g.VERSION="1.8.3";var v=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}},_=function(t,e,n){return null==t?g.identity:g.isFunction(t)?v(t,e,n):g.isObject(t)?g.matcher(t):g.property(t)};g.iteratee=function(t,e){return _(t,e,1/0)};var y=function(t,e){return function(n){var r=arguments,i=arguments.length;if(i<2||null==n)return n;for(var o=1;o<i;o++)for(var a=r[o],s=t(a),c=s.length,u=0;u<c;u++){var l=s[u];e&&void 0!==n[l]||(n[l]=a[l])}return n}},w=function(t){if(!g.isObject(t))return{};if(h)return h(t);m.prototype=t;var e=new m;return m.prototype=null,e},b=function(t){return function(e){return null==e?void 0:e[t]}},S=Math.pow(2,53)-1,k=b("length"),x=function(t){var e=k(t);return"number"==typeof e&&e>=0&&e<=S};function I(t){function e(e,n,r,i,o,a){for(;o>=0&&o<a;o+=t){var s=i?i[o]:o;r=n(r,e[s],s,e)}return r}return function(n,r,i,o){r=v(r,o,4);var a=!x(n)&&g.keys(n),s=(a||n).length,c=t>0?0:s-1;return arguments.length<3&&(i=n[a?a[c]:c],c+=t),e(n,r,i,a,c,s)}}g.each=g.forEach=function(t,e,n){var r,i;if(e=v(e,n),x(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=g.keys(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}return t},g.map=g.collect=function(t,e,n){e=_(e,n);for(var r=!x(t)&&g.keys(t),i=(r||t).length,o=Array(i),a=0;a<i;a++){var s=r?r[a]:a;o[a]=e(t[s],s,t)}return o},g.reduce=g.foldl=g.inject=I(1),g.reduceRight=g.foldr=I(-1),g.find=g.detect=function(t,e,n){var r;if(void 0!==(r=x(t)?g.findIndex(t,e,n):g.findKey(t,e,n))&&-1!==r)return t[r]},g.filter=g.select=function(t,e,n){var r=[];return e=_(e,n),g.each(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r},g.reject=function(t,e,n){return g.filter(t,g.negate(_(e)),n)},g.every=g.all=function(t,e,n){e=_(e,n);for(var r=!x(t)&&g.keys(t),i=(r||t).length,o=0;o<i;o++){var a=r?r[o]:o;if(!e(t[a],a,t))return!1}return!0},g.some=g.any=function(t,e,n){e=_(e,n);for(var r=!x(t)&&g.keys(t),i=(r||t).length,o=0;o<i;o++){var a=r?r[o]:o;if(e(t[a],a,t))return!0}return!1},g.contains=g.includes=g.include=function(t,e,n,r){return x(t)||(t=g.values(t)),("number"!=typeof n||r)&&(n=0),g.indexOf(t,e,n)>=0},g.invoke=function(t,e){var n=c.call(arguments,2),r=g.isFunction(e);return g.map(t,(function(t){var i=r?e:t[e];return null==i?i:i.apply(t,n)}))},g.pluck=function(t,e){return g.map(t,g.property(e))},g.where=function(t,e){return g.filter(t,g.matcher(e))},g.findWhere=function(t,e){return g.find(t,g.matcher(e))},g.max=function(t,e,n){var r,i,o=-1/0,a=-1/0;if(null==e&&null!=t)for(var s=0,c=(t=x(t)?t:g.values(t)).length;s<c;s++)(r=t[s])>o&&(o=r);else e=_(e,n),g.each(t,(function(t,n,r){((i=e(t,n,r))>a||i===-1/0&&o===-1/0)&&(o=t,a=i)}));return o},g.min=function(t,e,n){var r,i,o=1/0,a=1/0;if(null==e&&null!=t)for(var s=0,c=(t=x(t)?t:g.values(t)).length;s<c;s++)(r=t[s])<o&&(o=r);else e=_(e,n),g.each(t,(function(t,n,r){((i=e(t,n,r))<a||i===1/0&&o===1/0)&&(o=t,a=i)}));return o},g.shuffle=function(t){for(var e,n=x(t)?t:g.values(t),r=n.length,i=Array(r),o=0;o<r;o++)(e=g.random(0,o))!==o&&(i[o]=i[e]),i[e]=n[o];return i},g.sample=function(t,e,n){return null==e||n?(x(t)||(t=g.values(t)),t[g.random(t.length-1)]):g.shuffle(t).slice(0,Math.max(0,e))},g.sortBy=function(t,e,n){return e=_(e,n),g.pluck(g.map(t,(function(t,n,r){return{value:t,index:n,criteria:e(t,n,r)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")};var P=function(t){return function(e,n,r){var i={};return n=_(n,r),g.each(e,(function(r,o){var a=n(r,o,e);t(i,r,a)})),i}};g.groupBy=P((function(t,e,n){g.has(t,n)?t[n].push(e):t[n]=[e]})),g.indexBy=P((function(t,e,n){t[n]=e})),g.countBy=P((function(t,e,n){g.has(t,n)?t[n]++:t[n]=1})),g.toArray=function(t){return t?g.isArray(t)?c.call(t):x(t)?g.map(t,g.identity):g.values(t):[]},g.size=function(t){return null==t?0:x(t)?t.length:g.keys(t).length},g.partition=function(t,e,n){e=_(e,n);var r=[],i=[];return g.each(t,(function(t,n,o){(e(t,n,o)?r:i).push(t)})),[r,i]},g.first=g.head=g.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:g.initial(t,t.length-e)},g.initial=function(t,e,n){return c.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},g.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:g.rest(t,Math.max(0,t.length-e))},g.rest=g.tail=g.drop=function(t,e,n){return c.call(t,null==e||n?1:e)},g.compact=function(t){return g.filter(t,g.identity)};var E=function(t,e,n,r){for(var i=[],o=0,a=r||0,s=k(t);a<s;a++){var c=t[a];if(x(c)&&(g.isArray(c)||g.isArguments(c))){e||(c=E(c,e,n));var u=0,l=c.length;for(i.length+=l;u<l;)i[o++]=c[u++]}else n||(i[o++]=c)}return i};function C(t){return function(e,n,r){n=_(n,r);for(var i=k(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(n(e[o],o,e))return o;return-1}}function T(t,e,n){return function(r,i,o){var a=0,s=k(r);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(n&&o&&s)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=e(c.call(r,a,s),g.isNaN))>=0?o+a:-1;for(o=t>0?a:s-1;o>=0&&o<s;o+=t)if(r[o]===i)return o;return-1}}g.flatten=function(t,e){return E(t,e,!1)},g.without=function(t){return g.difference(t,c.call(arguments,1))},g.uniq=g.unique=function(t,e,n,r){g.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=_(n,r));for(var i=[],o=[],a=0,s=k(t);a<s;a++){var c=t[a],u=n?n(c,a,t):c;e?(a&&o===u||i.push(c),o=u):n?g.contains(o,u)||(o.push(u),i.push(c)):g.contains(i,c)||i.push(c)}return i},g.union=function(){return g.uniq(E(arguments,!0,!0))},g.intersection=function(t){for(var e=arguments,n=[],r=arguments.length,i=0,o=k(t);i<o;i++){var a=t[i];if(!g.contains(n,a)){for(var s=1;s<r&&g.contains(e[s],a);s++);s===r&&n.push(a)}}return n},g.difference=function(t){var e=E(arguments,!0,!0,1);return g.filter(t,(function(t){return!g.contains(e,t)}))},g.zip=function(){return g.unzip(arguments)},g.unzip=function(t){for(var e=t&&g.max(t,k).length||0,n=Array(e),r=0;r<e;r++)n[r]=g.pluck(t,r);return n},g.object=function(t,e){for(var n={},r=0,i=k(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},g.findIndex=C(1),g.findLastIndex=C(-1),g.sortedIndex=function(t,e,n,r){for(var i=(n=_(n,r,1))(e),o=0,a=k(t);o<a;){var s=Math.floor((o+a)/2);n(t[s])<i?o=s+1:a=s}return o},g.indexOf=T(1,g.findIndex,g.sortedIndex),g.lastIndexOf=T(-1,g.findLastIndex),g.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i};var R=function(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var o=w(t.prototype),a=t.apply(o,i);return g.isObject(a)?a:o};g.bind=function(t,e){if(p&&t.bind===p)return p.apply(t,c.call(arguments,1));if(!g.isFunction(t))throw new TypeError("Bind must be called on a function");var n=c.call(arguments,2),r=function(){return R(t,r,e,this,n.concat(c.call(arguments)))};return r},g.partial=function(t){var e=c.call(arguments,1),n=function(){for(var r=arguments,i=0,o=e.length,a=Array(o),s=0;s<o;s++)a[s]=e[s]===g?r[i++]:e[s];for(;i<arguments.length;)a.push(r[i++]);return R(t,n,this,this,a)};return n},g.bindAll=function(t){var e,n,r=arguments,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++)t[n=r[e]]=g.bind(t[n],t);return t},g.memoize=function(t,e){var n=function(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return g.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},g.delay=function(t,e){var n=c.call(arguments,2);return setTimeout((function(){return t.apply(null,n)}),e)},g.defer=g.partial(g.delay,g,1),g.throttle=function(t,e,n){var r,i,o,a=null,s=0;n||(n={});var c=function(){s=!1===n.leading?0:g.now(),a=null,o=t.apply(r,i),a||(r=i=null)};return function(){var u=g.now();s||!1!==n.leading||(s=u);var l=e-(u-s);return r=this,i=arguments,l<=0||l>e?(a&&(clearTimeout(a),a=null),s=u,o=t.apply(r,i),a||(r=i=null)):a||!1===n.trailing||(a=setTimeout(c,l)),o}},g.debounce=function(t,e,n){var r,i,o,a,s,c=function(){var u=g.now()-a;u<e&&u>=0?r=setTimeout(c,e-u):(r=null,n||(s=t.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,a=g.now();var u=n&&!r;return r||(r=setTimeout(c,e)),u&&(s=t.apply(o,i),o=i=null),s}},g.wrap=function(t,e){return g.partial(e,t)},g.negate=function(t){return function(){return!t.apply(this,arguments)}},g.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},g.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},g.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},g.once=g.partial(g.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function M(t,e){var n=F.length,r=t.constructor,i=g.isFunction(r)&&r.prototype||o,a="constructor";for(g.has(t,a)&&!g.contains(e,a)&&e.push(a);n--;)(a=F[n])in t&&t[a]!==i[a]&&!g.contains(e,a)&&e.push(a)}g.keys=function(t){if(!g.isObject(t))return[];if(d)return d(t);var e=[];for(var n in t)g.has(t,n)&&e.push(n);return O&&M(t,e),e},g.allKeys=function(t){if(!g.isObject(t))return[];var e=[];for(var n in t)e.push(n);return O&&M(t,e),e},g.values=function(t){for(var e=g.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r},g.mapObject=function(t,e,n){e=_(e,n);for(var r,i=g.keys(t),o=i.length,a={},s=0;s<o;s++)a[r=i[s]]=e(t[r],r,t);return a},g.pairs=function(t){for(var e=g.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},g.invert=function(t){for(var e={},n=g.keys(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e},g.functions=g.methods=function(t){var e=[];for(var n in t)g.isFunction(t[n])&&e.push(n);return e.sort()},g.extend=y(g.allKeys),g.extendOwn=g.assign=y(g.keys),g.findKey=function(t,e,n){e=_(e,n);for(var r,i=g.keys(t),o=0,a=i.length;o<a;o++)if(e(t[r=i[o]],r,t))return r},g.pick=function(t,e,n){var r,i,o={},a=t;if(null==a)return o;g.isFunction(e)?(i=g.allKeys(a),r=v(e,n)):(i=E(arguments,!1,!1,1),r=function(t,e,n){return e in n},a=Object(a));for(var s=0,c=i.length;s<c;s++){var u=i[s],l=a[u];r(l,u,a)&&(o[u]=l)}return o},g.omit=function(t,e,n){if(g.isFunction(e))e=g.negate(e);else{var r=g.map(E(arguments,!1,!1,1),String);e=function(t,e){return!g.contains(r,e)}}return g.pick(t,e,n)},g.defaults=y(g.allKeys,!0),g.create=function(t,e){var n=w(t);return e&&g.extendOwn(n,e),n},g.clone=function(t){return g.isObject(t)?g.isArray(t)?t.slice():g.extend({},t):t},g.tap=function(t,e){return e(t),t},g.isMatch=function(t,e){var n=g.keys(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var a=n[o];if(e[a]!==i[a]||!(a in i))return!1}return!0};var D=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof g&&(t=t._wrapped),e instanceof g&&(e=e._wrapped);var i=u.call(t);if(i!==u.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,s=e.constructor;if(a!==s&&!(g.isFunction(a)&&a instanceof a&&g.isFunction(s)&&s instanceof s)&&"constructor"in t&&"constructor"in e)return!1}r=r||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return r[c]===e;if(n.push(t),r.push(e),o){if((c=t.length)!==e.length)return!1;for(;c--;)if(!D(t[c],e[c],n,r))return!1}else{var l,f=g.keys(t);if(c=f.length,g.keys(e).length!==c)return!1;for(;c--;)if(l=f[c],!g.has(e,l)||!D(t[l],e[l],n,r))return!1}return n.pop(),r.pop(),!0};g.isEqual=function(t,e){return D(t,e)},g.isEmpty=function(t){return null==t||(x(t)&&(g.isArray(t)||g.isString(t)||g.isArguments(t))?0===t.length:0===g.keys(t).length)},g.isElement=function(t){return!(!t||1!==t.nodeType)},g.isArray=f||function(t){return"[object Array]"===u.call(t)},g.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},g.each(["Arguments","Function","String","Number","Date","RegExp","Error"],(function(t){g["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}})),g.isArguments(arguments)||(g.isArguments=function(t){return g.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(g.isFunction=function(t){return"function"==typeof t||!1}),g.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},g.isNaN=function(t){return g.isNumber(t)&&t!==+t},g.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===u.call(t)},g.isNull=function(t){return null===t},g.isUndefined=function(t){return void 0===t},g.has=function(t,e){return null!=t&&l.call(t,e)},g.noConflict=function(){return t._=r,this},g.identity=function(t){return t},g.constant=function(t){return function(){return t}},g.noop=function(){},g.property=b,g.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},g.matcher=g.matches=function(t){return t=g.extendOwn({},t),function(e){return g.isMatch(e,t)}},g.times=function(t,e,n){var r=Array(Math.max(0,t));e=v(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},g.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},g.now=Date.now||function(){return(new Date).getTime()};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$=g.invert(j),A=function(t){var e=function(e){return t[e]},n="(?:"+g.keys(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}};g.escape=A(j),g.unescape=A($),g.result=function(t,e,n){var r=null==t?void 0:t[e];return void 0===r&&(r=n),g.isFunction(r)?r.call(t):r};var N=0;g.uniqueId=function(t){var e=++N+"";return t?t+e:e},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,W=function(t){return"\\"+B[t]};g.template=function(t,e,n){!e&&n&&(e=n),e=g.defaults({},e,g.templateSettings);var r=RegExp([(e.escape||L).source,(e.interpolate||L).source,(e.evaluate||L).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,(function(e,n,r,a,s){return o+=t.slice(i,s).replace(q,W),i=s+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),e})),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var s=function(t){return a.call(this,t,g)},c=e.variable||"obj";return s.source="function("+c+"){\n"+o+"}",s},g.chain=function(t){var e=g(t);return e._chain=!0,e};var X=function(t,e){return t._chain?g(e).chain():e};g.mixin=function(t){g.each(g.functions(t),(function(e){var n=g[e]=t[e];g.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),X(this,n.apply(g,t))}}))},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=i[t];g.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],X(this,n)}})),g.each(["concat","join","slice"],(function(t){var e=i[t];g.prototype[t]=function(){return X(this,e.apply(this._wrapped,arguments))}})),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=function(){return""+this._wrapped}}).call(t)}(n,n.exports);var r=n.exports,i={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};function o(t,e){try{return t(e)}catch(t){return e}}var a=document,s=window,c=a.documentElement,u=a.createElement.bind(a),l=u("div"),f=u("table"),d=u("tbody"),p=u("tr"),h=Array.isArray,m=Array.prototype,g=m.concat,v=m.filter,_=m.indexOf,y=m.map,w=m.push,b=m.slice,S=m.some,k=m.splice,x=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,I=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,P=/<.+>/,E=/^\w+$/;function C(t,e){return t&&(A(e)||N(e))?I.test(t)?e.getElementsByClassName(t.slice(1)):E.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t):[]}var T=function(t,e){if(t){if(j(t))return t;var n=t;if(q(t)){var r=(j(e)?e[0]:e)||a;if(!(n=x.test(t)?r.getElementById(t.slice(1)):P.test(t)?Mt(t):C(t,r)))return}else if(B(t))return this.ready(t);(n.nodeType||n===s)&&(n=[n]),this.length=n.length;for(var i=0,o=this.length;i<o;i++)this[i]=n[i]}};T.prototype.init=function(t,e){return new T(t,e)};var R=T.prototype,O=R.init;O.fn=O.prototype=R,R.length=0,R.splice=k,"function"==typeof Symbol&&(R[Symbol.iterator]=m[Symbol.iterator]),R.map=function(t){return O(g.apply([],y.call(this,(function(e,n){return t.call(e,n,e)}))))},R.slice=function(t,e){return O(b.call(this,t,e))};var F=/-([a-z])/g;function M(t){return t.replace(F,(function(t,e){return e.toUpperCase()}))}function D(t,e){var n=t&&(t.matches||t.webkitMatchesSelector||t.msMatchesSelector);return!!n&&!!e&&n.call(t,e)}function j(t){return t instanceof T}function $(t){return!!t&&t===t.window}function A(t){return!!t&&9===t.nodeType}function N(t){return!!t&&1===t.nodeType}function L(t){return"boolean"==typeof t}function B(t){return"function"==typeof t}function q(t){return"string"==typeof t}function W(t){return void 0===t}function X(t){return null===t}function U(t){return!isNaN(parseFloat(t))&&isFinite(t)}function V(t){if("object"!=typeof t||null===t)return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function H(t,e,n){if(n){for(var r=t.length;r--;)if(!1===e.call(t[r],r,t[r]))return t}else if(V(t))for(var i=Object.keys(t),o=0,a=i.length;o<a;o++){var s=i[o];if(!1===e.call(t[s],s,t[s]))return t}else for(var c=0,u=t.length;c<u;c++)if(!1===e.call(t[c],c,t[c]))return t;return t}function G(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=!!L(t[0])&&t.shift(),r=t.shift(),i=t.length;if(!r)return{};if(!i)return G(n,O,r);for(var o=0;o<i;o++){var a=t[o];for(var s in a)n&&(h(a[s])||V(a[s]))?(r[s]&&r[s].constructor===a[s].constructor||(r[s]=new a[s].constructor),G(n,r[s],a[s])):r[s]=a[s]}return r}function z(t){return q(t)?function(e,n){return D(n,t)}:B(t)?t:j(t)?function(e,n){return t.is(n)}:t?function(e,n){return n===t}:function(){return!1}}function J(t,e){return e?t.filter(e):t}O.guid=1,O.isWindow=$,O.isFunction=B,O.isArray=h,O.isNumeric=U,O.isPlainObject=V,R.get=function(t){return W(t)?b.call(this):this[(t=Number(t))<0?t+this.length:t]},R.eq=function(t){return O(this.get(t))},R.first=function(){return this.eq(0)},R.last=function(){return this.eq(-1)},O.each=H,R.each=function(t){return H(this,t)},R.prop=function(t,e){if(t){if(q(t))return t=i[t]||t,arguments.length<2?this[0]&&this[0][t]:this.each((function(n,r){r[t]=e}));for(var n in t)this.prop(n,t[n]);return this}},R.removeProp=function(t){return this.each((function(e,n){delete n[i[t]||t]}))},O.extend=G,R.extend=function(t){return G(R,t)},R.filter=function(t){var e=z(t);return O(v.call(this,(function(t,n){return e.call(t,n,t)})))};var K=/\S+/g;function Q(t){return q(t)&&t.match(K)||[]}function Y(t,e,n,r){for(var i=[],o=B(e),a=r&&z(r),s=0,c=t.length;s<c;s++)if(o){var u=e(t[s]);u.length&&w.apply(i,u)}else for(var l=t[s][e];!(null==l||r&&a(-1,l));)i.push(l),l=n?l[e]:null;return i}function Z(t){return t.length>1?v.call(t,(function(t,e,n){return _.call(n,t)===e})):t}function tt(t,e,n){if(N(t)){var r=s.getComputedStyle(t,null);return n?r.getPropertyValue(e)||void 0:r[e]||t.style[e]}}function et(t,e){return parseInt(tt(t,e),10)||0}R.hasClass=function(t){return!!t&&S.call(this,(function(e){return N(e)&&e.classList.contains(t)}))},R.removeAttr=function(t){var e=Q(t);return this.each((function(t,n){N(n)&&H(e,(function(t,e){n.removeAttribute(e)}))}))},R.attr=function(t,e){if(t){if(q(t)){if(arguments.length<2){if(!this[0]||!N(this[0]))return;var n=this[0].getAttribute(t);return X(n)?void 0:n}return W(e)?this:X(e)?this.removeAttr(t):this.each((function(n,r){N(r)&&r.setAttribute(t,e)}))}for(var r in t)this.attr(r,t[r]);return this}},R.toggleClass=function(t,e){var n=Q(t),r=!W(e);return this.each((function(t,i){N(i)&&H(n,(function(t,n){r?e?i.classList.add(n):i.classList.remove(n):i.classList.toggle(n)}))}))},R.addClass=function(t){return this.toggleClass(t,!0)},R.removeClass=function(t){return arguments.length?this.toggleClass(t,!1):this.attr("class","")},O.unique=Z,R.add=function(t,e){return O(Z(this.get().concat(O(t,e).get())))};var nt=/^--/;function rt(t){return nt.test(t)}var it={},ot=l.style,at=["webkit","moz","ms"];function st(t,e){if(void 0===e&&(e=rt(t)),e)return t;if(!it[t]){var n=M(t),r=""+n[0].toUpperCase()+n.slice(1);H((n+" "+at.join(r+" ")+r).split(" "),(function(e,n){if(n in ot)return it[t]=n,!1}))}return it[t]}var ct={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function ut(t,e,n){return void 0===n&&(n=rt(t)),n||ct[t]||!U(e)?e:e+"px"}R.css=function(t,e){if(q(t)){var n=rt(t);return t=st(t,n),arguments.length<2?this[0]&&tt(this[0],t,n):t?(e=ut(t,e,n),this.each((function(r,i){N(i)&&(n?i.style.setProperty(t,e):i.style[t]=e)}))):this}for(var r in t)this.css(r,t[r]);return this};var lt=/^\s+|\s+$/;function ft(t,e){var n=t.dataset[e]||t.dataset[M(e)];return lt.test(n)?n:o(JSON.parse,n)}function dt(t,e,n){n=o(JSON.stringify,n),t.dataset[M(e)]=n}function pt(t,e){var n=t.documentElement;return Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])}function ht(t,e){return et(t,"border"+(e?"Left":"Top")+"Width")+et(t,"padding"+(e?"Left":"Top"))+et(t,"padding"+(e?"Right":"Bottom"))+et(t,"border"+(e?"Right":"Bottom")+"Width")}R.data=function(t,e){if(!t){if(!this[0])return;var n={};for(var r in this[0].dataset)n[r]=ft(this[0],r);return n}if(q(t))return arguments.length<2?this[0]&&ft(this[0],t):W(e)?this:this.each((function(n,r){dt(r,t,e)}));for(var i in t)this.data(i,t[i]);return this},H([!0,!1],(function(t,e){H(["Width","Height"],(function(t,n){R[(e?"outer":"inner")+n]=function(r){if(this[0])return $(this[0])?e?this[0]["inner"+n]:this[0].document.documentElement["client"+n]:A(this[0])?pt(this[0],n):this[0][(e?"offset":"client")+n]+(r&&e?et(this[0],"margin"+(t?"Top":"Left"))+et(this[0],"margin"+(t?"Bottom":"Right")):0)}}))})),H(["Width","Height"],(function(t,e){var n=e.toLowerCase();R[n]=function(r){if(!this[0])return W(r)?void 0:this;if(!arguments.length)return $(this[0])?this[0].document.documentElement["client"+e]:A(this[0])?pt(this[0],e):this[0].getBoundingClientRect()[n]-ht(this[0],!t);var i=parseInt(r,10);return this.each((function(e,r){if(N(r)){var o=tt(r,"boxSizing");r.style[n]=ut(n,i+("border-box"===o?ht(r,!t):0))}}))}}));var mt={};function gt(t){return"none"===tt(t,"display")}function vt(t,e){return!e||!S.call(e,(function(e){return t.indexOf(e)<0}))}R.toggle=function(t){return this.each((function(e,n){N(n)&&((W(t)?gt(n):t)?(n.style.display=n.___cd||"",gt(n)&&(n.style.display=function(t){if(mt[t])return mt[t];var e=u(t);a.body.insertBefore(e,null);var n=tt(e,"display");return a.body.removeChild(e),mt[t]="none"!==n?n:"block"}(n.tagName))):(n.___cd=tt(n,"display"),n.style.display="none"))}))},R.hide=function(){return this.toggle(!1)},R.show=function(){return this.toggle(!0)};var _t={focus:"focusin",blur:"focusout"},yt={mouseenter:"mouseover",mouseleave:"mouseout"},wt=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function bt(t){return yt[t]||_t[t]||t}function St(t){return t.___ce=t.___ce||{}}function kt(t){var e=t.split(".");return[e[0],e.slice(1).sort()]}function xt(t,e,n,r,i){var o=St(t);if(e)o[e]&&(o[e]=o[e].filter((function(o){var a=o[0],s=o[1],c=o[2];if(i&&c.guid!==i.guid||!vt(a,n)||r&&r!==s)return!0;t.removeEventListener(e,c)})));else for(e in o)xt(t,e,n,r,i)}function It(t){return t.multiple&&t.options?Y(v.call(t.options,(function(t){return t.selected&&!t.disabled&&!t.parentNode.disabled})),"value"):t.value||""}R.off=function(t,e,n){var r=this;if(W(t))this.each((function(t,e){(N(e)||A(e)||$(e))&&xt(e)}));else if(q(t))B(e)&&(n=e,e=""),H(Q(t),(function(t,i){var o=kt(i),a=o[0],s=o[1],c=bt(a);r.each((function(t,r){(N(r)||A(r)||$(r))&&xt(r,c,s,e,n)}))}));else for(var i in t)this.off(i,t[i]);return this},R.on=function(t,e,n,r,i){var o=this;if(!q(t)){for(var a in t)this.on(a,e,n,t[a],i);return this}return q(e)||(W(e)||X(e)?e="":W(n)?(n=e,e=""):(r=n,n=e,e="")),B(r)||(r=n,n=void 0),r?(H(Q(t),(function(t,a){var s=kt(a),c=s[0],u=s[1],l=bt(c),f=c in yt,d=c in _t;l&&o.each((function(t,o){if(N(o)||A(o)||$(o)){var a=function(t){if(t.target["___i"+t.type])return t.stopImmediatePropagation();if((!t.namespace||vt(u,t.namespace.split(".")))&&(e||!(d&&(t.target!==o||t.___ot===l)||f&&t.relatedTarget&&o.contains(t.relatedTarget)))){var s=o;if(e){for(var c=t.target;!D(c,e);){if(c===o)return;if(!(c=c.parentNode))return}s=c,t.___cd=!0}t.___cd&&Object.defineProperty(t,"currentTarget",{configurable:!0,get:function(){return s}}),Object.defineProperty(t,"data",{configurable:!0,get:function(){return n}});var p=r.call(s,t,t.___td);i&&xt(o,l,u,e,a),!1===p&&(t.preventDefault(),t.stopPropagation())}};a.guid=r.guid=r.guid||O.guid++,function(t,e,n,r,i){var o=St(t);o[e]=o[e]||[],o[e].push([n,r,i]),t.addEventListener(e,i)}(o,l,u,e,a)}}))})),this):this},R.one=function(t,e,n,r){return this.on(t,e,n,r,!0)},R.ready=function(t){var e=function(){return setTimeout(t,0,O)};return"loading"!==a.readyState?e():a.addEventListener("DOMContentLoaded",e),this},R.trigger=function(t,e){if(q(t)){var n=kt(t),r=n[0],i=n[1],o=bt(r);if(!o)return this;var s=wt.test(o)?"MouseEvents":"HTMLEvents";(t=a.createEvent(s)).initEvent(o,!0,!0),t.namespace=i.join("."),t.___ot=r}t.___td=e;var c=t.___ot in _t;return this.each((function(e,n){c&&B(n[t.___ot])&&(n["___i"+t.type]=!0,n[t.___ot](),n["___i"+t.type]=!1),n.dispatchEvent(t)}))};var Pt=/%20/g,Et=/\r?\n/g;var Ct=/file|reset|submit|button|image/i,Tt=/radio|checkbox/i;R.serialize=function(){var t="";return this.each((function(e,n){H(n.elements||[n],(function(e,n){if(!(n.disabled||!n.name||"FIELDSET"===n.tagName||Ct.test(n.type)||Tt.test(n.type)&&!n.checked)){var r=It(n);if(!W(r))H(h(r)?r:[r],(function(e,r){t+=function(t,e){return"&"+encodeURIComponent(t)+"="+encodeURIComponent(e.replace(Et,"\r\n")).replace(Pt,"+")}(n.name,r)}))}}))})),t.slice(1)},R.val=function(t){return arguments.length?this.each((function(e,n){var r=n.multiple&&n.options;if(r||Tt.test(n.type)){var i=h(t)?y.call(t,String):X(t)?[]:[String(t)];r?H(n.options,(function(t,e){e.selected=i.indexOf(e.value)>=0}),!0):n.checked=i.indexOf(n.value)>=0}else n.value=W(t)||X(t)?"":t})):this[0]&&It(this[0])},R.clone=function(){return this.map((function(t,e){return e.cloneNode(!0)}))},R.detach=function(t){return J(this,t).each((function(t,e){e.parentNode&&e.parentNode.removeChild(e)})),this};var Rt=/^\s*<(\w+)[^>]*>/,Ot=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,Ft={"*":l,tr:d,td:p,th:p,thead:f,tbody:f,tfoot:f};function Mt(t){if(!q(t))return[];if(Ot.test(t))return[u(RegExp.$1)];var e=Rt.test(t)&&RegExp.$1,n=Ft[e]||Ft["*"];return n.innerHTML=t,O(n.childNodes).detach().get()}O.parseHTML=Mt,R.empty=function(){return this.each((function(t,e){for(;e.firstChild;)e.removeChild(e.firstChild)}))},R.html=function(t){return arguments.length?W(t)?this:this.each((function(e,n){N(n)&&(n.innerHTML=t)})):this[0]&&this[0].innerHTML},R.remove=function(t){return J(this,t).detach().off(),this},R.text=function(t){return W(t)?this[0]?this[0].textContent:"":this.each((function(e,n){N(n)&&(n.textContent=t)}))},R.unwrap=function(){return this.parent().each((function(t,e){if("BODY"!==e.tagName){var n=O(e);n.replaceWith(n.children())}})),this},R.offset=function(){var t=this[0];if(t){var e=t.getBoundingClientRect();return{top:e.top+s.pageYOffset,left:e.left+s.pageXOffset}}},R.offsetParent=function(){return this.map((function(t,e){for(var n=e.offsetParent;n&&"static"===tt(n,"position");)n=n.offsetParent;return n||c}))},R.position=function(){var t=this[0];if(t){var e="fixed"===tt(t,"position"),n=e?t.getBoundingClientRect():this.offset();if(!e){for(var r=t.ownerDocument,i=t.offsetParent||r.documentElement;(i===r.body||i===r.documentElement)&&"static"===tt(i,"position");)i=i.parentNode;if(i!==t&&N(i)){var o=O(i).offset();n.top-=o.top+et(i,"borderTopWidth"),n.left-=o.left+et(i,"borderLeftWidth")}}return{top:n.top-et(t,"marginTop"),left:n.left-et(t,"marginLeft")}}},R.children=function(t){return J(O(Z(Y(this,(function(t){return t.children})))),t)},R.contents=function(){return O(Z(Y(this,(function(t){return"IFRAME"===t.tagName?[t.contentDocument]:"TEMPLATE"===t.tagName?t.content.childNodes:t.childNodes}))))},R.find=function(t){return O(Z(Y(this,(function(e){return C(t,e)}))))};var Dt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,jt=/^$|^module$|\/(java|ecma)script/i,$t=["type","src","nonce","noModule"];function At(t,e,n,r,i){r?t.insertBefore(e,n?t.firstChild:null):t.parentNode.insertBefore(e,n?t:t.nextSibling),i&&function(t,e){var n=O(t);n.filter("script").add(n.find("script")).each((function(t,n){if(jt.test(n.type)&&c.contains(n)){var r=u("script");r.text=n.textContent.replace(Dt,""),H($t,(function(t,e){n[e]&&(r[e]=n[e])})),e.head.insertBefore(r,null),e.head.removeChild(r)}}))}(e,t.ownerDocument)}function Nt(t,e,n,r,i,o,a,s){return H(t,(function(t,o){H(O(o),(function(t,o){H(O(e),(function(e,a){var s=n?a:o,c=n?t:e;At(n?o:a,c?s.cloneNode(!0):s,r,i,!c)}),s)}),a)}),o),e}R.after=function(){return Nt(arguments,this,!1,!1,!1,!0,!0)},R.append=function(){return Nt(arguments,this,!1,!1,!0)},R.appendTo=function(t){return Nt(arguments,this,!0,!1,!0)},R.before=function(){return Nt(arguments,this,!1,!0)},R.insertAfter=function(t){return Nt(arguments,this,!0,!1,!1,!1,!1,!0)},R.insertBefore=function(t){return Nt(arguments,this,!0,!0)},R.prepend=function(){return Nt(arguments,this,!1,!0,!0,!0,!0)},R.prependTo=function(t){return Nt(arguments,this,!0,!0,!0,!1,!1,!0)},R.replaceWith=function(t){return this.before(t).remove()},R.replaceAll=function(t){return O(t).replaceWith(this),this},R.wrapAll=function(t){for(var e=O(t),n=e[0];n.children.length;)n=n.firstElementChild;return this.first().before(e),this.appendTo(n)},R.wrap=function(t){return this.each((function(e,n){var r=O(t)[0];O(n).wrapAll(e?r.cloneNode(!0):r)}))},R.wrapInner=function(t){return this.each((function(e,n){var r=O(n),i=r.contents();i.length?i.wrapAll(t):r.append(t)}))},R.has=function(t){var e=q(t)?function(e,n){return C(t,n).length}:function(e,n){return n.contains(t)};return this.filter(e)},R.is=function(t){var e=z(t);return S.call(this,(function(t,n){return e.call(t,n,t)}))},R.next=function(t,e,n){return J(O(Z(Y(this,"nextElementSibling",e,n))),t)},R.nextAll=function(t){return this.next(t,!0)},R.nextUntil=function(t,e){return this.next(e,!0,t)},R.not=function(t){var e=z(t);return this.filter((function(n,r){return(!q(t)||N(r))&&!e.call(r,n,r)}))},R.parent=function(t){return J(O(Z(Y(this,"parentNode"))),t)},R.index=function(t){var e=t?O(t)[0]:this[0],n=t?this:O(e).parent().children();return _.call(n,e)},R.closest=function(t){var e=this.filter(t);if(e.length)return e;var n=this.parent();return n.length?n.closest(t):e},R.parents=function(t,e){return J(O(Z(Y(this,"parentElement",!0,e))),t)},R.parentsUntil=function(t,e){return this.parents(e,t)},R.prev=function(t,e,n){return J(O(Z(Y(this,"previousElementSibling",e,n))),t)},R.prevAll=function(t){return this.prev(t,!0)},R.prevUntil=function(t,e){return this.prev(e,!0,t)},R.siblings=function(t){return J(O(Z(Y(this,(function(t){return O(t).parent().children().not(t)})))),t)};var Lt="https://personalization-web-stable.mindbox.ru",Bt={DATASET_PREFIX:"popmechanic",CSS_PREFIX:"popmechanic-",JS_PREFIX:"popmechanic.",WEB_URL:Lt+"/web/",GEO_URL:"https://api.mindbox.ru/geo/",TS_URL:Lt+"/web/time/",FORM_TEST_URL:Lt+"/web/forms/",CONTACTS_URL:Lt+"/web/contacts/",ANIMATION_SPEED:200};O.parseJSON=JSON?JSON.parse:function(){},O.inArray=function(t,e,n){return[].indexOf.call(e,t,n)};var qt={};O.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),(function(t,e){qt["[object "+e+"]"]=e.toLowerCase()})),O.type=function(t){return null==t?String(t):qt[toString.call(t)]||"object"},O.contains=document.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},O.fn.filterVisible=function(){return this.filter((function(t,e){var n=O(e).css("visibility"),r=O(e).css("display"),i=parseInt(O(e).css("opacity"),10);return"hidden"!==n&&"none"!==r&&i>0}))},O.fn.animate=function(t,e){var n=this;return n.addClass("popmechanic-transition"),n.css(t),setTimeout((function(){n.removeClass("popmechanic-transition"),"function"==typeof e&&e.call(n)}),Bt.ANIMATION_SPEED),n},O.data=function(t,e,n){return O(t).data(e,n)},O.noop=function(){},function(t){var e=1,n=Array.prototype.slice,r=t.isFunction,i=function(t){return"string"==typeof t},o={},a={},s="onfocusin"in window,c={focus:"focusin",blur:"focusout"},u={mouseenter:"mouseover",mouseleave:"mouseout"};function l(t){return t._zid||(t._zid=e++)}function f(t,e,n,r){if((e=d(e)).ns)var i=(a=e.ns,new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)"));var a;return(o[l(t)]||[]).filter((function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||i.test(t.ns))&&(!n||l(t.fn)===l(n))&&(!r||t.sel==r)}))}function d(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function p(t,e){return t.del&&!s&&t.e in c||!!e}function h(t){return u[t]||s&&c[t]||t}function m(e,n,r,i,a,s,c){var f=l(e),m=o[f]||(o[f]=[]);n.split(/\s/).forEach((function(n){if("ready"==n)return t(document).ready(r);var o=d(n);o.fn=r,o.sel=a,o.e in u&&(r=function(e){var n=e.relatedTarget;if(!n||n!==this&&!t.contains(this,n))return o.fn.apply(this,arguments)}),o.del=s;var l=s||r;o.proxy=function(t){if((t=b(t)).isImmediatePropagationStopped&&!t.isImmediatePropagationStopped()){t.data=i;var n=l.apply(e,null==t._args?[t]:[t].concat(t._args));return!1===n&&(t.preventDefault(),t.stopPropagation()),n}},o.i=m.length,m.push(o),"addEventListener"in e&&e.addEventListener(h(o.e),o.proxy,p(o,c))}))}function g(t,e,n,r,i){var a=l(t);(e||"").split(/\s/).forEach((function(e){f(t,e,n,r).forEach((function(e){delete o[a][e.i],"removeEventListener"in t&&t.removeEventListener(h(e.e),e.proxy,p(e,i))}))}))}a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",t.event={add:m,remove:g},t.proxy=function(e,o){var a=2 in arguments&&n.call(arguments,2);if(r(e)){var s=function(){return e.apply(o,a?a.concat(n.call(arguments)):arguments)};return s._zid=l(e),s}if(i(o))return a?(a.unshift(e[o],e),t.proxy.apply(null,a)):t.proxy(e[o],e);throw new TypeError("expected function")},t.fn.bind=function(t,e,n){return this.on(t,e,n)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.one=function(t,e,n,r){return this.on(t,e,n,r,1)};var v=function(){return!0},_=function(){return!1},y=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,w={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function b(e,n){if(n||!e.isDefaultPrevented){n||(n=e),t.each(w,(function(t,r){var i=n[t];e[t]=function(){return this[r]=v,i&&i.apply(n,arguments)},e[r]=_}));try{e.timeStamp||(e.timeStamp=Date.now())}catch(t){}(void 0!==n.defaultPrevented?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(e.isDefaultPrevented=v)}return e}function S(t){var e,n={originalEvent:t};for(e in t)y.test(e)||void 0===t[e]||(n[e]=t[e]);return b(n,t)}t.fn.delegate=function(t,e,n){return this.on(e,t,n)},t.fn.undelegate=function(t,e,n){return this.off(e,t,n)},t.fn.live=function(e,n){return t(document.body).delegate(this.selector,e,n),this},t.fn.die=function(e,n){return t(document.body).undelegate(this.selector,e,n),this},t.fn.on=function(e,o,a,s,c){var u,l,f=this;return e&&!i(e)?(t.each(e,(function(t,e){f.on(t,o,a,e,c)})),f):(i(o)||r(s)||!1===s||(s=a,a=o,o=void 0),void 0!==s&&!1!==a||(s=a,a=void 0),!1===s&&(s=_),f.each((function(r,i){c&&(u=function(t){return g(i,t.type,s),s.apply(this,arguments)}),o&&(l=function(e){var r,a=t(e.target).closest(o,i).get(0);if(a&&a!==i)return r=t.extend(S(e),{currentTarget:a,liveFired:i}),(u||s).apply(a,[r].concat(n.call(arguments,1)))}),m(i,e,s,a,o,l||u)})))},t.fn.off=function(e,n,o){var a=this;return e&&!i(e)?(t.each(e,(function(t,e){a.off(t,n,e)})),a):(i(n)||r(o)||!1===o||(o=n,n=void 0),!1===o&&(o=_),a.each((function(){g(this,e,o,n)})))},t.fn.trigger=function(e,n){return(e=i(e)||t.isPlainObject(e)?t.Event(e):b(e))._args=n,this.each((function(){e.type in c&&"function"==typeof this[e.type]?this[e.type]():"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,n)}))},t.fn.triggerHandler=function(e,n){var r,o;return this.each((function(a,s){(r=S(i(e)?t.Event(e):e))._args=n,r.target=s,t.each(f(s,e.type||e),(function(t,e){if(o=e.proxy(r),r.isImmediatePropagationStopped())return!1}))})),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach((function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}})),t.Event=function(t,e){i(t)||(t=(e=t).type);var n=document.createEvent(a[t]||"Events"),r=!0;if(e)for(var o in e)"bubbles"==o?r=!!e[o]:n[o]=e[o];return n.initEvent(t,r,!0),b(n)}}(O),function(t){var e,n,r=+new Date,i=window.document,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,c=/^\s*$/,u=i.createElement("a");function l(e,n,r,o){if(e.global)return function(e,n,r){var i=t.Event(n);return t(e).trigger(i,r),!i.isDefaultPrevented()}(n||i,r,o)}function f(t,e){var n=e.context;if(!1===e.beforeSend.call(n,t,e)||!1===l(e,n,"ajaxBeforeSend",[t,e]))return!1;l(e,n,"ajaxSend",[t,e])}function d(t,e,n,r){var i=n.context;n.success.call(i,t,"success",e),r&&r.resolveWith(i,[t,"success",e]),l(n,i,"ajaxSuccess",[e,n,t]),h("success",e,n)}function p(t,e,n,r,i){var o=r.context;r.error.call(o,n,e,t),i&&i.rejectWith(o,[n,e,t]),l(r,o,"ajaxError",[n,r,t||e]),h(e,n,r)}function h(e,n,r){var i=r.context;r.complete.call(i,n,e),l(r,i,"ajaxComplete",[n,r]),function(e){e.global&&!--t.active&&l(e,null,"ajaxStop")}(r)}function m(){}function g(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function v(e,n,r,i){return t.isFunction(n)&&(i=r,r=n,n=void 0),t.isFunction(r)||(i=r,r=void 0),{url:e,data:n,success:r,dataType:i}}u.href=window.location.href,t.active=0,t.ajaxJSONP=function(e,n){if(!("type"in e))return t.ajax(e);var o,a,s=e.jsonpCallback,c=(t.isFunction(s)?s():s)||"Zepto"+r++,u=i.createElement("script"),l=window[c],h=function(e){t(u).triggerHandler("error",e||"abort")},m={abort:h};return n&&n.promise(m),t(u).on("load error",(function(r,i){clearTimeout(a),t(u).off().remove(),"error"!=r.type&&o?d(o[0],m,e,n):p(null,i||"error",m,e,n),window[c]=l,o&&t.isFunction(l)&&l(o[0]),l=o=void 0})),!1===f(m,e)?(h("abort"),m):(window[c]=function(){o=arguments},u.src=e.url.replace(/\?(.+)=\?/,"?$1="+c),i.head.appendChild(u),e.timeout>0&&(a=setTimeout((function(){h("timeout")}),e.timeout)),m)},t.ajaxSettings={type:"GET",beforeSend:m,success:m,error:m,complete:m,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:m},t.ajax=function(r){var o,h,v=t.extend({},r||{}),_=t.Deferred&&t.Deferred();for(e in t.ajaxSettings)void 0===v[e]&&(v[e]=t.ajaxSettings[e]);!function(e){e.global&&0==t.active++&&l(e,null,"ajaxStart")}(v),v.crossDomain||((o=i.createElement("a")).href=v.url,o.href=o.href,v.crossDomain=u.protocol+"//"+u.host!=o.protocol+"//"+o.host),v.url||(v.url=window.location.toString()),(h=v.url.indexOf("#"))>-1&&(v.url=v.url.slice(0,h)),function(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()&&"jsonp"!=e.dataType||(e.url=g(e.url,e.data),e.data=void 0)}(v);var y=v.dataType,w=/\?.+=\?/.test(v.url);if(w&&(y="jsonp"),!1!==v.cache&&(r&&!0===r.cache||"script"!=y&&"jsonp"!=y)||(v.url=g(v.url,"_="+Date.now())),"jsonp"==y)return w||(v.url=g(v.url,v.jsonp?v.jsonp+"=?":!1===v.jsonp?"":"callback=?")),t.ajaxJSONP(v,_);var b,S=v.accepts[y],k={},x=function(t,e){k[t.toLowerCase()]=[t,e]},I=/^([\w-]+:)\/\//.test(v.url)?RegExp.$1:window.location.protocol,P=v.xhr(),E=P.setRequestHeader;if(_&&_.promise(P),v.crossDomain||x("X-Requested-With","XMLHttpRequest"),x("Accept",S||"*/*"),(S=v.mimeType||S)&&(S.indexOf(",")>-1&&(S=S.split(",",2)[0]),P.overrideMimeType&&P.overrideMimeType(S)),(v.contentType||!1!==v.contentType&&v.data&&"GET"!=v.type.toUpperCase())&&x("Content-Type",v.contentType||"application/x-www-form-urlencoded"),v.headers)for(n in v.headers)x(n,v.headers[n]);if(P.setRequestHeader=x,P.onreadystatechange=function(){if(4==P.readyState){P.onreadystatechange=m,clearTimeout(b);var e,n=!1;if(P.status>=200&&P.status<300||304==P.status||0==P.status&&"file:"==I){if(y=y||function(t){return t&&(t=t.split(";",2)[0]),t&&("text/html"==t?"html":"application/json"==t?"json":a.test(t)?"script":s.test(t)&&"xml")||"text"}(v.mimeType||P.getResponseHeader("content-type")),"arraybuffer"==P.responseType||"blob"==P.responseType)e=P.response;else{e=P.responseText;try{e=function(t,e,n){if(n.dataFilter==m)return t;var r=n.context;return n.dataFilter.call(r,t,e)}(e,y,v),"script"==y?(0,eval)(e):"xml"==y?e=P.responseXML:"json"==y&&(e=c.test(e)?null:t.parseJSON(e))}catch(t){n=t}if(n)return p(n,"parsererror",P,v,_)}d(e,P,v,_)}else p(P.statusText||null,P.status?"error":"abort",P,v,_)}},!1===f(P,v))return P.abort(),p(null,"abort",P,v,_),P;var C=!("async"in v)||v.async;if(P.open(v.type,v.url,C,v.username,v.password),v.xhrFields)for(n in v.xhrFields)P[n]=v.xhrFields[n];for(n in k)E.apply(P,k[n]);return v.timeout>0&&(b=setTimeout((function(){P.onreadystatechange=m,P.abort(),p(null,"timeout",P,v,_)}),v.timeout)),P.send(v.data?v.data:null),P},t.get=function(){return t.ajax(v.apply(null,arguments))},t.post=function(){var e=v.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=v.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,n,r){if(!this.length)return this;var i,a=this,s=e.split(/\s/),c=v(e,n,r),u=c.success;return s.length>1&&(c.url=s[0],i=s[1]),c.success=function(e){a.html(i?t("<div>").html(e.replace(o,"")).find(i):e),u&&u.apply(a,arguments)},t.ajax(c),this};var _=encodeURIComponent;t.param=function(e,n){var r=[];return r.add=function(e,n){t.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(_(e)+"="+_(n))},function e(n,r,i,o){var a,s=t.isArray(r),c=t.isPlainObject(r);t.each(r,(function(r,u){a=t.type(u),o&&(r=i?o:o+"["+(c||"object"==a||"array"==a?r:"")+"]"),!o&&s?n.add(u.name,u.value):"array"==a||!i&&"object"==a?e(n,u,i,r):n.add(r,u)}))}(r,e,n),r.join("&").replace(/%20/g,"+")}}(O),function(t){var e=function(){}.toString().indexOf("_")>-1,n=function(){},r=Object.create||function(t){var e=function(){};return e.prototype=t,new e},i=!0,o={toString:""};for(var a in o)o.hasOwnProperty(a)&&(i=!1);var s=i?["toString","valueOf"]:null;function c(n,r,o){var a=!1;if(i){var c=[];t.each(s,(function(){o.hasOwnProperty(this)&&(a=!0)&&c.push({name:this,val:o[this]})})),a&&(t.each(o,(function(t){c.push({name:t,val:this})})),o=c)}t.each(o,(function(i,o){if(a&&(i=o.name,o=o.val),t.isFunction(o)&&(!e||o.toString().indexOf(".__base")>-1)){var s=n[i]||function(){};r[i]=function(){var t=this.__base;this.__base=s;var e=o.apply(this,arguments);return this.__base=t,e}}else r[i]=o}))}t.inherit=function(){var e=arguments,i=t.isFunction(e[0]),o=i?e[0]:n,a=e[i?1:0]||{},s=e[i?2:1],u=a.__constructor||i&&o.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:function(){};if(!i)return u.prototype=a,u.prototype.__self=u.prototype.constructor=u,t.extend(u,s);t.extend(u,o);var l=o.prototype,f=u.prototype=r(l);return f.__self=f.constructor=u,c(l,f,a),s&&c(o,u,s),u},t.inheritSelf=function(t,e,n){var r=t.prototype;return c(r,r,e),n&&c(t,t,n),t}}(O);var Wt,Xt,Ut,Vt,Ht,Gt,zt,Jt,Kt,Qt,Yt=O.inherit;Xt=window.device,Wt={},window.device=Wt,Vt=window.document.documentElement,Qt=window.navigator.userAgent.toLowerCase(),Wt.ios=function(){return Wt.iphone()||Wt.ipod()||Wt.ipad()},Wt.iphone=function(){return!Wt.windows()&&Ht("iphone")},Wt.ipod=function(){return Ht("ipod")},Wt.ipad=function(){return Ht("ipad")||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},Wt.android=function(){return!Wt.windows()&&Ht("android")},Wt.androidPhone=function(){return Wt.android()&&Ht("mobile")},Wt.androidTablet=function(){return Wt.android()&&!Ht("mobile")},Wt.blackberry=function(){return Ht("blackberry")||Ht("bb10")||Ht("rim")},Wt.blackberryPhone=function(){return Wt.blackberry()&&!Ht("tablet")},Wt.blackberryTablet=function(){return Wt.blackberry()&&Ht("tablet")},Wt.windows=function(){return Ht("windows")},Wt.macosx=function(){return Ht("mac os x")},Wt.linux=function(){return Ht("linux")},Wt.windowsPhone=function(){return Wt.windows()&&Ht("phone")},Wt.windowsTablet=function(){return Wt.windows()&&Ht("touch")&&!Wt.windowsPhone()},Wt.fxos=function(){return(Ht("(mobile;")||Ht("(tablet;"))&&Ht("; rv:")},Wt.fxosPhone=function(){return Wt.fxos()&&Ht("mobile")},Wt.fxosTablet=function(){return Wt.fxos()&&Ht("tablet")},Wt.meego=function(){return Ht("meego")},Wt.cordova=function(){return window.cordova&&"file:"===location.protocol},Wt.nodeWebkit=function(){return"object"==typeof window.process},Wt.mobile=function(){return Wt.androidPhone()||Wt.iphone()||Wt.ipod()||Wt.windowsPhone()||Wt.blackberryPhone()||Wt.fxosPhone()||Wt.meego()},Wt.tablet=function(){return!Wt.mobile()&&(Wt.ipad()||Wt.androidTablet()||Wt.blackberryTablet()||Wt.windowsTablet()||Wt.fxosTablet())},Wt.desktop=function(){return!Wt.tablet()&&!Wt.mobile()},Wt.television=function(){var t,e;for(e=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"],t=0;t<e.length;){if(Ht(e[t]))return!0;t++}return!1},Wt.portrait=function(){return window.innerHeight/window.innerWidth>1},Wt.landscape=function(){return window.innerHeight/window.innerWidth<1},Wt.noConflict=function(){return window.device=Xt,this},Ht=function(t){return-1!==Qt.indexOf(t)},zt=function(t){var e;return e=new RegExp(t,"i"),Vt.className.match(e)},Ut=function(t){var e,n;n=t.split(/\s+/).map((function(t){return Bt.CSS_PREFIX+t})).filter((function(t){return!zt(t)})).join(" "),e=Vt.className.replace(/^\s+|\s+$/g,""),Vt.className=e+" "+n},Kt=function(t){var e=Bt.CSS_PREFIX+t;zt(e)&&(Vt.className=Vt.className.replace(" "+e,""))},Wt.ios()?Wt.ipad()?Ut("ios ipad tablet"):Wt.iphone()?Ut("ios iphone mobile"):Wt.ipod()&&Ut("ios ipod mobile"):Wt.android()?Wt.androidTablet()?Ut("android tablet"):Ut("android mobile"):Wt.blackberry()?Wt.blackberryTablet()?Ut("blackberry tablet"):Ut("blackberry mobile"):Wt.windows()?Wt.windowsTablet()?Ut("windows tablet"):Wt.windowsPhone()?Ut("windows mobile"):Ut("desktop"):Wt.fxos()?Wt.fxosTablet()?Ut("fxos tablet"):Ut("fxos mobile"):Wt.meego()?Ut("meego mobile"):Wt.nodeWebkit()?Ut("node-webkit"):Wt.television()?Ut("television"):Wt.desktop()&&Ut("desktop"),Wt.cordova()&&Ut("cordova"),Gt=function(){Wt.landscape()?(Kt("portrait"),Ut("landscape")):(Kt("landscape"),Ut("portrait"))},Jt=Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize",window.addEventListener?window.addEventListener(Jt,Gt,!1):window.attachEvent?window.attachEvent(Jt,Gt):window[Jt]=Gt,Gt();var Zt,te=Wt,ee=O("#"+Bt.CSS_PREFIX+"snippet");function ne(){var t=O("body");t.addClass("popmechanic-disable-scroll"),O("html").addClass("popmechanic-disable-scroll"),te.ios()&&t.addClass("popmechanic-ios-scroll-fix"),te.macosx()&&(t.addClass("popmechanic-auto-height"),O("html").addClass("popmechanic-auto-height"))}function re(){var t=O("body");t.removeClass("popmechanic-disable-scroll popmechanic-auto-height"),O("html").removeClass("popmechanic-disable-scroll popmechanic-auto-height"),te.ios()&&t.removeClass("popmechanic-ios-scroll-fix")}function ie(t){return Bt.CSS_PREFIX+"container-"+t}function oe(t){return Bt.CSS_PREFIX+"form-"+t}function ae(t){var e,n=ie(t),r=O('<div class="'+Bt.CSS_PREFIX+'js-container" id="'+n+'"></div>');return e=r,te.mobile()&&e.addClass(Bt.CSS_PREFIX+"mobile"),te.tablet()&&e.addClass(Bt.CSS_PREFIX+"tablet"),te.desktop()&&e.addClass(Bt.CSS_PREFIX+"desktop"),r}function se(t){var e=ie(t),n=Zt.find("#"+e);return 0!==n.length||(n=ae(t)).appendTo(Zt),n}function ce(t){return 0!==Zt.find("#"+Bt.CSS_PREFIX+"form-"+t).length}ee.length>0?Zt=ee:(Zt=O('<div id="'+Bt.CSS_PREFIX+'snippet" style="height: 0; min-height: 0;"></div>')).prependTo("body");var ue="<%= wrapperId %> * {  margin: 0;  padding: 0;  border: 0;  font-size: 100%;  font: inherit;  color: inherit;  line-height: normal;  vertical-align: baseline;  background: none;  pointer-events: all;  position: static;}<%= wrapperId %> *:before,<%= wrapperId %> *:after {  content: '';  content: none;}";function le(t,e){var n="#"+ie(e);return t.replace(/\/\*.*?\*\//gm,"").replace(/(#popmechanic-(?:form|button))(\s|\.|:|{|,)/g," $1-"+e+"$2").replace(fe,(function(t,e,r){for(var i=r.split(","),o=0;o<i.length;o++)i[o].match(de)?i[o]=i[o].replace(de,n+"$&"):i[o]=n+" "+i[o];return e+i.join(",")}))}var fe=/((?:^|})[\s\n]*)((?:(?:(?:[.#][_a-zA-Z0-9-.:]+)|\*|\+|~|>)[^{]*)+{)/gm,de=/\.popmechanic-(?:success|error|pending|submitted|desktop|tablet|mobile)(\s|\.|#)/g;function pe(t,e,n){return(n?'<div id="'+ie(e)+'">':"")+t.replace(/id=["']popmechanic-(form|button)["']/g,'id="'+Bt.CSS_PREFIX+"$1-"+e+'"')+(n?"</div>":"")}window.PopMechanic.getContainer=se,window.PopMechanic.getContainerId=ie;var he,me,ge,ve,_e,ye,we={};try{localStorage.setItem("popmechanic.localstorage",1)}catch(t){throw new Error("Private browsing not supported")}ve=function(t,e){var n=(t||[]).map((function(t){return t.id}));return n.sort(),n.join()!=(e||[]).sort().join()},_e=function(t){return t.map((function(t){return t.id}))},he=function(t,e){var n=localStorage.getItem(Bt.JS_PREFIX+t);if(n)try{return JSON.parse(n)}catch(t){return e}return e},me=function(t,e){localStorage.setItem(Bt.JS_PREFIX+t,JSON.stringify(e))},we.setHostReported=function(){me("host-reported",1)},we.isHostReported=function(){return he("host-reported")},we.setForm=function(t,e){me("form-"+t,e)},we.getForm=function(t){return he("form-"+t)},we.formsChanged=function(t,e){return ve(e,he("forms-"+t))},we.setForms=function(t,e){me("forms-"+t,_e(e))},we.conditionsSplitsChanged=function(t,e){return ve(e,he("conditions-splits-"+t))},we.getConditionsSplit=function(t){return he("conditions-split-"+t)},we.setConditionsSplit=function(t,e){me("conditions-split-"+t,e)},we.setConditionsSplits=function(t,e){me("conditions-splits-"+t,_e(e))},we.settingsSplitsChanged=function(t,e){return ve(e,he("settings-splits-"+t))},we.getSettingsSplit=function(t){return he("settings-split-"+t)},we.setSettingsSplit=function(t,e){me("settings-split-"+t,e)},we.setSettingsSplits=function(t,e){me("settings-splits-"+t,_e(e))},we.setContactsSent=function(t){me("contacts-sent-"+(t=t||"lead"),"1")},we.isContactsSent=function(t){return"lead"==(t=t||"lead")?"1"===he("contacts-sent")||he("contacts-sent-lead"):"1"===he("contacts-sent-"+t)},we.setLastShownWithId=function(t){me("last-shown-"+t,(new Date).valueOf())},we.setLastShown=function(t){we.setLastShownWithId(t),me("last-shown",(new Date).valueOf())},we.getLastShown=function(t){var e;return null===(e=he(t?"last-shown-"+t:"last-shown",null))?null:new Date(+e||0)},we.isShown=function(t){return t?!!he("last-shown-"+t):!!he("last-shown")},we.setCompleted=function(t){var e=(new Date).valueOf();me("completed-"+t,e),me("completed",e)},we.getCompleted=function(t){var e;return null===(e=he(t?"completed-"+t:"completed",null))?null:new Date(+e||0)},we.setUncompleted=function(t){var e=(new Date).valueOf();me("uncompleted-"+t,e),me("uncompleted",e)},we.getUncompleted=function(t){var e;return null===(e=he(t?"uncompleted-"+t:"uncompleted",null))?null:new Date(+e||0)},we.set=function(t,e){me(t,e)},we.get=function(t){return he(t)},(ge=he("history",[])).push(location.href),ge.splice(0,Math.max(ge.length-10,0)),me("history",ge),we.history=ge,we.addToHistory=function(t){(ge=he("history",[])).push(t),ge.splice(0,Math.max(ge.length-10,0)),me("history",ge),we.history=ge},ye=location.href,setInterval((function(){location.href!==ye&&(ye=location.href,we.addToHistory(ye))}),1e3);var be={exports:{}};!function(t,n){t.exports=function t(n,r,i){function o(s,c){if(!r[s]){if(!n[s]){if(!c&&e)return e(s);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};n[s][0].call(l.exports,(function(t){var e=n[s][1][t];return o(e||t)}),l,l.exports,t,n,r,i)}return r[s].exports}for(var a=e,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){var r=t("./init"),i={init:function(t){this.get=r(t),t&&t.callback&&"function"==typeof t.callback&&t.callback(this.get)}};e.exports=i},{"./init":7}],2:[function(t,e,n){var r=t("./terms"),i=t("./helpers/utils"),o={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(t){return o.aliases.main.type+"="+t.type+o.delimiter+o.aliases.main.source+"="+t.source+o.delimiter+o.aliases.main.medium+"="+t.medium+o.delimiter+o.aliases.main.campaign+"="+t.campaign+o.delimiter+o.aliases.main.content+"="+t.content+o.delimiter+o.aliases.main.term+"="+t.term},extra:function(t){return o.aliases.extra.fire_date+"="+i.setDate(new Date,t)+o.delimiter+o.aliases.extra.entrance_point+"="+document.location.href+o.delimiter+o.aliases.extra.referer+"="+(document.referrer||r.none)},user:function(t,e){return o.aliases.udata.visits+"="+t+o.delimiter+o.aliases.udata.ip+"="+e+o.delimiter+o.aliases.udata.agent+"="+navigator.userAgent},session:function(t){return o.aliases.session.pages_seen+"="+t+o.delimiter+o.aliases.session.current_page+"="+document.location.href},promo:function(t){return o.aliases.promo+"="+i.setLeadingZeroToInt(i.randomInt(t.min,t.max),t.max.toString().length)}}};e.exports=o},{"./helpers/utils":6,"./terms":10}],3:[function(t,e,n){var r=t("../data").delimiter,i="";e.exports={setPrefix:function(t){i=t},getPrefix:function(){return i},encodeData:function(t){return i+encodeURIComponent(t).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(t){try{return decodeURIComponent(t.replace(new RegExp("^"+i),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(e){try{return unescape(t)}catch(t){return""}}},set:function(t,e,n,r,i){var o,a;if(n){var s=new Date;s.setTime(s.getTime()+60*n*1e3),o="; expires="+s.toGMTString()}else o="";a=r&&!i?";domain=."+r:"",document.cookie=this.encodeData(t)+"="+this.encodeData(e)+o+a+"; path=/"},get:function(t){for(var e=this.encodeData(t)+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return this.decodeData(i.substring(e.length,i.length))}return null},destroy:function(t,e,n){this.set(t,"",-1,e,n)},parse:function(t){var e=[],n={};if("string"==typeof t)e.push(t);else for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);for(var o=0;o<e.length;o++){var a;n[this.unsbjs(e[o])]={},a=this.get(e[o])?this.get(e[o]).split(r):[];for(var s=0;s<a.length;s++){var c=a[s].split("="),u=c.splice(0,1);u.push(c.join("=")),n[this.unsbjs(e[o])][u[0]]=this.decodeData(u[1])}}return n},unsbjs:function(t){return t.replace("sbjs_","")}}},{"../data":2}],4:[function(t,e,n){var r="",i=t("../data").delimiter;e.exports={setPrefix:function(t){r=t},getPrefix:function(){return r},encodeData:function(t){return r+encodeURIComponent(t).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(t){try{return decodeURIComponent(t.replace(new RegExp("^"+r),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(e){try{return unescape(t)}catch(t){return""}}},set:function(t,e,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+60*n*1e3),r=i.valueOf()}else r="";localStorage.setItem(this.encodeData(t),JSON.stringify({value:e,expires:r}))},get:function(t){var e=this.encodeData(t),n=localStorage.getItem(e);return n?(n=JSON.parse(n)).expires&&parseInt(n.expires)<(new Date).valueOf()?(n=null,localStorage.removeItem(e),null):n.value:null},parse:function(t){var e=[],n={};if("string"==typeof t)e.push(t);else for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);for(var o=0;o<e.length;o++){var a;n[this.unsbjs(e[o])]={},a=this.get(e[o])?this.get(e[o]).split(i):[];for(var s=0;s<a.length;s++){var c=a[s].split("="),u=c.splice(0,1);u.push(c.join("=")),n[this.unsbjs(e[o])][u[0]]=this.decodeData(u[1])}}return n},destroy:function(t){localStorage.removeItem(this.encodeData(t))},unsbjs:function(t){return t.replace("sbjs_","")}}},{"../data":2}],5:[function(t,e,n){e.exports={parse:function(t){for(var e=this.parseOptions,n=e.parser[e.strictMode?"strict":"loose"].exec(t),r={},i=14;i--;)r[e.key[i]]=n[i]||"";return r[e.q.name]={},r[e.key[12]].replace(e.q.parser,(function(t,n,i){n&&(r[e.q.name][n]=i)})),r},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(t){for(var e={},n=(t||window.location.search.substring(1)).split("&"),r=0;r<n.length;r++){var i=n[r].split("=");if(void 0===e[i[0]])e[i[0]]=i[1];else if("string"==typeof e[i[0]]){var o=[e[i[0]],i[1]];e[i[0]]=o}else e[i[0]].push(i[1])}return e},getHost:function(t){return this.parse(t).host.replace("www.","")}}},{}],6:[function(t,e,n){e.exports={escapeRegexp:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(t,e){var n=t.getTimezoneOffset()/60,r=t.getHours(),i=e||0===e?e:-n;return t.setHours(r+n+i),t.getFullYear()+"-"+this.setLeadingZeroToInt(t.getMonth()+1,2)+"-"+this.setLeadingZeroToInt(t.getDate(),2)+" "+this.setLeadingZeroToInt(t.getHours(),2)+":"+this.setLeadingZeroToInt(t.getMinutes(),2)+":"+this.setLeadingZeroToInt(t.getSeconds(),2)},setLeadingZeroToInt:function(t,e){for(var n=t+"";n.length<e;)n="0"+n;return n},randomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t}}},{}],7:[function(t,e,n){var r=t("./data"),i=t("./terms"),o=t("./helpers/localStorage"),a=t("./helpers/uri"),s=t("./helpers/utils"),c=t("./params"),u=t("./migrations");e.exports=function(t){var e,n,l,f,d,p,h,m,g,v=c.fetch(t),_=a.getParam(),y=v.domain.host,w=v.domain.isolate,b=v.lifetime;function S(t){switch(t){case i.traffic.utm:e=i.traffic.utm,n=void 0!==_.utm_source?_.utm_source:void 0!==_.gclid?"google":void 0!==_.yclid?"yandex":i.none,l=void 0!==_.utm_medium?_.utm_medium:void 0!==_.gclid||void 0!==_.yclid?"cpc":i.none,f=void 0!==_.utm_campaign?_.utm_campaign:void 0!==_[v.campaign_param]?_[v.campaign_param]:void 0!==_.gclid?"google_cpc":void 0!==_.yclid?"yandex_cpc":i.none,d=_.utm_content||i.none,p=function(){var t=document.referrer;if(_.utm_term)return _.utm_term;if(!(t&&a.parse(t).host&&a.parse(t).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return a.getParam(a.parse(document.referrer).query).text}catch(t){return!1}}()||i.none;break;case i.traffic.organic:e=i.traffic.organic,n=n||a.getHost(document.referrer),l=i.referer.organic,f=i.none,d=i.none,p=i.none;break;case i.traffic.referral:e=i.traffic.referral,n=n||a.getHost(document.referrer),l=l||i.referer.referral,f=i.none,d=a.parse(document.referrer).path,p=i.none;break;case i.traffic.typein:e=i.traffic.typein,n=v.typein_attributes.source,l=v.typein_attributes.medium,f=i.none,d=i.none,p=i.none;break;default:e=i.oops,n=i.oops,l=i.oops,f=i.oops,d=i.oops,p=i.oops}var o={type:e,source:n,medium:l,campaign:f,content:d,term:p};return r.pack.main(o)}function k(t){var e=document.referrer;switch(t){case i.traffic.organic:return!!e&&x(e)&&function(t){var e=new RegExp("^https://yandex\\.[a-zA-Z0-9]{2}/$"),r=new RegExp("^(?:.*\\.)?"+s.escapeRegexp("yandex")+"\\..{2,9}$"),i=new RegExp(".*"+s.escapeRegexp("text")+"=.*"),o=new RegExp("^(?:www\\.)?"+s.escapeRegexp("google")+"\\..{2,9}$");if(a.parse(t).query&&a.parse(t).host.match(r)&&a.parse(t).query.match(i)||t.match(e))return n="yandex",!0;if(a.parse(t).host.match(o))return n="google",!0;if(!a.parse(t).query)return!1;for(var c=0;c<v.organics.length;c++){if(a.parse(t).host.match(new RegExp("^(?:.*\\.)?"+s.escapeRegexp(v.organics[c].host)+"$","i"))&&a.parse(t).query.match(new RegExp(".*"+s.escapeRegexp(v.organics[c].param)+"=.*","i")))return n=v.organics[c].display||v.organics[c].host,!0;if(c+1===v.organics.length)return!1}}(e);case i.traffic.referral:return!!e&&x(e)&&function(t){if(!(v.referrals.length>0))return n=a.getHost(t),!0;for(var e=0;e<v.referrals.length;e++){if(a.parse(t).host.match(new RegExp("^(?:.*\\.)?"+s.escapeRegexp(v.referrals[e].host)+"$","i")))return n=v.referrals[e].display||v.referrals[e].host,l=v.referrals[e].medium||i.referer.referral,!0;if(e+1===v.referrals.length)return n=a.getHost(t),!0}}(e);default:return!1}}function x(t){if(v.domain){if(w)return a.getHost(t)!==a.getHost(y);var e=new RegExp("^(?:.*\\.)?"+s.escapeRegexp(y)+"$","i");return!a.getHost(t).match(e)}return a.getHost(t)!==a.getHost(document.location.href)}function I(){o.set(r.containers.current_extra,r.pack.extra(v.timezone_offset),b,y,w),o.get(r.containers.first_extra)||o.set(r.containers.first_extra,r.pack.extra(v.timezone_offset),b,y,w)}return o.setPrefix(v.prefix),u.go(b,y,w),o.set(r.containers.current,function(){var t;if(void 0!==_.utm_source||void 0!==_.utm_medium||void 0!==_.utm_campaign||void 0!==_.utm_content||void 0!==_.utm_term||void 0!==_.gclid||void 0!==_.yclid||void 0!==_[v.campaign_param])I(),t=S(i.traffic.utm);else if(k(i.traffic.organic))I(),t=S(i.traffic.organic);else if(!o.get(r.containers.session)&&k(i.traffic.referral))I(),t=S(i.traffic.referral);else{if(o.get(r.containers.first)||o.get(r.containers.current))return o.get(r.containers.current);I(),t=S(i.traffic.typein)}return t}(),b,y,w),o.get(r.containers.first)||o.set(r.containers.first,o.get(r.containers.current),b,y,w),o.get(r.containers.udata)?(h=parseInt(o.parse(r.containers.udata)[o.unsbjs(r.containers.udata)][r.aliases.udata.visits])||1,h=o.get(r.containers.session)?h:h+1,m=r.pack.user(h,v.user_ip)):(h=1,m=r.pack.user(h,v.user_ip)),o.set(r.containers.udata,m,b,y,w),o.get(r.containers.session)?(g=parseInt(o.parse(r.containers.session)[o.unsbjs(r.containers.session)][r.aliases.session.pages_seen])||1,g+=1):g=1,o.set(r.containers.session,r.pack.session(g),v.session_length,y,w),v.promocode&&!o.get(r.containers.promocode)&&o.set(r.containers.promocode,r.pack.promo(v.promocode),b,y,w),o.parse(r.containers)}},{"./data":2,"./helpers/localStorage":4,"./helpers/uri":5,"./helpers/utils":6,"./migrations":8,"./params":9,"./terms":10}],8:[function(t,e,n){var r=t("./data"),i=t("./helpers/cookies"),o=t("./helpers/localStorage");e.exports={go:function(t,e,n){var a,s=this.migrations,c={l:t,d:e,i:n},u=[],l="";if(i.setPrefix(o.getPrefix()),i.get(r.containers.first)||i.get(r.service.migrations))if(i.get(r.service.migrations)){for(u=i.get(r.service.migrations).split(r.delimiter),a=0;a<s.length;a++)-1===u.indexOf(s[a].id+"=1")&&(console.log("migrating: "+s[a]),s[a].go(s[a].id,c));for(u=[],a=0;a<s.length;a++)u.push(s[a].id);for(l="",a=0;a<u.length;a++)l+=u[a]+"=1",a<u.length-1&&(l+=r.delimiter);i.set(r.service.migrations,l,c.l,c.d,c.i)}else for(a=0;a<s.length;a++)s[a].go(s[a].id,c);else{for(a=0;a<s.length;a++)u.push(s[a].id);for(l="",a=0;a<u.length;a++)l+=u[a]+"=1",a<u.length-1&&(l+=r.delimiter);i.set(r.service.migrations,l,c.l,c.d,c.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(t,e){var n=t+"=1",o=t+"=0",a=function(t,e,n){return e||n?t:r.delimiter};try{var s=[];for(var c in r.containers)r.containers.hasOwnProperty(c)&&s.push(r.containers[c]);for(var u=0;u<s.length;u++)if(i.get(s[u])){var l=i.get(s[u]).replace(/(\|)?\|(\|)?/g,a);i.destroy(s[u],e.d,e.i),i.destroy(s[u],e.d,!e.i),i.set(s[u],l,e.l,e.d,e.i)}i.get(r.containers.session)&&i.set(r.containers.session,r.pack.session(0),e.l,e.d,e.i),i.set(r.service.migrations,n,e.l,e.d,e.i)}catch(t){i.set(r.service.migrations,o,e.l,e.d,e.i)}}},{id:"1471519752600",version:"1.0.5",go:function(t,e){var n=t+"=1",o=t+"=0",a=i.getPrefix();try{i.setPrefix("");var s=[];for(var c in r.containers)r.containers.hasOwnProperty(c)&&s.push(r.containers[c]);for(var u=0;u<s.length;u++)if(i.setPrefix(""),i.get(s[u])){var l=i.get(s[u]);i.setPrefix(a),i.set(s[u],l,e.l,e.d,e.i)}i.setPrefix(""),i.get(r.containers.session)&&(i.setPrefix(a),i.set(r.containers.session,r.pack.session(0),e.l,e.d,e.i)),i.setPrefix(a),i.set(r.service.migrations,n,e.l,e.d,e.i)}catch(t){i.set(r.service.migrations,o,e.l,e.d,e.i)}}},{id:"1471519752605",version:"1.1.0",go:function(t,e){for(var n in r.containers)if(r.containers.hasOwnProperty(n)){var a=i.get(r.containers[n]);o.set(r.containers[n],a,e.l),i.destroy(r.containers[n])}}}]}},{"./data":2,"./helpers/cookies":3,"./helpers/localStorage":4}],9:[function(t,e,n){var r=t("./terms"),i=t("./helpers/uri");e.exports={fetch:function(t){var e=t||{},n={};if(n.prefix=this.validate.isString(e.prefix)?e.prefix:"",n.lifetime=this.validate.checkFloat(e.lifetime)||6,n.lifetime=parseInt(30*n.lifetime*24*60),n.session_length=this.validate.checkInt(e.session_length)||30,n.timezone_offset=this.validate.checkInt(e.timezone_offset),n.campaign_param=e.campaign_param||!1,n.user_ip=e.user_ip||r.none,e.promocode?(n.promocode={},n.promocode.min=parseInt(e.promocode.min)||1e5,n.promocode.max=parseInt(e.promocode.max)||999999):n.promocode=!1,e.typein_attributes&&e.typein_attributes.source&&e.typein_attributes.medium?(n.typein_attributes={},n.typein_attributes.source=e.typein_attributes.source,n.typein_attributes.medium=e.typein_attributes.medium):n.typein_attributes={source:"(direct)",medium:"(none)"},e.domain&&this.validate.isString(e.domain)?n.domain={host:e.domain,isolate:!1}:e.domain&&e.domain.host?n.domain=e.domain:n.domain={host:i.getHost(document.location.hostname),isolate:!1},n.referrals=[],e.referrals&&e.referrals.length>0)for(var o=0;o<e.referrals.length;o++)e.referrals[o].host&&n.referrals.push(e.referrals[o]);if(n.organics=[],e.organics&&e.organics.length>0)for(var a=0;a<e.organics.length;a++)e.organics[a].host&&e.organics[a].param&&n.organics.push(e.organics[a]);return n.organics.push({host:"bing.com",param:"q",display:"bing"}),n.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),n.organics.push({host:"about.com",param:"q",display:"about"}),n.organics.push({host:"aol.com",param:"q",display:"aol"}),n.organics.push({host:"ask.com",param:"q",display:"ask"}),n.organics.push({host:"globososo.com",param:"q",display:"globo"}),n.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),n.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),n.organics.push({host:"tut.by",param:"query",display:"tut.by"}),n.referrals.push({host:"t.co",display:"twitter.com"}),n.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),n},validate:{checkFloat:function(t){return!(!t||!this.isNumeric(parseFloat(t)))&&parseFloat(t)},checkInt:function(t){return!(!t||!this.isNumeric(parseInt(t)))&&parseInt(t)},isNumeric:function(t){return!isNaN(t)},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)}}}},{"./helpers/uri":5,"./terms":10}],10:[function(t,e,n){e.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)}(be);var Se=be.exports,ke=Bt.CSS_PREFIX+"-init-at";function xe(){var t=Pe();if(Se.get.current_add.fb&&"string"==typeof Se.get.current_add.fb){var e=new Date(Se.get.current_add.fb.replace(" ","T")).valueOf();return localStorage[ke]=t+":"+e,e}if(localStorage[ke]){var n=localStorage[ke].split(":"),r=n[0],i=n[1];if(parseInt(r,10)===t)return parseInt(i,10)}return localStorage[ke]=t+":"+window.PopMechanic.initStartedAt,window.PopMechanic.initStartedAt}var Ie=xe;function Pe(){var t=Se.get.udata.vst;try{return parseInt(t)}catch(t){return 0}}var Ee={log:function(){var t=r.toArray(arguments);console.log.apply(console,["[Personalization]"].concat(t))}},Ce=!1;function Te(){try{return!!Ce||(!!window.PopMechanic.isTesting||(-1!==location.toString().indexOf("pm-test-form")||(-1!==location.hash.indexOf("pm-debug")||!!localStorage["pm-debug"])))}catch(t){return!1}}window.addEventListener("message",(function(t){t.source===window&&t.data&&"popmechanic-extension"===t.data.source&&(Ce=!0)}));var Re,Oe={isDebugging:Te,log:function(){Te()&&Ee.log.apply(null,arguments)}},Fe=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,Me=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,De=null,je=[];function $e(t,e){var n;Oe.isDebugging()&&(n=Date.now(),Oe.log("store "+t+" prune started @",n));var r=De.transaction(t,"readwrite"),i=0;r.objectStore(t).openCursor().onsuccess=function(t){var n=t.target.result;n&&((!n.value.ts||n.value.ts<e)&&(n.delete(),i+=1),i<1e3&&n.continue())},Oe.isDebugging()&&(r.oncomplete=function(){var e=Date.now();Oe.log("store "+t+" prune complete @",e,"total: ",e-n)})}function Ae(){je.forEach((function(t){t()})),je.push=function(t){"function"==typeof t&&t()}}function Ne(t){if("function"==typeof t)return function(){var e=this,n=arguments;return new Promise((function(r,i){je.push((function(){t.apply(e,n).then(r,i)}))}))}}function Le(){return!0}Fe||Ae(),(Re=Fe.open(Bt.JS_PREFIX+"db",10)).onerror=function(t){console.error("Error opening indexedDB"),Ae()},Re.onsuccess=function(t){(De=t.target.result).onversionchange=function(){De.close(),De=null},De.onclose=function(){De=null},De.onerror=function(t){console.error("PopMechanic IDB error "+t.target.errorCode)};var e=parseInt(localStorage[Bt.JS_PREFIX+"pruned-at"]);if(!e||Date.now()-1e3*e>864e5){localStorage[Bt.JS_PREFIX+"pruned-at"]=Math.floor(Date.now()/1e3);var n=new Date;n.setMonth(n.getMonth()-6);var r=n.valueOf();$e("h",r),$e("e",r),$e("ps",r),$e("f",r)}Ae()},Re.onupgradeneeded=function(t){var e,n=t.target.result;if(t.oldVersion<1){var r=n.createObjectStore("h",{autoIncrement:!0});r.createIndex("url","url",{unique:!1}),r.createIndex("vst","vst",{unique:!1})}if(t.oldVersion<2&&((e=n.createObjectStore("e",{autoIncrement:!0})).createIndex("type","type",{unique:!1}),e.createIndex("vst","vst",{unique:!1}),e.createIndex("form","form",{unique:!1})),t.oldVersion<4&&((e=Re.transaction.objectStore("e")).indexNames.contains("ts")||e.createIndex("ts","ts",{unique:!1})),t.oldVersion<5&&((r=Re.transaction.objectStore("h")).indexNames.contains("pagetype")||r.createIndex("pagetype","pagetype",{unique:!1})),6===t.oldVersion&&n.deleteObjectStore("ps"),t.oldVersion<7){var i=n.createObjectStore("ps",{autoIncrement:!0});i.createIndex("productIds","productIds",{unique:!1}),i.createIndex("segmentationId","segmentationId",{unique:!1}),i.createIndex("segmentId","segmentId",{unique:!1}),i.createIndex("ts","ts",{unique:!1})}t.oldVersion<8&&((r=Re.transaction.objectStore("h")).indexNames.contains("productIds")||r.createIndex("productIds","productIds",{unique:!1}),r.indexNames.contains("categoryIds")||r.createIndex("categoryIds","categoryIds",{unique:!1})),t.oldVersion<9&&(Re.transaction.objectStore("h").createIndex("productItem","productItem",{unique:!1}),Re.transaction.objectStore("ps").createIndex("productItem","productItem",{unique:!1})),t.oldVersion<10&&((e=n.createObjectStore("f",{autoIncrement:!0})).createIndex("id","id",{unique:!0}),e.createIndex("form","form",{unique:!1}))};var Be={push:Ne((function(t){return De?new Promise((function(e,n){var r=De.transaction(["h"],"readwrite").objectStore("h").add(t);r.addEventListener("success",(function(){e(r.result)})),r.addEventListener("error",(function(){n(r.error)}))})):Promise.resolve()})),enrich:Ne((function(t,e){return De?new Promise((function(n,i){var o=De.transaction(["h"],"readwrite").objectStore("h"),a=o.get(t);a.addEventListener("success",(function(){var s=r.extend({},a.result,e),c=o.put(s,t);c.addEventListener("success",n),c.addEventListener("error",i)})),a.addEventListener("error",(function(){n()}))})):Promise.resolve()})),count:Ne((function(t,e,n){return De?(void 0===t&&(t=Le),void 0===e&&(e=0),new Promise((function(i){var o=[],a=De.transaction("h").objectStore("h").index(n?"vst":"url"),s=n?Me.only(n):null;n||"string"!=typeof t||(s=Me.only(t)),a.openCursor(s).onsuccess=function(n){var a=n.target.result;if(a){if(a.value.ts>=e){var s=Promise.resolve("string"==typeof t?t===a.value.url:t(a.value));o.push(s)}a.continue()}else Promise.all(o).then((function(t){var e=r.filter(t,r.identity).length;i(e)}))}}))):Promise.reject()})),find:Ne((function(t,e,n){return De?(void 0===t&&(t=Le),void 0===e&&(e=0),new Promise((function(i){var o=[],a=De.transaction("h").objectStore("h").index(n?"vst":"url"),s=n?Me.only(n):null;n||"string"!=typeof t||(s=Me.only(t)),a.openCursor(s,["prev"]).onsuccess=function(n){var a=n.target.result;if(a){if(a.value.ts>=e){var s=Promise.resolve("string"==typeof t?t===a.value.url:t(a.value));o.push(s)}a.continue()}else Promise.all(o).then((function(t){var e=r.filter(t,r.identity)[0];i(e||null)}))}}))):Promise.reject()}))},qe={push:Ne((function(t){if(!De)return Promise.resolve();if(!t||!t.type)return Promise.resolve();var e=r.clone(t);return"number"!=typeof t.vst&&(e.vst=Pe()),"number"!=typeof t.ts&&(e.ts=Date.now()),De.transaction("e","readwrite").objectStore("e").add(e),Promise.resolve()})),getLast:Ne((function(t,e){return De?new Promise((function(n){var r=De.transaction("e").objectStore("e").index(t.form?"form":"type"),i=t.form?Me.only(t.form):t.type?Me.only(t.type):null,o=null;r.openCursor(i,["prev"]).onsuccess=function(r){var i=r.target.result;if(i){if(t.form&&i.value.form!==t.form)return i.continue();if(t.type&&i.value.type!==t.type)return i.continue();if("function"==typeof e&&!e(i.value))return i.continue();(!o||o&&o.ts<i.value.ts)&&(o=i.value),i.continue()}else n(o)}})):Promise.reject()})),forEach:Ne((function(t,e,n){if(!De)return Promise.reject();var r=De.transaction("e"),i=t?r.objectStore("e").index(t):r.objectStore("e");return new Promise((function(t){i.openCursor(e||null).onsuccess=function(e){var r=e.target.result;r?(n(r.value),r.continue()):t()}}))}))},We={push:Ne((function(t){return De?new Promise((function(e,n){var r=De.transaction(["ps"],"readwrite"),i=r.objectStore("ps");t.forEach((function(t){i.add(t)})),r.oncomplete=function(){e("OK")},r.onerror=function(t){n(t)}})):Promise.resolve()})),remove:Ne((function(t){return De?(void 0===t&&(t=Le),new Promise((function(e){De.transaction("ps","readwrite").objectStore("ps").openCursor().onsuccess=function(n){var r=n.target.result;r?(t(r.value)&&r.delete(),r.continue()):e("OK")}}))):Promise.reject()})),find:Ne((function(t,e){return De?(void 0===t&&(t=Le),void 0===e&&(e=0),new Promise((function(n){De.transaction("ps").objectStore("ps").openCursor().onsuccess=function(r){var i=r.target.result;i?(e<i.value.ts||n(null),t(i.value)?n(i.value):i.continue()):n(null)}}))):Promise.reject()})),filter:Ne((function(t,e){return De?(void 0===t&&(t=Le),void 0===e&&(e=0),new Promise((function(n){var r=[];De.transaction("ps").objectStore("ps").openCursor(null,["prev"]).onsuccess=function(i){var o=i.target.result;o?(e<o.value.ts||n(r),("string"==typeof t?t===o.value.url:t(o.value))&&r.push(o.value),o.continue()):n(r)}}))):Promise.reject()}))},Xe={add:Ne((function(t){var e=t.id,n=t.form;return De?new Promise((function(t,r){var i=De.transaction(["f"],"readwrite").objectStore("f").put(n,e);i.addEventListener("success",t),i.addEventListener("error",r)})):Promise.resolve()})),getById:Ne((function(t){return De?new Promise((function(e,n){var r=De.transaction("f").objectStore("f").get(t);r.addEventListener("success",(function(t){return e(t.target.result)})),r.addEventListener("error",(function(){return n(null)}))})):Promise.reject(null)}))},Ue=function(t,e){Zt.on(t,e)},Ve=function(t,e){Zt.off(t,e)},He=function(t,e){Zt.trigger(t,e)};function Ge(){return!1}function ze(){}function Je(t){return t.final&&t.result}function Ke(t){return t.final&&!t.result}var Qe=["$any","$contains","$exclude","$startsWith","$endsWith","$eq","$neq","$regexp","$not_regexp"],Ye=Qe.concat(["$any","$none","$in","$nin","$in_contains","$in_startsWith","$in_endsWith","$in_regexp"]),Ze=["$any","$eq","$neq","$lt","$gt","$lte","$gte","$between"],tn=["$any","$none","$in","$nin"],en=["$after"],nn={day_of_week:tn,city:tn,region:tn,country:tn,source:tn,device:tn,operating_system:tn,push_request_unavailable:["$any","$eq","$neq"],page:Ye,referrer:Qe,utm_source:Qe,utm_medium:Qe,utm_campaign:Qe,utm_content:Qe,utm_term:Qe,visit:Ze,form_completed:en,form_uncompleted:en,form_seen:en,dom_element:["$exists","$not_exists"],cart:Ze,time:Ze,time_utc:Ze,datetime:Ze,datetime_utc:Ze,google_optimize:tn,visited_url:Ze,productId:Ye,productName:Ye,productCategoryId:Ye,productBrandName:Ye,productPrice:Ze,productPriceWithDiscount:Ze,productDiscount:Ze,categoryId:Ye,time_passed:["$eq","$between","$any"],url:Ye,js:["$exec"],mindboxProductSegment:["$exists","$not_exists"]},rn=null,on=null;function an(t){return new Date(t)}var sn={get:function(){return on?on.then(an):on=(on=new Promise((function(t,e){O.ajax({type:"GET",url:Bt.TS_URL,dataType:"json",success:t,error:e})}))).then((function(t){return rn=new Date(t.timestamp)})).catch((function(){return window.PopMechanic.initAt}))},getSync:function(){return rn?new Date(rn):new Date(window.PopMechanic.initAt)}},cn=null;var un={getGeo:function(){return cn||(cn=new Promise((function(t,e){O.ajax({type:"GET",url:Bt.GEO_URL,data:{domain:location.hostname,extend:!0},dataType:"json",success:t,error:e})})))}},ln=function(t){var e=t.globalUtils;return delete t.globalUtils,e||{getIntegrationPromise:function(){return null},waitPromisesOrDelay:function(){return null},getMindboxIsReadyPromise:function(){return null},reportFailure:function(){return null},getSettings:function(){return null},getDeviceType:function(){return"unknown"},getTabVisibilityDuration:function(){return null},getTabInvisibilityDuration:function(){return null},resetTabVisibilityDuration:function(){return null}}}(window.PopMechanic),fn=function(){var t=ln.getIntegrationPromise("PopMechanicPageData");return t.then((function(t){fn=function(){return Promise.resolve(t)}})),t},dn=function(){var t=ln.getIntegrationPromise("PopMechanicCartData");return t.then((function(t){dn=function(){return Promise.resolve(t)}})),t},pn=2147483647,hn=/^xn--/,mn=/[^\x20-\x7E]/,gn=/[\x2E\u3002\uFF0E\uFF61]/g,vn={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_n=Math.floor,yn=String.fromCharCode;function wn(t){throw new RangeError(vn[t])}function bn(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function Sn(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+bn((t=t.replace(gn,".")).split("."),e).join(".")}function kn(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function xn(t){return bn(t,(function(t){var e="";return t>65535&&(e+=yn((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=yn(t)})).join("")}function In(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function Pn(t,e,n){var r=0;for(t=n?_n(t/700):t>>1,t+=_n(t/e);t>455;r+=36)t=_n(t/35);return _n(r+36*t/(t+38))}function En(t){var e,n,r,i,o,a,s,c,u,l,f,d=[],p=t.length,h=0,m=128,g=72;for((n=t.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&wn("not-basic"),d.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<p;){for(o=h,a=1,s=36;i>=p&&wn("invalid-input"),((c=(f=t.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:36)>=36||c>_n((pn-h)/a))&&wn("overflow"),h+=c*a,!(c<(u=s<=g?1:s>=g+26?26:s-g));s+=36)a>_n(pn/(l=36-u))&&wn("overflow"),a*=l;g=Pn(h-o,e=d.length+1,0==o),_n(h/e)>pn-m&&wn("overflow"),m+=_n(h/e),h%=e,d.splice(h++,0,m)}return xn(d)}function Cn(t){var e,n,r,i,o,a,s,c,u,l,f,d,p,h,m,g=[];for(d=(t=kn(t)).length,e=128,n=0,o=72,a=0;a<d;++a)(f=t[a])<128&&g.push(yn(f));for(r=i=g.length,i&&g.push("-");r<d;){for(s=pn,a=0;a<d;++a)(f=t[a])>=e&&f<s&&(s=f);for(s-e>_n((pn-n)/(p=r+1))&&wn("overflow"),n+=(s-e)*p,e=s,a=0;a<d;++a)if((f=t[a])<e&&++n>pn&&wn("overflow"),f==e){for(c=n,u=36;!(c<(l=u<=o?1:u>=o+26?26:u-o));u+=36)m=c-l,h=36-l,g.push(yn(In(l+m%h,0))),c=_n(m/h);g.push(yn(In(c,0))),o=Pn(n,p,r==i),n=0,++r}++n,++e}return g.join("")}var Tn={version:"1.3.2",ucs2:{decode:kn,encode:xn},decode:En,encode:Cn,toASCII:function(t){return Sn(t,(function(t){return mn.test(t)?"xn--"+Cn(t):t}))},toUnicode:function(t){return Sn(t,(function(t){return hn.test(t)?En(t.slice(4).toLowerCase()):t}))}},Rn=location.href.replace(location.host,Tn.toUnicode(location.host)),On=location.href.replace(location.host,Tn.toASCII(location.host));function Fn(t,e){return(t+="").length>=e?t:new Array(e-t.length+1).join("0")+t}Ue("destroy",(function(){Rn=location.href.replace(location.host,Tn.toUnicode(location.host)),On=location.href.replace(location.host,Tn.toASCII(location.host))}));var Mn={device:function(){return te.desktop()?"pc":te.tablet()?"tablet":"mobile"},operating_system:function(){return te.windows()?"windows":te.ios()?"ios":te.macosx()?"macos":te.android()?"android":te.linux()?"linux":"other"},source:function(){return Se.get.current.typ},time:function(){return sn.get()},time_utc:function(){return sn.get()},day_of_week:function(){return sn.get().then((function(t){return t.getDay()}))},datetime:function(){return sn.get()},datetime_utc:function(){return sn.get()},page:function(t){return t.value.match(/^[\u0000-\u007f]*$/)?On:Rn},country:function(){return un.getGeo().then((function(t){return t.country_id}))},region:function(){return un.getGeo().then((function(t){return t.region_id}))},city:function(){return un.getGeo().then((function(t){return t.city_id}))},utm_source:function(){return Se.get.current.src},utm_medium:function(){return Se.get.current.mdm},utm_campaign:function(){return Se.get.current.cmp},utm_content:function(){return Se.get.current.cnt},utm_term:function(){return Se.get.current.trm},visit:function(){return parseInt(Se.get.udata.vst,10)},referrer:function(){return document.referrer},google_optimize:function(t){return new Promise((function(e){var n=t.value.expId;!function t(r){try{var i=document.cookie.split(n)[1].split(";")[0].split(".")[2].split("!")[0];i=parseInt(i,10),e(i)}catch(n){r<500?setTimeout((function(){t(2*r)}),r):e(void 0)}}(100)}))},visited_url:function(t){var e,n,r;return $n.hasOwnProperty(t.value.operator)&&(e=function(e){return $n[t.value.operator](t.value.pattern,e&&e.url)}),"number"==typeof t.value.interval&&(n=Date.now()-1e3*t.value.interval),"$session"===t.value.interval&&(r=Se.get.udata.vst),Be.count(e,n,r).then((function(t){return t}))},push_request_unavailable:function(){return!(window.PushManager&&"default"===Notification.permission)},productId:function(){return fn().then((function(t){return t&&t.product&&t.product.id}))},productName:function(){return fn().then((function(t){return t&&t.product&&t.product.name}))},productCategoryId:function(){return fn().then((function(t){return t&&t.product&&t.product.categoryId}))},productBrandName:function(){return fn().then((function(t){return t&&t.product&&t.product.brand}))},productPrice:function(){return fn().then((function(t){return t&&t.product&&t.product.price}))},productPriceWithDiscount:function(){return fn().then((function(t){return t&&t.product&&t.product.priceWithDiscount}))},productDiscount:function(){return fn().then((function(t){return t&&t.product?t.product.price>t.product.priceWithDiscount?100*(t.product.price-t.product.priceWithDiscount)/t.product.price:0:NaN}))},categoryId:function(){return fn().then((function(t){return t&&t.category&&t.category.id}))}},Dn={time:function(t){var e=t.match(/(\d\d)\:(\d\d)\:(\d\d)/);return sn.get().then((function(t){var n=new Date(t);return n.setHours(e[1],e[2],e[3]),n}))},time_utc:function(t){var e=t.match(/(\d\d)\:(\d\d)\:(\d\d)([+-])(\d\d)\:(\d\d)/);return sn.get().then((function(t){var n=new Date(t);return e[5]&&e[6]?"+"===e[4]?(n.setUTCHours(e[1]-e[5],e[2]-e[6],e[3]),n):(n.setUTCHours(e[1]+e[5],e[2]+e[6],e[3]),n):(n.setUTCHours(e[1],e[2],e[3]),n)}))},datetime:function(t){var e=(new Date).getTimezoneOffset(),n=e<0?"+":"-",r=Fn(Math.abs(e)%60,2),i=Fn(Math.floor(Math.abs(e)/60),2),o=t.replace(/([+-]\d\d:\d\d|Z)$/,n+i+":"+r);return new Date(o)},datetime_utc:function(t){return new Date(t)},google_optimize:function(t){return t.variation},visited_url:function(t){return parseInt(t.visits,10)}};function jn(t){return function(e,n){return r.isArray(e)?r.some(e,(function(e){return t(e,n)})):t(e,n)}}var $n={$in:function(t,e){return r.contains(t,e)},$nin:function(t,e){return!r.contains(t,e)},$in_contains:function(t,e){return jn($n.$contains)(t,e)},$in_startsWith:function(t,e){return jn($n.$startsWith)(t,e)},$in_endsWith:function(t,e){return jn($n.$endsWith)(t,e)},$in_regexp:function(t,e){return jn($n.$regexp)(t,e)},$contains:function(t,e){var n=""+t;return 0===n.length||-1!==(""+e).indexOf(n)},$exclude:function(t,e){return!$n.$contains(t,e)},$startsWith:function(t,e){var n=""+t;return 0===n.length||0===(""+e).indexOf(n)},$endsWith:function(t,e){var n=""+e,r=""+t;return 0===r.length||n.length>=r.length&&n.indexOf(r)===n.length-r.length},$regexp:function(t,e){return new RegExp(t).test(e)},$not_regexp:function(t,e){return!new RegExp(t).test(e)},$any:function(t,e){return!r.isArray(e)||!r.isEmpty(e)},$none:function(t,e){return r.isArray(e)&&r.isEmpty(e)},$after:function(t,e){return Date.now()-e>=1e3*t.interval},$eq:function(t,e){return t===e},$neq:function(t,e){return t!==e},$gt:function(t,e){return e>t},$lt:function(t,e){return e<t},$gte:function(t,e){return e>=t},$lte:function(t,e){return e<=t},$between:function(t,e){var n=null===t.min?-1/0:t.min,r=null===t.max?1/0:t.max;return e>=n&&e<=r}};function An(t,e,n){return void 0===n&&(n=Dn),e[t.field]&&r.contains(nn[t.field],t.operator)?function(r){var i=n[t.field]?n[t.field](t.value):t.value,o=e[t.field](t);r({result:(0,$n[t.operator])(i,o),final:!0})}:function(t){t({result:!1,final:!0})}}function Nn(t,e,n){if(!t)return n;if(!t.field){if(t.nodes){return function(t,e){var n=t.nodes.map(e);switch(t.operator){case"$and":return function(t){return r.every(n,(function(e){return e(t)}))};case"$or":return function(t){return r.some(n,(function(e){return e(t)}))};default:return function(t){t({result:!1,final:!0})}}}(t,(function(t){return Nn(t,e,n)}))}return n}var i=$n[t.operator],o=t.value,a=e[t.field];return a?function(t){return i(o,a(t))}:Ge}var Ln=[];Ue("destroy",(function(){Ln=[]})),window.PopMechanicAddToCart=function(){Ln.forEach((function(t){t()}))};var Bn={$count:function(t){return function(e){return e.reduce((function(e,n){return t(n)?e+(n.quantity||1):e}),0)}},$countDistinct:function(t){return function(e){for(var n=0,r={},i=0;i<e.length;i++){var o=e[i];t(o)&&!r[o.id]&&(r[o.id]=!0,n++)}return n}},$countNot:function(t){return function(e){return e.reduce((function(e,n){return t(n)?e:e+1}),0)}},$priceSum:function(t){return function(e){return e.reduce((function(e,n){return t(n)?e+(n.priceWithDiscount||n.price)*(n.quantity||1):e}),0)}},$anyOf:function(t){return function(e){return r.some(e,t)}},$noneOf:function(t){return function(e){return!r.some(e,t)}},$every:function(t){return function(e){return r.every(e,t)}}};function qn(t){return!!t&&r.isObject(t)&&r.isFinite(t.price)&&!!t.id}var Wn={productPrice:r.property("price"),productPriceWithDiscount:r.property("priceWithDiscount"),productDiscount:function(t){return t.price>t.priceWithDiscount?(t.price-t.priceWithDiscount)/t.price:0},productId:function(t){return t&&t.id?t.id.toString():""},productName:r.property("name"),productCategoryId:function(t){return t&&t.categoryId?t.categoryId.toString():""},productBrandName:r.property("brand")};function Xn(t,e,n){return void 0===n&&(n=Dn),e[t.field]&&r.contains(nn[t.field],t.operator)?function(r){var i=e[t.field](t),o=n[t.field]?n[t.field](t.value):t.value,a=$n[t.operator];function s(){var n=e[t.field](t);Promise.all([Promise.resolve(o),Promise.resolve(n)]).then((function(t){var e=a(t[0],t[1]);r({result:e,final:!1})}))}var c=setInterval(s,3e5);return"object"==typeof o&&"function"==typeof o.then||"object"==typeof i&&"function"==typeof i.then?(s(),null):function(){clearInterval(c)}}:function(t){t({result:!1,final:!0})}}var Un={form_seen:we.getLastShown,form_completed:we.getCompleted,form_uncompleted:we.getUncompleted};function Vn(t){return t||null===t}function Hn(t){if(!Un.hasOwnProperty(t.field))return function(t){t({result:!1,final:!0})};if("$after"!==t.operator&&"$never"!==t.operator)return function(t){t({result:!1,final:!0})};var e=t.value.forms;return"$any"===e?function(e){var n=setInterval((function(){var n=function(t){var e=(0,Un[t.field])();return"$never"===t.operator?null===e:"form_seen"===t.field&&null===e||null!==e&&Date.now()-e>=1e3*t.value.interval}(t);e({result:n,final:!1})}),1e3);return function(){clearInterval(n)}}:r.isArray(e)?function(e){var n=setInterval((function(){var n=function(t){var e=Un[t.field],n=t.value.forms,i=1e3*t.value.interval,o=Date.now(),a=r.chain(n).map(e).map((function(t){return null===t?null:o-t>=i})).value();return"$never"===t.operator?r.every(a,r.isNull):"form_seen"===t.field?r.every(a,Vn):0!==a.length&&r.every(a)}(t);e({result:n,final:!1})}),1e3);return function(){clearInterval(n)}}:function(t){t({result:!1,final:!0})}}function Gn(t){this._successHandlers=[],this._errorHandlers=[],this._runningTimeout=500,this._fetchData=t,this.items=[],this.isRunning=!1}function zn(t){this._batchRunningTimeout=500,this._fetchData=t,this._batches=[]}Gn.prototype.addItem=function(t){var e=this;return new Promise((function(n,r){var i=e;i.items.push(t),i._successHandlers.push(n),i._errorHandlers.push(r)}))},Gn.prototype.removeItem=function(t){this.items=r.filter(this.items,(function(e){return e.id!==t}))},Gn.prototype.run=function(){var t=this;return t.isRunning=!0,t._fetchData(t.items).then((function(e){t.isRunning=!1,r.forEach(t._successHandlers,(function(t){return t(e)}))})).catch((function(e){t.isRunning=!1,r.forEach(t._errorHandlers,(function(t){return t(e)}))}))},zn.prototype.addItem=function(t){var e=this,n=e._getIsNotRunningBatch();return n||(n=new Gn(e._fetchData),e._batches.push(n),setTimeout((function(){n&&n.run().then((function(){e._removeBatch(n)}))}),e._batchRunningTimeout)),n.addItem(t)},zn.prototype._getIsNotRunningBatch=function(){return r.find(this._batches,(function(t){return!t.isRunning}))},zn.prototype._removeBatch=function(t){this._batches=r.filter(this._batches,(function(e){return t!==e}))},zn.prototype.removeItem=function(t){this._batches=r.forEach(this._batches,(function(e){e.removeItem(t)}))},zn.prototype.removeItems=function(t){this._batches=r.forEach(this._batches,(function(e){r.forEach(t,(function(t){return e.removeItem(t)}))}))};var Jn={noMindboxTracker:"NoMindboxTracker"},Kn=new zn((function(t){return new Promise((function(e,n){ln.getMindboxIsReadyPromise().then((function(){window.mindbox||n({type:Jn.noMindboxTracker});var i=r.chain(t).map(r.property("segmentationId")).uniq().map((function(t){return{ids:{externalId:t}}})).value();i.length?window.mindbox("sync",{operation:t[0].operation,data:{segmentations:i},onSuccess:e,onError:n}):e({customerSegmentations:[]})}))}))})),Qn=function(t){var e=null;return{promise:new Promise((function(n,r){return e=n,Kn.addItem({id:t.id,segmentationId:t.segmentationId,operation:t.operation}).then((function(e){return{customerSegmentation:e.customerSegmentations&&e.customerSegmentations.find((function(e){return e.segmentation.ids.externalId===t.segmentationId}))}})).then(n).catch(r)})),cancel:function(){Kn.removeItem(t.id),e&&e({cancelled:!0})}}},Yn=/4\d{2}/;function Zn(t,e,n){return void 0===n&&(n=Dn),e[t.field]&&r.contains(nn[t.field],t.operator)?function(r){var i=Promise.resolve(n[t.field]?n[t.field](t.value):t.value),o=Promise.resolve(e[t.field](t)),a=$n[t.operator];return Promise.all([i,o]).then((function(t){return a(t[0],t[1])})).catch(Ge).then((function(t){r({result:t,final:!0})})),null}:function(t){t({result:!1,final:!0})}}var tr=window.queueMicrotask;function er(t,e,n){var r={result:!1,final:!1},i=ze;function o(i){null===i&&(i={result:!1,final:!1}),"boolean"==typeof i&&(i={result:i,final:!1}),r.final||r.result===i.result&&r.final===i.final||(r.result=i.result,r.final=i.final,tr((function(){!function(t,e,n){if(window.PopMechanic.debugMode)try{window.postMessage({source:Bt.CSS_PREFIX+"script",type:"NEW_TARGETING_CONDITION_VALUE_CHANGED",data:{clientId:window.PopMechanic.client,form:t&&t.id,condition:e.source?JSON.parse(e.source):e.id,value:n.result,isFinal:n.final}},"*")}catch(t){}}(e,t,r),n(r.result)})))}try{var a=t(o,e);i="function"==typeof a?a:ze}catch(t){console.error(t),o({result:!1,final:!0})}return{id:t.id,getValue:function(){return r},cancel:i}}function nr(t){return r.every(t,(function(t){return!!t.result}))}function rr(t){return r.any(t,(function(t){return!!t.result}))}function ir(t,e,n,i,o,a){if(!r.isArray(t.nodes)||"$or"!==t.operator&&"$and"!==t.operator)return function(t){t({result:!1,final:!0})};if(0===t.nodes.length)return function(t){t({result:!0,final:!0})};var s="$or"===t.operator?rr:nr;return function(c,u){var l=!1,f=t.nodes.map((function(d){return er(Xr(d,e,n,i,o,a),u,(function(){l||(l=!0,tr((function(){var e=function(){var e=f.map((function(t){return t.getValue()}));if("$or"===t.operator&&r.any(e,Je))return p(),{result:!0,final:!0};if("$and"===t.operator&&r.any(e,Ke))return p(),{result:!1,final:!0};return{result:s(e),final:r.every(e,"final")}}();c(e),l=!1})))}))})),d=!1;function p(){d||(tr((function(){d=!1,f.forEach((function(t){t.cancel()}))})),d=!0)}return p}}"function"!=typeof tr&&(tr=function(t){Promise.resolve().then(t).catch((function(t){return setTimeout((function(){throw t}))}))});var or={$any:"$any",$none:"$none",$in:"$eq",$nin:"$neq",$in_contains:"$contains",$in_startsWith:"$startsWith",$in_endsWith:"$endsWith",$in_regexp:"$regexp"},ar={$any:"$or",$none:"$or",$in:"$or",$nin:"$and",$in_contains:"$or",$in_startsWith:"$or",$in_endsWith:"$or",$in_regexp:"$or"};function sr(t){return function(e,n,i){var o;return r.contains(nn[e.field],e.operator)?r.isArray(e.value)?(o=r.map(e.value,(function(t,n){return{id:e.id+"["+n+"]",field:e.field,value:t,operator:or[e.operator]}})),ir({id:e.id,name:"pageCondition#"+e.id,operator:ar[e.operator],nodes:o},n,i)):t(e,n,i):function(t){t({result:!1,final:!0})}}}var cr=function(t){ln.getMindboxIsReadyPromise().then((function(){if(!window.mindbox)return{type:"NoMindboxTracker"};window.mindbox("personalization.invokeWithPageData",t),window.mindbox("personalization.registerOnPageChangeCallback",t)}))},ur=function(){return new Promise((function(t,e){cr((function(n){n&&("NoMindboxTracker"===n.type&&e(n),t(n))}))})).then((function(t){return t.cart||[]})).catch((function(){return[]}))},lr=function(){return new Promise((function(t,e){cr((function(n){n&&("NoMindboxTracker"===n.type&&e(n),"unknown"!==n.type&&t(n))}))}))},fr=function(){return new Promise((function(t){lr().then(t).catch((function(){t(null)}))}))};function dr(t){var e=function(t){return r.keys(t)[0]||null}(t);return e?t[e].toString():""}function pr(t,e){return r.chain(t).keys().some((function(n){return(e[n]&&e[n].toString())===t[n].toString()})).value()}function hr(t,e){return t.product&&e.product?pr(t.product.ids,e.product.ids):!(!t.productGroup||!e.productGroup)&&pr(t.productGroup.ids,e.productGroup.ids)}function mr(t){return t.product?t.product.ids:t.productGroup?t.productGroup.ids:null}function gr(t){if(!t)return null;var e=t.product?r.pick(t,"product"):t.productGroup?r.pick(t,"productGroup"):null;return function(t){if(!t)return!1;var e=t.product||t.productGroup;return!!e&&!(!e||!e.ids||r.isEmpty(e.ids))}(e)?e:null}var vr={$exists:function(t,e){var n=t.segment;return"$any"===n?!!e:"$none"===n?!e:n.externalId===e},$not_exists:function(t,e){var n=t.segment;return"$any"===n?!e:"$none"===n?!!e:n.externalId!==e}};function _r(t){return function(e,n,r,i){return vr[e.operator]?function(n,r){var o=t(e.id+"."+r.id,i,e.value.segmentation.externalId);return o.promise.then((function(t){return vr[e.operator](e.value,t)})).catch(Ge).then((function(t){n({result:t,final:!0})})),function(){o.cancel&&o.cancel()}}:function(t){t({result:!1,final:!0})}}}var yr={_segments:[],get:function(t,e){return r.find(this._segments,(function(n){return n.segmentationId===e&&hr(n.productItem,t)}))},set:function(t){var e=t.productItem,n=t.segmentationId,i=t.segmentId,o=t.ts,a=r.filter(this._segments,(function(t){return!(t.segmentationId===n&&hr(t.productItem,e))}));a.push({productItem:e,segmentationId:n,segmentId:i,ts:o}),this._segments=a},clear:function(){this._segments=[]}};Ue("destroy",(function(){yr.clear()}));var wr={_initDelay:200,_interval:2e3,_items:[],_batches:[],_isRunning:!1,addItem:function(t){wr._items.push(t),wr._isRunning||(wr._isRunning=!0,setTimeout((function(){wr._run()}),wr._initDelay))},cancelItem:function(t){wr._items=r.filter(wr._items,(function(e){return e.id!==t}))},_hasNotProcessedProductItemSegmentation:function(t){return!r.some(wr._batches,(function(e){return r.some(e,(function(e){return br(t,e)}))}))},_getNotProcessedItems:function(){return r.filter(wr._items,(function(t){return wr._hasNotProcessedProductItemSegmentation(t.productItemSegmentation)}))},_hasNotProcessedItems:function(){return r.some(wr._items,(function(t){return wr._hasNotProcessedProductItemSegmentation(t.productItemSegmentation)}))},_run:function(){wr._isRunning=!0;var t=[],e=[],n=[];if(r.forEach(wr._getNotProcessedItems(),(function(i){var o,a=r.find(t,(function(t){return hr(t,i.productItemSegmentation.productItem)})),s=r.find(e,(function(t){return t.ids.externalId==i.productItemSegmentation.segmentationId})),c=!a&&t.length<50,u=!s&&e.length<10;(c||a)&&(u||s)&&(c&&t.push((o=i.productItemSegmentation.productItem,r.mapObject(o,(function(t){return{ids:r.mapObject(t.ids,(function(t){return r.isNull(t)||r.isUndefined(t)?t:t.toString()}))}})))),u&&e.push({ids:{externalId:i.productItemSegmentation.segmentationId}}),n.push(i.productItemSegmentation))})),n.length){var i=[],o=[];r.forEach(t,(function(t){t.product&&i.push(t.product),t.productGroup&&o.push(t.productGroup)})),wr._batches.push(n),window.mindbox("helpers.checkProductSegments",{products:i,productGroups:o,segmentations:e,onSuccess:function(i){var o,a,s,c,u=(o=t,a=e,s=i,c=+Date.now(),o.reduce((function(t,e){var n=s.find((function(t){return hr(t,e)}))||{productItem:e,segmentations:[]};return a.forEach((function(r){var i=n.segmentations.find((function(t){return t.ids.externalId===r.ids.externalId}));t.push({productItem:e,segmentationId:r.ids.externalId,segmentId:i&&i.segment&&(i.segment.externalId||i.segment.ids&&i.segment.ids.externalId)||null,ts:c})})),t}),[]));We.remove((function(t){return!t.productItem||!!r.find(u,(function(e){return br(t,e)}))})).then((function(){return We.push(u)}),(function(){return We.push(u)})),r.forEach(n,(function(t,e){for(var n=wr._items.length-1,i=function(){var i=wr._items[n];if(br(t,i.productItemSegmentation)){var o=r.find(u,(function(t){return br(t,i.productItemSegmentation)}));i.onSuccess(o),wr._items.splice(n,1)}wr._batches.splice(e,1),n-=1};n>=0;)i()})),wr._batches=r.filter(wr._batches,(function(t){return!!t.length}))}})}wr._hasNotProcessedItems()?setTimeout((function(){wr._run()}),wr._interval):wr._isRunning=!1}};function br(t,e){return hr(t.productItem,e.productItem)&&t.segmentationId===e.segmentationId}var Sr,kr,xr=function(t){var e=r.map(t.productItemSegmentations,(function(e,n){var r=null,i=new Promise((function(t){r=t}));return{id:t.id+"["+n+"]",productItemSegmentation:e,onSuccess:r,promise:i}}));return{promise:new Promise((function(t){r.forEach(e,(function(t){return wr.addItem(t)})),Promise.all(r.map(e,(function(t){return t.promise}))).then(t)})),cancel:function(){r.forEach(e,(function(t,e){wr.cancelItem(t.id+"["+e+"]")}))}}},Ir=function(t,e,n){var r={promise:Promise.resolve(null),cancel:null},i=yr.get(e,n);return void 0!==i&&+Date.now()-i.ts<864e5?(r.promise=Promise.resolve(i.segmentId),r):(r.promise=We.find((function(t){return hr(t.productItem,e)&&t.segmentationId===n}),+Date.now()-864e5).then((function(i){if(i)return i.segmentId;var o=xr({id:t,productItemSegmentations:[{productItem:e,segmentationId:n}]});return r.cancel=o.cancel,o.promise.then((function(t){var r=t[0],i=r?r.segmentId:null;return yr.set({productItem:e,segmentationId:n,segmentId:i,ts:r.ts}),i}))})),r)},Pr={aggregators:{$exists:function(t,e){lr().then((function(n){var r=gr(n);if(r)return e(r).then(t);t({result:!1,final:!0})})).catch((function(e){"NoMindboxTracker"===e.type&&t({result:!1,final:!0})}))},$not_exists:function(t,e){lr().then((function(n){var r=gr(n);if(r)return e(r).then((function(e){t({result:!e.result,final:e.final})}));t({result:!0,final:!0})})).catch((function(e){"NoMindboxTracker"===e.type&&t({result:!1,final:!0})}))}},getFieldValues:function(t){return{productId:function(){var e=mr(t);return e&&dr(e)||""}}},fieldCheckers:{mindboxProductSegment:_r(Ir)}},Er=new Promise((function(t){Sr=t})),Cr=new Promise((function(t){kr=t}));var Tr=Ne((function(t){return void 0===t&&(t=10),De?new Promise((function(e){var n=[];De.transaction("h").objectStore("h").openCursor(null,["prev"]).onsuccess=function(i){var o=i.target.result;if(o){var a=o.value.productItem;if(a)!r.find(n,(function(t){return hr(a,t)}))&&n.push(a);n.length>=t&&e(n),o.continue()}else e(n)}})):Promise.reject()})),Rr=ln.waitPromisesOrDelay([fr()]),Or={isInitialized:!1,items:[]};Ue("destroy",(function(){Or={isInitialized:!1,items:[]}}));var Fr=function(t){n.exports.forEach(t,(function(t){yr.set({productItem:t.productItem,segmentationId:t.segmentationId,segmentId:t.segmentId,ts:t.ts})}))},Mr=function(){return Or.isInitialized?Promise.resolve(null):Tr(10).then((function(t){Or.items=t}))},Dr={aggregators:{$exists:function(t,e,n,r){r.productItem?e(r.productItem).then(t):t({result:!1,final:!0})},$not_exists:function(t,e,n,r){r.productItem?e(r.productItem).then((function(e){t({result:!e.result,final:e.final})})):t({result:!0,final:!0})}},getFieldValues:function(t){return{productId:function(){var e=mr(t);return e&&dr(e)||""}}},fieldCheckers:{mindboxProductSegment:_r((function(t,e,r){var i={promise:Promise.resolve(null),cancel:null};return i.promise=Rr.then(Mr).then((function(){var o=function(t,e){return n.exports.filter(t,(function(t){var n=yr.get(t,e);return!(n&&+Date.now()-n.ts<864e5)}))}(Or.items,r);if(o.length){var a=function(t,e,r){var i={promise:Promise.resolve(),cancel:null};return e.length&&(i.promise=We.filter((function(t){return t.segmentationId===r&&!!n.exports.find(e,(function(e){return hr(t.productItem,e)}))}),+Date.now()-864e5).then((function(o){var a=n.exports.filter(e,(function(t){return!n.exports.find(o,(function(e){return hr(t,e.productItem)}))}));if(Fr(o),a.length){var s=xr({id:t,productItemSegmentations:n.exports.map(a,(function(t){return{productItem:t,segmentationId:r}}))});return i.cancel=s.cancel,s.promise.then(Fr)}return Promise.resolve(null)}))),i}(t,o,r);return i.cancel=a.cancel,a.promise.then((function(){return yr.get(e,r).segmentId}))}return yr.get(e,r).segmentId})),i}))}};function jr(t,e,n,i){return i&&"$in"===t.operator?function(e){return e({result:r.some(t.value,(function(t){var e={};return e[t.externalSystemName]=t.externalId,pr(e,i)})),final:!0}),null}:function(t){t({result:!1,final:!0})}}var $r=function(){return ln.waitPromisesOrDelay([Er,Cr])},Ar={aggregators:{$count:function(t,e,n){$r().then((function(){return Be.count((function(t){return e(t).then(r.property("result"))})).catch((function(){return r.constant(0)})).then((function(e){var r=$n[n.operator]||Ge;t({result:r(n.value,e),final:!0})}))}))},$anyOf:function(t,e){$r().then((function(){return Be.find((function(t){return e(t).then(r.property("result"))})).catch(r.constant(null)).then((function(e){t({result:!!e,final:!0})}))}))},$noneOf:function(t,e){$r().then((function(){return Be.find((function(t){return e(t).then((function(t){return t.result}))})).catch(r.constant(null)).then((function(e){t({result:!e,final:!0})}))}))}},getFieldValues:function(t){return{url:function(){return t.url},productId:function(){return t.product&&t.product.id?t.product.id.toString():""},productName:function(){return t.product&&t.product.name},productCategoryId:function(){return t.product&&t.product.categoryId?t.product.categoryId.toString():""},productBrandName:function(){return t.product&&t.product.brand},productPrice:function(){return t.product&&t.product.price},productPriceWithDiscount:function(){return t.product&&t.product.priceWithDiscount},productDiscount:function(){return t.product&&t.product.price>t.product.priceWithDiscount?100*(t.product.price-t.product.priceWithDiscount)/t.product.price:0},categoryId:function(){return t.category&&t.category.id?t.category.id.toString():""},time_passed:function(e){if("$current_session"===e.value)return t.vst;var n=Date.now();return Math.floor((n-t.ts)/1e3)}}},conditionMappers:{productId:function(t){return t?t.toString():""},productCategoryId:function(t){return t?t.toString():""},categoryId:function(t){return t?t.toString():""},url:function(t){return"$current_url"===t?location.href:t},time_passed:function(t){return"$current_session"===t?Se.get.udata.vst:t}},aggregatedConditions:{mindboxProduct:Dr,mindboxCategory:{aggregators:{$exists:function(t,e,n,r){r.categoryIds?e(r.categoryIds).then(t):t({result:!1,final:!0})},$not_exists:function(t,e,n,r){r.categoryIds?e(r.categoryIds).then((function(e){t({result:!e.result,final:e.final})})):t({result:!0,final:!0})}},fieldCheckers:{mindboxCategoryId:jr},getFieldValues:function(t){return{categoryId:function(){return dr(t)||""}}}}}};function Nr(t){return t.product?r.pick(t,"product"):t.productGroup?r.pick(t,"productGroup"):null}var Lr=function(t,e,n){var i=null,o=r.debounce((function(o){var a=r.uniqueId(t);i=a;e(o,(function(t){i===a&&n(t)}))}),2e3);cr((function(t){t&&("NoMindboxTracker"===t.type&&o(null),t.cart&&o(t.cart))}))};function Br(t){return r.some(t.nodes,(function(t){return!!t.field||Br(t)}))}var qr={mindboxProduct:Pr,mindboxCategory:{aggregators:{$exists:function(t,e){return lr().then((function(n){n&&n.category?e(n.category.ids).then(t):t({result:!1,final:!0})}))},$not_exists:function(t,e){return lr().then((function(n){n&&n.category?e(n.category.ids).then((function(e){t({result:!e.result,final:e.final})})):t({result:!0,final:!0})}))}},fieldCheckers:{mindboxCategoryId:jr},getFieldValues:function(t){return{categoryId:function(){return dr(t)||""}}}},visited_pages:Ar,"visited-pages":Ar,mindboxCart:{aggregators:{$count:function(t,e,n){Lr(n.id,(function(t,i){t||i({result:!1,final:!1});var o=$n[n.operator]||Ge;if(Br(n.filter)){var a=0,s=[];r.forEach(t,(function(t){s.push(e(Nr(t)).then((function(e){e.result&&(a+=t.count)})))})),Promise.all(s).then((function(){i({result:o(n.value,a),final:!1})}))}else{var c=r.reduce(t,(function(t,e){return t+e.count}),0);i({result:o(n.value,c),final:!1})}}),t)},$countDistinct:function(t,e,n){Lr(n.id,(function(t,i){t||i({result:!1,final:!1});var o=$n[n.operator]||Ge;if(Br(n.filter)){var a=0,s=[];r.forEach(t,(function(t){s.push(e(Nr(t)).then((function(t){t.result&&a++})))})),Promise.all(s).then((function(){i({result:o(n.value,a),final:!1})}))}else{var c=r.reduce(t,(function(t){return t+1}),0);i({result:o(n.value,c),final:!1})}}),t)},$priceSum:function(t,e,n){Lr(n.id,(function(t,i){t||i({result:!1,final:!1});var o=$n[n.operator]||Ge;if(Br(n.filter)){var a=0,s=[];r.forEach(t,(function(t){s.push(e(Nr(t)).then((function(e){e.result&&(a+=t.priceOfLine||t.pricePerItem*t.count||0)})))})),Promise.all(s).then((function(){i({result:o(n.value,a),final:!1})}))}else{var c=r.reduce(t,(function(t,e){return t+=e.priceOfLine||e.pricePerItem*e.count||0}),0);i({result:o(n.value,c),final:!1})}}),t)},$anyOf:function(t,e,n){Lr(n.id,(function(t,i){if(t||i({result:!1,final:!1}),!Br(n.filter)&&t.length)i({result:!0,final:!1});else{var o=[];r.forEach(t,(function(t){o.push(e(Nr(t)).then((function(t){return t.result?Promise.reject():Promise.resolve()})))})),Promise.all(o).then((function(){i({result:!1,final:!1})})).catch((function(){i({result:!0,final:!1})}))}}),t)},$noneOf:function(t,e,n){Lr(n.id,(function(t,i){if(t||i({result:!1,final:!1}),Br(n.filter)||t.length){var o=[];r.forEach(t,(function(t){return o.push(e(Nr(t)).then((function(t){return t.result?Promise.reject():Promise.resolve()})))})),Promise.all(o).then((function(){i({result:!0,final:!1})})).catch((function(){i({result:!1,final:!1})}))}else i({result:!0,final:!1})}),t)},$every:function(t,e,n){Lr(n.id,(function(t,i){if(t||i({result:!1,final:!1}),Br(n.filter)){var o=[];r.forEach(t,(function(t){o.push(e(Nr(t)).then((function(t){return t.result?Promise.resolve():Promise.reject()})))})),Promise.all(o).then((function(){i({result:!0,final:!1})})).catch((function(){i({result:!1,final:!1})}))}else i({result:!!t.length,final:!1})}),t)}},fieldCheckers:{mindboxProductSegment:_r(Ir)}}};var Wr={default:An,cart:function(t){if("cart"!==t.field)return function(t){t({result:!1,final:!0})};var e=$n[t.operator]||Ge;return Bn[t.aggregator]?function(n){var r=Nn(t.filter,Wn,qn),i=Bn[t.aggregator](r);function o(){var n=window.PopMechanicCartData;if(!n)return null;var r=i(n.products);return"boolean"==typeof r?r:e(t.value,r)}var a=setInterval((function(){var t=o();null!==t&&(clearInterval(a),n({result:t,final:!1}))}));return Ln.push((function(){setTimeout((function(){var t=o();null!==t&&n({result:t,final:!1})}),1e3)})),function(){clearInterval(a)}}:function(t){t({result:!1,final:!0})}},datetime:Xn,datetime_utc:Xn,day_of_week:Xn,time:Xn,time_utc:Xn,dom_element:function(t){if("$exists"!==t.operator&&"$not_exists"!==t.operator)return function(t){t({result:!1,final:!0})};var e=-1!==(""+t.value).indexOf(":visible"),n=(""+t.value).replace(/:visible/g,"");return function(r){var i=setInterval((function(){var i=O(n);e&&(i=i.filterVisible()),"$exists"===t.operator&&r({result:i.length>0,final:!1}),"$not_exists"===t.operator&&r({result:0===i.length,final:!1})}),1e3),o=function(){clearInterval(i),Ve("destroy",o)};return Ue("destroy",o),o}},js:function(t){if(!r.contains(nn[t.field],t.operator))return function(t){t({result:!1,final:!0})};try{var e=new Function(t.value)}catch(t){return function(t){t({result:!1,final:!0})}}return function(t){var n=null;try{n=e()}catch(e){return console.error("$exec error",e),void t({result:!1,final:!0})}Promise.resolve(n).then((function(e){t({result:e,final:!0})})).catch((function(){t({result:!1,final:!0})}))}},form_completed:Hn,form_seen:Hn,form_uncompleted:Hn,mindbox_segment:function(t){return"mindbox_segment"!==t.field||"$check"!==t.operator?function(t){t({result:!1,final:!0})}:function(e,n){var r,i=n.id,o=t.value,a=o.operation,s=o.segmentation,c=o.inSegment,u=o.inSegmentByDefault,l=o.segment,f="string"==typeof s?s:s.externalId,d=(r=f,["deviceUUID:"+window.PopMechanic.mindboxDeviceUUID,"customer","segmentation:"+r].join(".")),p=we.get(d),h=function(t){return!!t&&("$any"===l||t.ids.externalId===l.externalId)},m=function(t){return{result:h(t)===c,final:!0}};if(!(p&&Date.now()-p.ts<6e4)){var g=i+"."+t.id,v=Qn({id:g,segmentationId:f,operation:a});return v.promise.then((function(t){if(!t.cancelled){var n=t.customerSegmentation&&t.customerSegmentation.segment;we.set(d,{ts:Date.now(),segment:n}),e(m(n))}})).catch((function(t){if(Yn.test(t.statusCode))return we.set(d,{ts:Date.now(),segment:void 0}),void e(m(void 0));e({result:u===c,final:!0})})),Ue("destroy",(function(){v.cancel()})),function(){v.cancel()}}e(m(p.segment))}},google_optimize:Zn,visited_url:Zn,country:Zn,region:Zn,city:Zn,page:sr(An),productId:sr(Zn),productName:sr(Zn),productCategoryId:sr(Zn),productBrandName:sr(Zn),productPrice:Zn,productPriceWithDiscount:Zn,productDiscount:Zn,categoryId:sr(Zn),time_passed:Zn,url:sr(An)};function Xr(t,e,r,i,o,a){void 0===e&&(e=Mn),void 0===r&&(r=Dn),void 0===i&&(i=qr),void 0===o&&(o=void 0),void 0===a&&(a=Wr);var s=null;return(s=t.hasOwnProperty("nodes")?ir(t,e,r,i,o,a):t.hasOwnProperty("filter")&&n.exports.includes(n.exports.keys(i),t.field)?function(t,e,r){return void 0===e&&(e=qr),function(i,o){var a=e[t.field],s=a.aggregatedConditions;return a.aggregators[t.aggregator]((function(t){tr((function(){i(t)}))}),(function(e){return new Promise((function(r){var i=er(Xr(t.filter,a.getFieldValues&&a.getFieldValues(e),n.exports.extend({},Dn,a.conditionMappers||{}),s,e,a.fieldCheckers),o,(function(){r(i())})).getValue}))}),t,r),null}}(t,i,o):a.hasOwnProperty(t.field)?a[t.field](t,e,r,o):Wr.default(t,e,r,o)).id=t.id,window.PopMechanic.debugMode||(s.source=JSON.stringify(t)),s}function Ur(t,e,n){return new Promise((function(r){t||r((function(){return"function"==typeof n&&tr((function(){n(!0)})),{result:!0,final:!0}}));var i=er(Xr(t),e,(function(t){"function"==typeof n&&n(t),r(i)})).getValue}))}var Vr={};Ue("destroy",(function(){Vr={}}));var Hr={init:Ur,check:function(t,e,n){if(Vr.hasOwnProperty(e.id))return Vr[e.id];var r=Promise.resolve(Ur(t,e,n)).then((function(t){return t().result})).catch((function(t){throw console.error("checkTargeting error:",t),t}));return Vr[e.id]=r,r}};function Gr(t,e){return Hr.check(t&&t.newTargeting&&t.newTargeting.filter,t,e)}var zr={check:function(t,e){return t.isEmbedded()||t.isStatic()?Gr(t,e):t.isAlways()?Promise.resolve(!0):Gr(t,e)}},Jr=Yt({__constructor:function(t,e){void 0===e&&(e={}),this.formId=t.form.id,this.onBeforeRenderRejectIsDebuggable=!0,this._dependencies=e,this._device=te.mobile()?"mobile":te.tablet()?"tablet":"desktop",this._getDeviceSettings=this._getDeviceSettings.bind(this)},_dependencies:{},_device:null,_getContainer:function(t){return t.filter("."+Bt.CSS_PREFIX+"js-container")},_getForm:function(t){return this._getContainer(t).find("#"+Bt.CSS_PREFIX+"form-"+this.formId)},_filterForm:function(t){return t.filter("#"+Bt.CSS_PREFIX+"form-"+this.formId)},_runAnimation:function(t,e,n){t.addClass(Bt.CSS_PREFIX+e).addClass(Bt.CSS_PREFIX+"animated").addClass(Bt.CSS_PREFIX+"fastest"),setTimeout((function(){return t.removeClass(Bt.CSS_PREFIX+"animated").removeClass(Bt.CSS_PREFIX+"fastest").removeClass(Bt.CSS_PREFIX+e),"function"==typeof n&&n()}),Bt.ANIMATION_SPEED)},_getDeviceSettings:function(t){return t[this._device]?t[this._device]:t.desktop?t.desktop:t||{}},getSettings:function(){},onTargetingReady:function(){},onBeforeRender:function(){},onRender:function(){},shouldRender:function(){return!0},onShow:function(){},onBeforeClose:function(){},onClose:function(){},onSuccess:function(){},onFail:function(){},onInit:function(t){}}),Kr=Yt(Jr,{}),Qr=Yt(Jr,{__constructor:function(t){this.__base(t),this.initAt=window.PopMechanic.initAt},onInit:function(t){var e=t.form;O("body").on("click","[data-"+Bt.CSS_PREFIX+'call-form="'+e.id+'"]',(function(){("ignore_targeting"===e.conditions.conditions.only_forced||e.inTargeting)&&t.show(!0)}))},onTargetingReady:function(t){var e=this,n=t.form;n.checkConditions().then((function(n){n&&e.initAt===window.PopMechanic.initAt&&t.show()})).catch((function(t){console.error("conditions error in form#"+n.id,t)}))}}),Yr=[],Zr=function(t,e){Yr=r.union(Yr,[{id:t,allowOverlay:e}])},ti=function(t){var e=Yr.find((function(e){return e.id===t}));Yr=r.without(Yr,e)},ei=function(){return Yr.length>0},ni=function(){return Yr.some((function(t){return!t.allowOverlay}))},ri={top:"fadeInUp",bottom:"fadeInDown",left:"fadeInLeft",right:"fadeInRight"},ii={top:"fadeOutUp",bottom:"fadeOutDown",left:"fadeOutLeft",right:"fadeOutRight"};var oi,ai=Yt(Qr,{__constructor:function(t){this.__base(t),this.settings=r.defaults({},t.form.settings.behavior_settings.banner,{position:"bottom",allow_overlay:!0,offset:0}),this.settings.animation_in||(this.settings.animation_in=ri[this.settings.direction]),this.settings.animation_out||(this.settings.animation_out=ii[this.settings.direction]),this.staticStyles=function(t){return"top"===t.position?{top:0,left:0,right:0,"margin-top":t.offset}:"bottom"===t.position?{bottom:0,left:0,right:0,"margin-bottom":t.offset}:"left"===t.position?{left:0,top:0,bottom:0,"margin-left":t.offset}:"right"===t.position?{right:0,top:0,bottom:0,"margin-right":t.offset}:{}}(this.settings)},shouldRender:function(){return!ni()&&!(ei()&&!this.settings.allow_overlay)},onRender:function(t,e,n){if(!this.shouldRender())return Promise.reject();Zr(this.formId,this.settings.allow_overlay);var i=this._filterForm(t),o=O('<div class="'+Bt.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=o,n.append(o);var a={display:"block","z-index":100000002,position:"fixed","text-align":"left"};r.extend(a,this.staticStyles),o.css(a),i.css({position:"relative",width:"100%",height:"100%"})},onShow:function(t,e){var n=this._getForm(t);this._$formWrapper.append(n),this._runAnimation(n,this.settings.animation_in),n.find("."+Bt.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){e.close(O(this).data("popmechanic-close"))}))},onClose:function(t){var e=this;ti(e.formId);var n=this._getForm(t);return new Promise((function(r){e._runAnimation(n,e.settings.animation_out,(function(){t.css({position:"static",height:0,"min-height":0}),r()}))}))},onSuccess:function(){},onFail:function(){}}),si={on:!1,positions:{mobile:{},tablet:{},desktop:{}},show_before:!0},ci=Yt(Jr,{onInit:function(t){this.sessionKey=t.form.id+".button-hidden";var e=r.defaults({},t.form.settings.behavior_settings.button,si);this.behavior_settings=e,this.form=t.form,this.isFormOpened=!1,e.on&&(this.showForm=function(){t.form.report("click"),t.show(!0)},we.get(this.sessionKey)||("always"===this.behavior_settings.conditions&&(this._render(),this._$button.show()),"on_close"===this.behavior_settings.conditions&&this.form.inTargeting&&this._render()))},_getSettings:function(){var t=O.extend({},this.form.settings.settings,this.form.settings.button_settings);return O.extend({},t,{desktop:te.desktop(),tablet:te.tablet(),mobile:te.mobile()})},_getButtonTemplate:function(){var t=this.form.button_template;return this.form.settings.button_html&&(t.html=this.form.settings.button_html),this.form.settings.button_css&&(t.css=this.form.settings.button_css),t},_render:function(){var t=this;if(!t._$button||!t._$style){var e,n=null,i=t._getSettings(),o=t._getButtonTemplate();try{e=O(pe(r.template(o.html)(i),t.form.id))}catch(t){return}try{n=O("<style>"+le(r.template(o.css)(i),t.form.id)+"</style>")}catch(t){return}var a=r.defaults({zIndex:100000002},t._getDeviceSettings(t.behavior_settings.positions));e.css(a),e.css({position:"fixed"}),e.hide(),t._$button=e,t._$style=n,t._$button.show=function(){this[0].style.display=""},e.on("click",(function(){t.showForm()})),e.find("[data-popmechanic-close-button]").on("click",(function(n){e.hide(),we.set(t.sessionKey,!0),n.stopPropagation()})),se(t.form.id).append(t._$button).append(t._$style)}},onTargetingReady:function(){var t=this;t.behavior_settings.on&&"targeting"===t.behavior_settings.conditions&&(t._render(),t.form.inTargeting&&t._$button.show(),t.form.onTargetingChange((function(e){"targeting"===t.behavior_settings.conditions&&(e&&!t.isFormOpened?t._$button.show():t._$button.hide())})))},onShow:function(){this.behavior_settings.on&&(this.isFormOpened=!0,this._render(),this._$button.hide())},onClose:function(){this.behavior_settings.on&&(this.isFormOpened=!1,(this.form.inTargeting||"always"===this.behavior_settings.conditions||"on_close"===this.behavior_settings.conditions)&&this._$button.show())},onSuccess:function(){this.behavior_settings.on&&(this._$button.detach(),this._$style.detach())}}),ui=Yt(Jr,{__constructor:function(t){this.__base(t),this.successText="Скопировано!"},onShow:function(t,e){try{var n=this;this.$elem=t;var i=t[0].querySelectorAll("[data-"+Bt.CSS_PREFIX+"copy]");r.forEach(i,(function(t){t.addEventListener("click",n._getHandleCopy(e))}))}catch(t){}},_getHandleCopy:function(t){var e=this,n=e.successText;return function(r){r.preventDefault();var i=this;try{var o=this.dataset[Bt.DATASET_PREFIX+"Copy"],a=e.$elem.find("[data-"+Bt.CSS_PREFIX+'copy-source="'+o+'"]').text()||"";if(a=a.trim(),navigator.clipboard)navigator.clipboard.writeText(a.trim()).then((function(){i.innerHTML=n,He("copyCode",{form:t.form})}));else{var s=document.createElement("textarea");s.value=a,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s),s.select(),s.setSelectionRange(0,a.length+1),document.execCommand("copy"),document.body.removeChild(s),i.innerHTML=n,He("copyCode",{form:t.form})}}catch(t){}}}}),li=function(t){var e=t.$element,n=t.$target,r=t.placement,i="#"+e[0].id;switch(r){case"before":var o=n.prev();o&&O(o).is(i)&&o.remove(),n.before(e);break;case"after":var a=n.next();a&&O(a).is(i)&&a.remove(),n.after(e);break;case"start":var s=n.children()[0];s&&O(s).is(i)&&s.remove(),n.prepend(e);break;default:case"end":var c=n.children(),u=n.children()[c.length-1];u&&O(u).is(i)&&u.remove(),n.append(e)}},fi=Yt(Jr,{__constructor:function(t){this.__base(t);var e=t.form.settings.behavior_settings.embedded||{},n=this._getDeviceSettings(e);this.settings=r.defaults({},n,e,{animation_out:"fadeOut"})},onShow:function(t,e,n){var r=this._getForm(t);li({$element:t,$target:n,placement:e.placement}),r.find("."+Bt.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){e.close(O(this).data("popmechanic-close"))}))},onClose:function(t){var e=this,n=e._getForm(t);return new Promise((function(t){e._runAnimation(n,e.settings.animation_out,(function(){t()}))}))},onSuccess:function(){},onFail:function(){}}),di=Yt(Jr,{onRender:function(t,e){return new Promise((function(t){var e=null;e=setInterval((function(){window.FB&&(t(),clearInterval(e))}),100)}))},onShow:function(t,e){var n=t.find("#popmechanic-form-"+e.form.id)[0],r=function(t,n){e.form.report("social-like"),e.success({social:!0,type:e.form.settings.behavior_settings.social.type}),we.setContactsSent(),FB.Event.unsubscribe("edge.create",r)};FB.XFBML.parse(n),FB.Event.subscribe("edge.create",r)}}),pi={},hi=function(){function t(t,e){var n=e.form;pi[n.id]&&pi[n.id](n,n.inTargeting)}function e(t,e){var n=e.form;pi[n.id]&&pi[n.id](n,!1)}Ue("targeting",t),Ue("formClose",e),Ue("destroy",(function(){oi=r.once(hi),Ve("targeting",t),Ve("formClose",e)}))};oi=r.once(hi);var mi=Yt(Jr,{__constructor:function(t){var e=this;this.__base(t);var n=this;n.form=t,this.childrenDisplayQueue=[],this.childForms=t.form.childForms;try{this._onChildReady=new Function("form","child","children",t.form.template.on_child_ready)}catch(t){console.error(t),this._onChildReady=r.identity}this.children=this.childForms.map(window.PopMechanic.getModel).filter(r.identity),this.children.filter((function(t){return t.inTargeting})).forEach((function(t){n.childrenDisplayQueue.push((function(){n.onChildReady(t)}))}));for(var i=function(t){var r=e.children[t],i=r.id;pi[i]=function(t,e){n.childrenDisplayQueue.push((function(){n.onChildReady(r,e)}))}},o=0;o<e.children.length;o++)i(o);oi()},_getAvailableChildren:function(){var t=this.children.filter((function(t){return t.inTargeting})),e=t.map((function(t){return t.checkFrequency()}));return Promise.all(e).then((function(e){return e.map((function(e,n){return e?t[n]:null})).filter((function(t){return!!t}))}))},onChildReady:function(t,e){var n=this;n._getAvailableChildren().then((function(r){var i=r.map((function(t){var e=t.id;return window.PopMechanic.getView(e)}));try{var o=window.PopMechanic.getView(t.id);n._onChildReady(n.form,e?o:null,i)}catch(t){console.error(t)}}))},onTargetingReady:function(t){this.children.forEach((function(t){var e=window.PopMechanic.getView(t.id);e&&!e.isTargetingEventSent&&t.inTargeting&&e.onTargetingReady()}))},onShow:function(){var t=this;setTimeout((function(){for(;t.childrenDisplayQueue.length;){t.childrenDisplayQueue.shift()()}t.childrenDisplayQueue.push=function(t){t()}}),100)}}),gi=Yt(Qr,{__constructor:function(t){this.__base(t);var e=r.defaults({},t.form.settings.behavior_settings.fullscreen||{allow_overlay:!0});this.allowOverlay=e.allow_overlay},_prepareAnimation:function(t){var e={};e["margin-top"]=-Math.max(window.innerWidth,window.innerHeight),t.css(e)},_runAnimation:function(t,e){var n={"margin-top":0};t.animate(n,e)},shouldRender:function(){return!ni()&&!(ei()&&!this.allowOverlay)},onRender:function(t){if(!this.shouldRender())return Promise.reject();Zr(this.formId,this.allowOverlay);var e=this._filterForm(t);e.css({display:"block","z-index":100000002,position:"absolute",margin:"0",top:0,left:0,bottom:0,right:0}),this._prepareAnimation(e)},onShow:function(t,e){var n=this._getForm(t),r=this._getContainer(t),i=this;ne(),setTimeout((function(){r.css({position:"fixed",top:0,left:0,right:0,bottom:0,"text-align":"center",height:"auto",overflow:"auto","z-index":1e8}),i._runAnimation(n,(function(){n.find("."+Bt.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){e.close(O(this).data("popmechanic-close"))})),O(document).on("keyup",(function(t){27==t.keyCode&&e.close()}))}))}),10)},onClose:function(t){ti(this.formId);var e=this._getContainer(t);t.animate({top:"-50%"},(function(){e.css({position:"static",height:0,"min-height":0}),re()}))},onSuccess:function(){},onFail:function(){}}),vi=Yt(Jr,{onShow:function(t,e){t.find("[data-"+Bt.CSS_PREFIX+"stop]").on("click",(function(){e.form.report("stop"),e.close()}))}}),_i=Yt(Jr,{__constructor:function(t){this.__base(t)},onShow:function(t,e){var n=this,r="#zuck-modal-slider-popmechanic-form-"+e.form.id+"-zuck-container",i="[data-"+Bt.CSS_PREFIX+"submit]",o="[data-"+Bt.CSS_PREFIX+"link]";O("body").on("click",r+" "+i+","+r+" "+o,(function(){n._onClick(e)})),t.find(i+", "+o).on("click",(function(){n._onClick(e)}))},_onClick:function(t){t.form.report("follow"),we.setCompleted(t.form.id),He("lead",{form:t.form,lead:{form:t.form.id}})},onBeforeClose:function(t,e,n){n.showSuccess||n.isBeingDestroyed||(He("cancel",{form:e.form.id}),qe.push({type:"info-cancel",form:e.form.id}),we.setUncompleted(e.form.id))}});function yi(t){qe.push({type:t.type,vst:Pe(),ts:Date.now(),form:t.form})}var wi={source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},bi={phone:function(t){return t.replace(/\D/g,"")}},Si=Yt({__constructor:function(t,e){var n=this;if(this.updateDeviceUUID(),this._data=t,this._data.form=this._data.id=e.id,this._data.form_name=e.name,this._sendContactsIntegrations=e.sendContactsIntegrations,e.settings&&(this._data.settings=e.settings.id),e.conditions&&(this._data.conditions=e.conditions.id),this._data.device=te.mobile()?"mobile":te.tablet()?"tablet":"pc",this._data.source=(Se.get.current.typ||"").split("|")[0],"file:"!==location.protocol&&(this._data.url=location.href,this._data.domain=location.hostname),this._data.name){var i=this._data.name.replace(/\s\s/g," ").split(" ");i.length>1?(this._data.first_name=i.shift(),this._data.last_name=i.join(" ")):this._data.first_name=i[0]}this._data.customs=this._data.customs||{},Object.keys(this._data).forEach((function(t){bi[t]&&(n._data[t]=bi[t](n._data[t])),0===t.indexOf("customs.")&&(n._data.customs[t.substr("customs.".length)]=n._data[t],delete n._data[t])})),window.PopMechanic.customs&&r.extend(this._data.customs,window.PopMechanic.customs),e.custom_fields&&e.custom_fields.forEach((function(t){n._data.customs[t.machine_name]||(n._data.customs[t.machine_name]=t.default_value)})),"utm"===this._data.source?Object.keys(wi).forEach((function(t){n._data["utm_"+t]=(Se.get.current[wi[t]]||"").replace("(none)","")})):n._data.utm_source=(Se.get.current[wi.source]||"").replace("(none)","")},send:function(t,e){var n=this;return new Promise((function(r,i){n._sendContactsIntegrations&&n._sendContactsIntegrations.length>0?Promise.all(n._sendContactsIntegrations.map((function(t){return t.sendContacts(n._data)}))).then((function(){r(t(n._data))})).catch((function(t){e(t),i(t)})):O.ajax({url:Bt.CONTACTS_URL+window.PopMechanic.client+"/",type:"POST",data:n.getJSON(),contentType:"application/json; charset=utf-8",success:function(e){r(t(e))},error:function(t,n,r){e(r),i(r)}}),we.setContactsSent()}))},getJSON:function(){return JSON.stringify(this._data)},updateDeviceUUID:function(){window.PopMechanic.mindboxDeviceUUID&&(window.PopMechanic.customs=window.PopMechanic.customs||{},window.PopMechanic.customs.mindboxDeviceUUID=window.PopMechanic.mindboxDeviceUUID)}}),ki=O("body");we.isContactsSent("lead")&&ki.addClass(Bt.CSS_PREFIX+"submitted"),te.mobile()&&ki.addClass(Bt.CSS_PREFIX+"mobile"),te.tablet()&&ki.addClass(Bt.CSS_PREFIX+"tablet"),te.desktop()&&ki.addClass(Bt.CSS_PREFIX+"desktop");var xi=function(t){O("body").addClass(Bt.CSS_PREFIX+t)},Ii=function(t){this.element=t,this.listeners=[]};function Pi(t,e){var n=t.value,r=t.selection,i=r[0],o=r[1];return i!==o?[i,o]:e?[i,Math.min(o+1,n.length)]:[Math.max(i-1,0),o]}function Ei(t){return t}Ii.prototype.listen=function(t,e,n){var r=this,i=e;this.element.addEventListener(t,i,n),this.listeners.push((function(){return r.element.removeEventListener(t,i)}))},Ii.prototype.destroy=function(){this.listeners.forEach((function(t){return t()}))};var Ci=function(){this.now=null,this.past=[],this.future=[]};function Ti(t){return"string"==typeof t}function Ri(t,e,n){var r=null,i=null,o=Array.from(t.value).reduce((function(o,a,s){var c=o+function(t,e,n,r){for(var i="",o=e.length;o<t.length;o++){var a=t[o],s=r.value[o]===a;if(!Ti(a)||a===n&&!s)return i;i+=a}return i}(e,o,a,n),u=e[c.length];return Ti(u)?c+u:a.match(u)?(null===r&&s>=t.selection[0]&&(r=c.length),null===i&&s>=t.selection[1]&&(i=c.length),c+a):c}),"");return{value:o,selection:[null!=r?r:o.length,null!=i?i:o.length]}}function Oi(t,e,n){if(void 0===n&&(n=t),function(t,e){return Array.isArray(e)?t.length<=e.length&&Array.from(t).every((function(t,n){var r=e[n];return Ti(r)?t===r:t.match(r)})):e.test(t)}(t.value,e))return t;var r=Array.isArray(e)?Ri(t,e,n):function(t,e){var n=t.value,r=t.selection,i=r[0],o=r[1],a=i,s=o;return{value:Array.from(n).reduce((function(t,n,r){var c=t+n;return i===r&&(a=t.length),o===r&&(s=t.length),c.match(e)?c:t}),""),selection:[a,s]}}(t,e),i=r.value;return{selection:r.selection,value:Array.isArray(e)?i.slice(0,e.length):i}}function Fi(t,e){if(!Array.isArray(e))return t;var n=t.selection,r=n[0],i=n[1],o=[],a=Array.from(t.value).reduce((function(t,n,a){var s=e[a];return a===r&&o.push(t.length),a===i&&o.push(t.length),Ti(s)&&s===n?t:t+n}),"");return o.length<2&&o.push.apply(o,Array(2-o.length).fill(a.length)),{value:a,selection:[o[0],o[1]]}}Ci.prototype.undo=function(){var t=this.past.pop();t&&this.now&&(this.future.push(this.now),this.updateElement(t,"historyUndo"))},Ci.prototype.redo=function(){var t=this.future.pop();t&&this.now&&(this.past.push(this.now),this.updateElement(t,"historyRedo"))},Ci.prototype.updateHistory=function(t){if(this.now){var e=this.now.value!==t.value,n=this.now.selection.some((function(e,n){return e!==t.selection[n]}));(e||n)&&(e&&(this.past.push(this.now),this.future=[]),this.now=t)}else this.now=t},Ci.prototype.updateElement=function(t,e){this.now=t,this.updateValue(t.value,{inputType:e,data:null}),this.updateSelectionRange(t.selection)};var Mi=function(t,e){this.initialElementState=t,this.maskOptions=e,this.value="",this.selection=[0,0];var n=Oi(t,this.getMaskExpression(t)),r=n.value,i=n.selection;this.value=r,this.selection=i};Mi.prototype.addCharacters=function(t,e){var n=t[0],r=t[1],i=this.value,o=this.getMaskExpression({value:i.slice(0,n)+e+i.slice(r),selection:[n+e.length,n+e.length]}),a={value:i,selection:[n,r]},s=Fi(a,o),c=function(t,e,n){var r=t.value,i=t.selection,o=i[0],a=i[1];return{value:r,selection:"replace"===("function"==typeof n?n({value:r,selection:i}):n)?[o,o+e.length]:[o,a]}}(s,e,this.maskOptions.overwriteMode).selection,u=c[0],l=c[1],f=s.value.slice(0,u)+e+s.value.slice(l),d=u+e.length,p=Oi({value:f,selection:[d,d]},o,a);if(function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return e.every((function(e){var n=e.value,r=e.selection;return n===t.value&&r[0]===t.selection[0]&&r[1]===t.selection[1]}))}(this,p))throw new Error("Invalid mask value");this.value=p.value,this.selection=p.selection},Mi.prototype.deleteCharacters=function(t){var e=t[0],n=t[1];if(e!==n&&n){var r=this.value,i=this.getMaskExpression({value:r.slice(0,e)+r.slice(n),selection:[e,e]}),o={value:r,selection:[e,n]},a=Fi(o,i),s=a.selection,c=s[0],u=s[1],l=Oi({value:a.value.slice(0,c)+a.value.slice(u),selection:[c,c]},i,o);this.value=l.value,this.selection=l.selection}},Mi.prototype.getMaskExpression=function(t){var e=this.maskOptions.mask;return"function"==typeof e?e(t):e};var Di={mask:/^.*$/,preprocessor:Ei,postprocessor:Ei,overwriteMode:"shift"},ji=function(t){function e(e,n){var r=this;t.call(this),this.element=e,this.maskitoOptions=n,this.eventListener=new Ii(this.element),this.options=Object.assign(Object.assign({},Di),this.maskitoOptions),this.conformValueToMask(),this.updateHistory(this.elementState),this.eventListener.listen("keydown",(function(t){var e=t.ctrlKey,n=t.key,i=t.metaKey,o=t.shiftKey;return i&&o&&"z"===n||e&&"y"===n?(t.preventDefault(),r.redo()):(e||i)&&"z"===n?(t.preventDefault(),r.undo()):void 0})),!function(t){return"onbeforeinput"in t}(e)?(this.eventListener.listen("keydown",(function(t){return r.handleKeydown(t)})),this.eventListener.listen("paste",(function(t){var e;return r.handleInsert(t,(null===(e=t.clipboardData)||void 0===e?void 0:e.getData("text/plain"))||"")}))):this.eventListener.listen("beforeinput",(function(t){switch(r.updateHistory(r.elementState),t.inputType){case"historyUndo":return t.preventDefault(),r.undo();case"historyRedo":return t.preventDefault(),r.redo();case"deleteContentBackward":case"deleteWordBackward":case"deleteByCut":return r.handleDelete(t,!1);case"deleteContentForward":case"deleteWordForward":return r.handleDelete(t,!0);case"insertFromDrop":return;case"insertLineBreak":return r.handleEnter(t);case"insertFromPaste":case"insertText":default:return r.handleInsert(t,t.data||"")}})),this.eventListener.listen("input",(function(){r.conformValueToMask(),r.updateHistory(r.elementState)}))}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={elementState:{configurable:!0},isTextArea:{configurable:!0}};return n.elementState.get=function(){var t=this.element;return{value:t.value,selection:[t.selectionStart||0,t.selectionEnd||0]}},n.isTextArea.get=function(){return"TEXTAREA"===this.element.nodeName},e.prototype.destroy=function(){this.eventListener.destroy()},e.prototype.updateSelectionRange=function(t){var e,n,r=t[0],i=t[1];this.element.selectionStart===r&&this.element.selectionEnd===i||null===(n=(e=this.element).setSelectionRange)||void 0===n||n.call(e,r,i)},e.prototype.updateValue=function(t,e){if(void 0===e&&(e={inputType:"insertText",data:null}),this.element.value!==t){var n="undefined"!=typeof window?window:globalThis;this.element.value=t,(null==n?void 0:n.InputEvent)&&this.element.dispatchEvent(new InputEvent("input",Object.assign(Object.assign({},e),{bubbles:!0,cancelable:!0})))}},e.prototype.handleKeydown=function(t){var e,n,r,i,o,a,s,c=t.key;switch(c){case"Backspace":case"Delete":return this.handleDelete(t,"Delete"===c);case"Enter":return this.handleEnter(t)}(n=(e=t).key,r=e.ctrlKey,i=e.metaKey,o=e.altKey,a=r||i||o,s=/^(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])$/.test(n),!a&&"Backspace"!==n&&s)&&this.handleInsert(t,c)},e.prototype.conformValueToMask=function(){var t=function(t,e){var n=Object.assign(Object.assign({},Di),e),r="string"==typeof t?{value:t,selection:[0,0]}:t,i=n.preprocessor({elementState:r,data:""},"validation").elementState,o=new Mi(i,n),a=n.postprocessor(o,r),s=a.value,c=a.selection;return"string"==typeof t?s:{value:s,selection:c}}(this.elementState,this.options),e=t.value,n=t.selection;this.updateValue(e),this.updateSelectionRange(n)},e.prototype.handleDelete=function(t,e){var n={value:this.elementState.value,selection:Pi(this.elementState,e)},r=n.selection,i=r[0],o=r[1],a=this.options.preprocessor({elementState:n,data:""},e?"deleteForward":"deleteBackward").elementState,s=new Mi(a,this.options),c=a.selection,u=c[0],l=c[1];s.deleteCharacters([u,l]);var f=this.options.postprocessor(s,n);if(n.value.slice(0,i)+n.value.slice(o)!==f.value){if(t.preventDefault(),function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return e.every((function(e){return e.value===t.value}))}(n,a,s,f))return this.updateSelectionRange(e?[l,l]:[u,u]);var d=e?"deleteContentForward":"deleteContentBackward";this.updateValue(f.value,{inputType:"inputType"in t?t.inputType:d,data:null}),this.updateSelectionRange(f.selection),this.updateHistory(f)}},e.prototype.handleInsert=function(t,e){var n=this.elementState,r=this.options.preprocessor({data:e,elementState:n},"insert"),i=r.elementState,o=r.data;void 0===o&&(o=e);var a=new Mi(i,this.options);try{a.addCharacters(i.selection,o)}catch(e){return t.preventDefault()}var s=i.selection,c=s[0],u=s[1],l=i.value.slice(0,c)+e+i.value.slice(u),f=this.options.postprocessor(a,n),d=f.value,p=f.selection;l!==d&&(t.preventDefault(),this.updateValue(d,{data:e,inputType:"inputType"in t?t.inputType:"insertText"}),this.updateSelectionRange(p),this.updateHistory({value:d,selection:p}))},e.prototype.handleEnter=function(t){this.isTextArea&&this.handleInsert(t,"\n")},Object.defineProperties(e.prototype,n),e}(Ci),$i=Bt.CSS_PREFIX+"phone-mask",Ai=/\d/;function Ni(t){return t.split("").map((function(t){return"#"===t?Ai:t}))}var Li,Bi,qi,Wi,Xi={testMask:["+"],mask:["+"],stringMask:"+"},Ui=(Li=[{mask:"+247-####"},{mask:"+376-###-###"},{mask:"+971-5#-###-####"},{mask:"+971-#-###-####"},{mask:"+93-##-###-####"},{mask:"+1(268)###-####"},{mask:"+1(264)###-####"},{mask:"+355(###)###-###"},{mask:"+374-##-###-###"},{mask:"+599-###-####"},{mask:"+599-###-####"},{mask:"+599-9###-####"},{mask:"+244(###)###-###"},{mask:"+672-1##-###"},{mask:"+54(###)###-####"},{mask:"+1(684)###-####"},{mask:"+43(###)###-####"},{mask:"+61-#-####-####"},{mask:"+297-###-####"},{mask:"+994-##-###-##-##"},{mask:"+387-##-#####"},{mask:"+387-##-####"},{mask:"+1(246)###-####"},{mask:"+880-##-###-###"},{mask:"+32(###)###-###"},{mask:"+226-##-##-####"},{mask:"+359(###)###-###"},{mask:"+973-####-####"},{mask:"+257-##-##-####"},{mask:"+229-##-##-####"},{mask:"+1(441)###-####"},{mask:"+673-###-####"},{mask:"+591-#-###-####"},{mask:"+55-##-####-####"},{mask:"+1(242)###-####"},{mask:"+975-17-###-###"},{mask:"+975-#-###-###"},{mask:"+267-##-###-###"},{mask:"+375(##)###-##-##"},{mask:"+501-###-####"},{mask:"+243(###)###-###"},{mask:"+236-##-##-####"},{mask:"+242-##-###-####"},{mask:"+41-##-###-####"},{mask:"+225-##-###-###"},{mask:"+682-##-###"},{mask:"+56-#-####-####"},{mask:"+237-####-####"},{mask:"+86(###)####-####"},{mask:"+86(###)####-###"},{mask:"+86-##-#####-#####"},{mask:"+57(###)###-####"},{mask:"+506-####-####"},{mask:"+53-#-###-####"},{mask:"+238(###)##-##"},{mask:"+599-###-####"},{mask:"+357-##-###-###"},{mask:"+420(###)###-###"},{mask:"+49(####)###-####"},{mask:"+49(###)###-####"},{mask:"+49(###)##-####"},{mask:"+49(###)##-###"},{mask:"+49(###)##-##"},{mask:"+49-###-###"},{mask:"+253-##-##-##-##"},{mask:"+45-##-##-##-##"},{mask:"+1(767)###-####"},{mask:"+1(809)###-####"},{mask:"+1(829)###-####"},{mask:"+1(849)###-####"},{mask:"+213-##-###-####"},{mask:"+593-##-###-####"},{mask:"+593-#-###-####"},{mask:"+372-####-####"},{mask:"+372-###-####"},{mask:"+20(###)###-####"},{mask:"+291-#-###-###"},{mask:"+34(###)###-###"},{mask:"+251-##-###-####"},{mask:"+358(###)###-##-##"},{mask:"+679-##-#####"},{mask:"+500-#####"},{mask:"+691-###-####"},{mask:"+298-###-###"},{mask:"+262-#####-####"},{mask:"+33(###)###-###"},{mask:"+508-##-####"},{mask:"+590(###)###-###"},{mask:"+241-#-##-##-##"},{mask:"+1(473)###-####"},{mask:"+995(###)###-###"},{mask:"+594-#####-####"},{mask:"+233(###)###-###"},{mask:"+350-###-#####"},{mask:"+299-##-##-##"},{mask:"+220(###)##-##"},{mask:"+224-##-###-###"},{mask:"+240-##-###-####"},{mask:"+30(###)###-####"},{mask:"+502-#-###-####"},{mask:"+1(671)###-####"},{mask:"+245-#-######"},{mask:"+592-###-####"},{mask:"+852-####-####"},{mask:"+504-####-####"},{mask:"+385-##-###-###"},{mask:"+509-##-##-####"},{mask:"+36(###)###-###"},{mask:"+62(8##)###-####"},{mask:"+62-##-###-##"},{mask:"+62-##-###-###"},{mask:"+62-##-###-####"},{mask:"+62(8##)###-###"},{mask:"+62(8##)###-##-###"},{mask:"+353(###)###-###"},{mask:"+972-5#-###-####"},{mask:"+972-#-###-####"},{mask:"+91(####)###-###"},{mask:"+246-###-####"},{mask:"+964(###)###-####"},{mask:"+98(###)###-####"},{mask:"+354-###-####"},{mask:"+39(###)####-###"},{mask:"+1(876)###-####"},{mask:"+962-#-####-####"},{mask:"+81-##-####-####"},{mask:"+81(###)###-###"},{mask:"+254-###-######"},{mask:"+996(###)###-###"},{mask:"+855-##-###-###"},{mask:"+686-##-###"},{mask:"+269-##-#####"},{mask:"+1(869)###-####"},{mask:"+850-191-###-####"},{mask:"+850-##-###-###"},{mask:"+850-###-####-###"},{mask:"+850-###-###"},{mask:"+850-####-####"},{mask:"+850-####-#############"},{mask:"+82-##-###-####"},{mask:"+965-####-####"},{mask:"+1(345)###-####"},{mask:"+7(6##)###-##-##"},{mask:"+7(7##)###-##-##"},{mask:"+856(20##)###-###"},{mask:"+856-##-###-###"},{mask:"+961-##-###-###"},{mask:"+961-#-###-###"},{mask:"+1(758)###-####"},{mask:"+423(###)###-####"},{mask:"+94-##-###-####"},{mask:"+231-##-###-###"},{mask:"+266-#-###-####"},{mask:"+370(###)##-###"},{mask:"+352(###)###-###"},{mask:"+371-##-###-###"},{mask:"+218-##-###-###"},{mask:"+218-21-###-####"},{mask:"+212-##-####-###"},{mask:"+377(###)###-###"},{mask:"+377-##-###-###"},{mask:"+373-####-####"},{mask:"+382-##-###-###"},{mask:"+261-##-##-#####"},{mask:"+692-###-####"},{mask:"+389-##-###-###"},{mask:"+223-##-##-####"},{mask:"+95-##-###-###"},{mask:"+95-#-###-###"},{mask:"+95-###-###"},{mask:"+976-##-##-####"},{mask:"+853-####-####"},{mask:"+1(670)###-####"},{mask:"+596(###)##-##-##"},{mask:"+222-##-##-####"},{mask:"+1(664)###-####"},{mask:"+356-####-####"},{mask:"+230-###-####"},{mask:"+960-###-####"},{mask:"+265-1-###-###"},{mask:"+265-#-####-####"},{mask:"+52(###)###-####"},{mask:"+52-##-##-####"},{mask:"+60-##-###-####"},{mask:"+60(###)###-###"},{mask:"+60-##-###-###"},{mask:"+60-#-###-###"},{mask:"+258-##-###-###"},{mask:"+264-##-###-####"},{mask:"+687-##-####"},{mask:"+227-##-##-####"},{mask:"+672-3##-###"},{mask:"+234(###)###-####"},{mask:"+234-##-###-###"},{mask:"+234-##-###-##"},{mask:"+234(###)###-####"},{mask:"+505-####-####"},{mask:"+31-##-###-####"},{mask:"+47(###)##-###"},{mask:"+977-##-###-###"},{mask:"+674-###-####"},{mask:"+683-####"},{mask:"+64(###)###-###"},{mask:"+64-##-###-###"},{mask:"+64(###)###-####"},{mask:"+968-##-###-###"},{mask:"+507-###-####"},{mask:"+51(###)###-###"},{mask:"+689-##-##-##"},{mask:"+675(###)##-###"},{mask:"+63(###)###-####"},{mask:"+92(###)###-####"},{mask:"+48(###)###-###"},{mask:"+970-##-###-####"},{mask:"+351-##-###-####"},{mask:"+680-###-####"},{mask:"+595(###)###-###"},{mask:"+974-####-####"},{mask:"+262-#####-####"},{mask:"+40-##-###-####"},{mask:"+381-##-###-####"},{mask:"+7(###)###-##-##"},{mask:"+250(###)###-###"},{mask:"+966-5-####-####"},{mask:"+966-#-###-####"},{mask:"+677-###-####"},{mask:"+677-#####"},{mask:"+248-#-###-###"},{mask:"+249-##-###-####"},{mask:"+46-##-###-####"},{mask:"+65-####-####"},{mask:"+290-####"},{mask:"+290-####"},{mask:"+386-##-###-###"},{mask:"+421(###)###-###"},{mask:"+232-##-######"},{mask:"+378-####-######"},{mask:"+221-##-###-####"},{mask:"+252-##-###-###"},{mask:"+252-#-###-###"},{mask:"+252-#-###-###"},{mask:"+597-###-####"},{mask:"+597-###-###"},{mask:"+211-##-###-####"},{mask:"+239-##-#####"},{mask:"+503-##-##-####"},{mask:"+1(721)###-####"},{mask:"+963-##-####-###"},{mask:"+268-##-##-####"},{mask:"+1(649)###-####"},{mask:"+235-##-##-##-##"},{mask:"+228-##-###-###"},{mask:"+66-##-###-####"},{mask:"+66-##-###-###"},{mask:"+992-##-###-####"},{mask:"+690-####"},{mask:"+670-###-####"},{mask:"+670-77#-#####"},{mask:"+670-78#-#####"},{mask:"+993-#-###-####"},{mask:"+216-##-###-###"},{mask:"+676-#####"},{mask:"+90(###)###-####"},{mask:"+1(868)###-####"},{mask:"+688-90####"},{mask:"+688-2####"},{mask:"+886-#-####-####"},{mask:"+886-####-####"},{mask:"+255-##-###-####"},{mask:"+380(##)###-##-##"},{mask:"+256(###)###-###"},{mask:"+44-##-####-####"},{mask:"+598-#-###-##-##"},{mask:"+998-##-###-####"},{mask:"+39-6-698-#####"},{mask:"+1(784)###-####"},{mask:"+58(###)###-####"},{mask:"+1(284)###-####"},{mask:"+1(340)###-####"},{mask:"+84-##-####-###"},{mask:"+84(###)####-###"},{mask:"+678-##-#####"},{mask:"+678-#####"},{mask:"+681-##-####"},{mask:"+685-##-####"},{mask:"+967-###-###-###"},{mask:"+967-#-###-###"},{mask:"+967-##-###-###"},{mask:"+27-##-###-####"},{mask:"+260-##-###-####"},{mask:"+263-#-######"},{mask:"+1(###)###-####"}],Bi=["#"],qi=/[0-9]|#/,Wi="mask",Li.sort((function(t,e){for(var n=0,r=0;n<t[Wi].length&&r<e[Wi].length;){var i=t[Wi].charAt(n),o=e[Wi].charAt(r);if(qi.test(i))if(qi.test(o)){if(-1!==Bi.indexOf(i)&&-1===Bi.indexOf(o))return 1;if(-1===Bi.indexOf(i)&&-1!==Bi.indexOf(o))return-1;if(-1===Bi.indexOf(i)&&-1===Bi.indexOf(o)&&i!==o)return i<o?-1:1;n++,r++}else r++;else n++}for(;n<t[Wi].length||r<e[Wi].length;)if(n<t[Wi].length&&!qi.test(t[Wi].charAt(n)))n++;else if(r<e[Wi].length&&!qi.test(e[Wi].charAt(r)))r++;else{if(n<t[Wi].length)return 1;if(r<e[Wi].length)return-1}return 0})),Li).map((function(t){var e=Ni(t.mask),n=e.map((function(t){return"string"==typeof t&&/\d/.test(t)?/\d/:t}));return{testMask:e,mask:n,stringMask:t.mask}}));var Vi=new Promise((function(t){O(document).ready((function(){t()}))})),Hi=[];function Gi(t,e){var n=Ni(e);return O(t).each((function(t,e){var r=new ji(e,{mask:n,overwriteMode:"shift"});Hi.push(r)})),this}function zi(t){O(t).each((function(t,e){var n=new ji(e,{mask:function(t){var n=t.value?function(t){if(0===(t=t.replace(/\D/g,"")).length)return null;for(var e=0;e<Ui.length;e++){for(var n=Ui[e].testMask.filter((function(t){return"string"!=typeof t||Ai.test(t)})),r=!0,i=0;i<t.length&&void 0!==n[i];i++)if("string"==typeof n[i]){if(n[i]!==t[i]){r=!1;break}}else if(!n[i].test(t[i])){r=!1;break}if(r)return Ui[e]}return null}(t.value):Xi;return n?(O(e).data($i,n.stringMask),n.mask):Ni(O(e).data($i)||"+")},overwriteMode:"shift"});Hi.push(n)}))}Ue("destroy",(function(){for(;Hi.length>0;){Hi.pop().destroy()}}));var Ji={common:function(t,e){Gi(t,e)},phones:function(t){zi(t)},dates:function(t){Gi(t,"##.##.####")},isCompleted:function(t,e){return function(t,e){var n=e.split("");if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if("string"==typeof t[r]){if(n[r]!==t[r])return!1}else if(!t[r].test(n[r]))return!1;return!0}(Ni(e=e||O(t).data($i)),O(t).val())},readyPromise:Vi},Ki={fieldValidators:{email:{test:function(t){return new RegExp("^([\\p{L}0-9_\\-!#$%&'*+/=?^`{}|~])+([.\\p{L}0-9_\\-!#$%&'*+/=?^`{}|~])*@([\\p{L}0-9]([\\p{L}0-9\\-]{0,61}[\\p{L}0-9])?\\.)*[\\p{L}0-9]([\\p{L}0-9\\-]{0,61}[\\p{L}0-9])?$","iu").test(t)}},phone:/^\+?[\d\s-()]+$/,name:/^[\s\S]+$/},fieldTypeValidators:{date:{test:function(t){try{var e=t.split("."),n=e[0],r=e[1],i=e[2],o=Date.parse([i,r,n].join("-"));return!isNaN(o)}catch(t){return!1}}}}};function Qi(t){var e=t.toLowerCase();return["name","email","phone","first_name","last_name"].includes(e)?e:t}function Yi(t,e){return"date"===t?function(t){if(!te.desktop())try{var e=t.split("-"),n=e[0],i=e[1],o=e[2];return r.some(e)?[o,i,n].join("."):""}catch(t){return""}return t}(e):e}var Zi=Yt(Jr,{_sending:!1,_fields:[],_fieldNamesInHtml:[],_canSubmit:!0,_$elem:null,_view:null,_showSuccess:!0,_sent:!1,_requiredFields:["name","email","phone"],__constructor:function(t){this.__base(t),this._fields=[],this._fieldNamesInHtml=[]},_updateField:function(t,e,n){var i=!0,o=this._fieldNamesInHtml.find((function(e){return e.field===t})),a=o?o.fieldName:"",s=this._$elem.find("[data-"+Bt.CSS_PREFIX+'input="'+a+'"]'),c=(!!s.filter("[data-"+Bt.CSS_PREFIX+"required]").length||r.includes(this._requiredFields,t))&&!s.filter("[data-"+Bt.CSS_PREFIX+"unrequired]").length,u=s.first().data(Bt.CSS_PREFIX+"type"),l=Ki.fieldTypeValidators[u];if(!(!(e=(e=null==e?"":e).trim?e.trim():+e)&&!c)){if(Ki.fieldValidators[t]&&(i=i&&Ki.fieldValidators[t].test(e)),i&&l&&(i=i&&l.test(e)),"phone"===t&&i&&e)try{var f=O(s).filter("[data-"+Bt.CSS_PREFIX+"mask]").first().data(Bt.CSS_PREFIX+"mask");i=i&&Ji.isCompleted(s.first(),f)}catch(t){i=!1}if(i&&s.filter("[data-"+Bt.CSS_PREFIX+"mask]").length)try{var d=O(s).filter("[data-"+Bt.CSS_PREFIX+"mask]").first().data(Bt.CSS_PREFIX+"mask");i=i&&Ji.isCompleted(s.first(),d)}catch(t){i=!1}c&&(i=i&&!!e)}return!i&&n?(s.filter(':not([type="radio"])').filter(':not([type="checkbox"])').val(e),s.addClass(Bt.CSS_PREFIX+"invalid")):s.addClass(Bt.CSS_PREFIX+"valid"),this._leadModel[t]=e,this._runIf(),i},_runIf:function(){var t=this._leadModel;this._$elem.find("[data-popmechanic-if]").each((function(){var e=new Function("lead","PopMechanic","return "+O(this).data("popmechanic-if")+";"),n=r.clone(t);n.customs=n.customs||{},r.extend(n.customs,window.PopMechanic.customs);try{e(n,window.PopMechanic)?O(this).show():O(this).hide()}catch(t){O(this).hide()}}))},canSubmit:function(){return this._canSubmit&&!this._sending&&!this._sent},_submit:function(t){var e,n=!0,r=this;if(r.canSubmit()&&(r._fields.forEach((function(t){var e=r._updateField(t,r._leadModel[t],!0);n=e&&n})),n))return r._sending=!0,e=new Si(r._leadModel,r._view.form),r._$elem.addClass(Bt.CSS_PREFIX+"pending"),t&&t.preventDefault(),e.send((function(t){if(r._runIf(),window.PopMechanic.leads.push(t),r._$elem.removeClass(Bt.CSS_PREFIX+"pending"),r._$elem.addClass(Bt.CSS_PREFIX+"submitted"),r._$elem.addClass(Bt.CSS_PREFIX+"success"),xi("success"),r._sending=!1,r._sent=!0,He("lead",{lead:t,form:r._view.form}),qe.push({type:"lead-success",form:r._view.form.id}),we.setCompleted(t.form||r._view.form.id),r._showSuccess)return r._view.success(t)}),(function(){return r._$elem.removeClass(Bt.CSS_PREFIX+"pending"),r._$elem.addClass(Bt.CSS_PREFIX+"error"),r._sending=!1,yi({type:"exception"}),He("cancel",{form:r._view.form}),qe.push({type:"lead-cancel",form:r._view.form.id}),we.setUncompleted(r._view.form.id),r._view.close()}))},_bindEvents:function(){},onBeforeRender:function(){return Ji.readyPromise},onRender:function(t,e){this.__base(t,e),te.desktop()||t.find("input[data-"+Bt.CSS_PREFIX+"type=date]").attr("type","date")},onShow:function(t,e){var n=this;this._$elem=t,this._view=e,this._leadModel={},t.find("[data-"+Bt.CSS_PREFIX+"input]").each((function(){var e=this,r=O(this),i=r.data(Bt.CSS_PREFIX+"input"),o=t.find("[data-"+Bt.CSS_PREFIX+'input="'+i+'"]'),a=r.data(Bt.CSS_PREFIX+"type");o.each((function(){return n._initInputMask(O(e))}));var s=Qi(i);if(-1===n._fields.indexOf(s)&&(n._fields.push(s),n._fieldNamesInHtml.push({field:s,fieldName:i})),r.on("keyup click",(function(){var t="checkbox"===r.attr("type")?r.is(":checked"):r.val();o.removeClass(Bt.CSS_PREFIX+"invalid"),t=Yi(a,t),n._updateField(s,t)})),r.on("change blur",(function(){var t="checkbox"===r.attr("type")?r.is(":checked"):r.val();t=Yi(a,t),n._updateField(s,t,!0)})),"radio"!==r.attr("type")){var c="checkbox"===r.attr("type")?r.is(":checked"):r.val();c=Yi(a,c),n._updateField(s,c,!1)}else{var u=r.val();u=Yi(a,u),r.is(":checked")&&n._updateField(s,u,!1)}})),this._bindEvents()},_initInputMask:function(t){try{t.is("input[data-"+Bt.CSS_PREFIX+"mask]")?Ji.common(t,t.data(Bt.CSS_PREFIX+"mask")):t.is("input[data-"+Bt.CSS_PREFIX+"input=phone]")?Ji.phones(t):t.is("input[data-"+Bt.CSS_PREFIX+"type=date]")&&te.desktop()&&Ji.dates(t)}catch(t){window.PopMechanic.debugMode&&console.error("Error setting inputmask:",t)}},onSuccess:function(t,e,n){var r=!1;return new Promise((function(e){n=n||window.PopMechanic.leads[window.PopMechanic.leads.length-1],t.find("[data-popmechanic-var]").each((function(){var t=O(this),e=t.attr("data-popmechanic-var");0===e.indexOf("customs")&&(r=!0),t.text(function(t,e){for(var n=(e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),r=0,i=n.length;r<i;++r){var o=n[r];if(!(o in t))return;t=t[o]}return t}(n,e))})),r?(O("."+Bt.CSS_PREFIX+"close").on("click",(function(){e()})),O(document).on("keyup",(function(t){27==t.keyCode&&e()})),O("."+Bt.CSS_PREFIX+"js-paranja").on("click",(function(){e()}))):e()}))},onClose:function(t,e,n){n.success||n.isBeingDestroyed||(He("cancel",{form:e.form}),we.setUncompleted(e.form.id),qe.push({type:"lead-cancel",form:this._view.form.id}))}}),to=Yt(Zi,{_bindEvents:function(){var t=this;this._$elem.find("[data-"+Bt.CSS_PREFIX+"submit]").on("click",(function(e){t._submit(e)})),this._$elem.on("keyup",(function(e){13==e.keyCode&&"textarea"!==e.target.type.toLowerCase()&&t._submit(e)})),this._$elem.find("form").on("submit",(function(t){t.preventDefault()}))}}),eo=Yt(Zi,{_canSubmit:!1,_bindEvents:function(){var t=this;this._$elem.find("[data-popmechanic-submit]").on("click",(function(){t._canSubmit=!0})),this._$elem.find("[data-popmechanic-submit-close]").on("click",(function(){t._canSubmit=!0,t._view.close(!0)}))},onBeforeClose:function(t,e,n){return this._showSuccess=n.showSuccess,this._submit()}}),no=Yt(Jr,{onShow:function(t,e){t.find("[rel=screen], [data-target=screen]").on("click",(function(n){var r,i,o=t.find(O(this).attr("href")),a=t.find(".popmechanic-screen").filterVisible(),s=t.find("#popmechanic-form-"+e.form.id),c=!0;if(a.find("[data-popmechanic-input]").each((function(){var t=O(this),e=t.attr("data-popmechanic-input"),n=t.data(Bt.CSS_PREFIX+"type"),r=void 0!==t.attr("data-popmechanic-required"),i=Ki.fieldValidators[e]&&!Ki.fieldValidators[e].test(t.val()),o=Ki.fieldTypeValidators[n]&&!Ki.fieldTypeValidators[n].test(t.val()),a=r&&"checkbox"===t.attr("type")&&!t.is(":checked"),s=r&&!t.val();(i||o||a||s)&&(c=!1,t.addClass("popmechanic-invalid"))})),!c&&!O(n.target).attr("data-popmechanic-novalidate"))return!1;o.show(),r=o.outerWidth(),i=o.outerHeight(),o.hide(),s.animate({width:r,height:i}),a.animate({opacity:0},(function(){this.hide(),o.css({opacity:0}).show().animate({opacity:1},(function(){if(o.data("onshow"))try{new Function(o.data("onshow"))()}catch(t){}}))})),n.preventDefault(),n.stopPropagation()}))}}),ro=Bt.CSS_PREFIX+"js-wrapper",io=Bt.CSS_PREFIX+"js-animation-wrapper",oo=function(t){var e=t.settings,n=t.id,r=t.runAnimation;this._settings=e,this._id=n,this._runAnimation=r,this.onRender=this.onRender.bind(this),this.onShow=this.onShow.bind(this),this.onClose=this.onClose.bind(this)};function ao(t){return"number"==typeof t?t+"px":"string"!=typeof t?0:-1!==t.indexOf("%")?t:(parseFloat(t)||0)+"px"}oo.prototype._initBaseWrapper=function(){return O('<div class="'+ro+'" />')},oo.prototype._getBaseWrapper=function(t){return t.find("."+ro)},oo.prototype._initAnimationWrapper=function(){return O('<div class="'+io+'" />')},oo.prototype._getAnimationWrapper=function(t){return t.find("."+io)},oo.prototype.shouldRender=function(){return!0},oo.prototype.onRender=function(){},oo.prototype.onShow=function(t,e,n){},oo.prototype.onClose=function(t){};var so={top:{top:0,left:"50%",transform:"translate(-50%, 0)"},left:{left:0,top:"50%",transform:"translate(0, -50%)"},right:{right:0,top:"50%",transform:"translate(0, -50%)"},bottom:{bottom:0,left:"50%",transform:"translate(-50%, 0)"},"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},center:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},co=Bt.CSS_PREFIX+"js-clickable-overlay",uo={display:"block",textAlign:"left",maxHeight:"100%",maxWidth:"100%"},lo={display:"block",position:"fixed",top:0,left:0,right:0,bottom:0,height:"auto",minHeight:0,overflow:"auto",zIndex:100000001},fo=function(t){function e(e){t.call(this,e),this._paranjaId=Bt.CSS_PREFIX+"paranja-"+this._id,this._getParanja=this._getParanja.bind(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleKeyUp=function(){},e.prototype._getBaseWrapperStyles=function(){var t=r.extend({},{zIndex:100000002},so[this._settings.position]);return-1!==this._settings.position.indexOf("top")&&(t.marginTop=ao(this._settings.vertical_offset)),-1!==this._settings.position.indexOf("bottom")&&(t.marginBottom=ao(this._settings.vertical_offset)),-1!==this._settings.position.indexOf("left")&&(t.marginLeft=ao(this._settings.horizontal_offset)),-1!==this._settings.position.indexOf("right")&&(t.marginRight=ao(this._settings.horizontal_offset)),"center"===this._settings.position?t.position="absolute":t.position="fixed",t},e.prototype._initParanja=function(){return O('<div class="'+Bt.CSS_PREFIX+'js-paranja" id="'+this._paranjaId+'">').css(r.extend({},lo,{backgroundColor:this._settings.paranja_color,opacity:"0",transition:"opacity "+Bt.ANIMATION_SPEED+"ms"}))},e.prototype._getParanja=function(t){return t.find("#"+this._paranjaId)},e.prototype._getClickableOverlay=function(t){return t.find("."+co)},e.prototype._initWrappers=function(t){var e=this._initBaseWrapper();e.css(r.extend({},uo,this._getBaseWrapperStyles()));var n=this._initAnimationWrapper();n.append(e),t.append(n);var i=null,o=null;return"center"===this._settings.position&&(i=this._initParanja(),o=O('<div class="'+co+'" />'),n.append(o),t.append(i)),{$paranja:i,$animationWrapper:n,$baseWrapper:e,$clickableOverlay:o}},e.prototype.shouldRender=function(){return!ni()&&!(ei()&&!this._settings.allow_overlay)},e.prototype.onRender=function(){if(!this.shouldRender())return Promise.reject();Zr(this._id,this._settings.allow_overlay)},e.prototype.onShow=function(t,e,n){var i=this;return new Promise((function(o){var a=i._initWrappers(e),s=a.$paranja,c=a.$animationWrapper,u=a.$baseWrapper,l=a.$clickableOverlay;i._handleKeyUp=function(t){27===t.keyCode&&n()},O(document).on("keyup",i._handleKeyUp),"center"===i._settings.position&&(ne(),t.css({position:"relative"}),c.css(r.extend({},lo,{pointerEvents:"all"})),s.css({zIndex:1e8,opacity:i._settings.paranja_opacity})),u.append(t),i._runAnimation(c,i._settings.animation_in,(function(){s&&l.on("click",(function(){n(!1)})),o("OK")}))}))},e.prototype.onClose=function(t){var e=this,n=e._getAnimationWrapper(t),r=e._getBaseWrapper(t),i=e._getParanja(t),o=e._getClickableOverlay(t);return ti(e._id),new Promise((function(t){e._runAnimation(n,e._settings.animation_out,(function(){r.remove(),n.css({position:"static",height:0,minHeight:0,overflow:"visible"}),i?(i.css({opacity:0}),setTimeout((function(){i.remove(),o.remove(),re(),O(document).off("keyup",e._handleKeyUp),t()}),Bt.ANIMATION_SPEED)):(re(),O(document).off("keyup",e._handleKeyUp),t())}))})).catch((function(){i&&(i.remove(),o.remove()),O(document).off("keyup",e._handleKeyUp)}))},e}(oo),po="top",ho="bottom",mo="right",go="left",vo=[po,ho,mo,go],_o=vo.reduce((function(t,e){return t.concat([e+"-start",e+"-end"])}),[]),yo=[].concat(vo,["auto"]).reduce((function(t,e){return t.concat([e,e+"-start",e+"-end"])}),[]),wo=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function bo(t){return t?(t.nodeName||"").toLowerCase():null}function So(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function ko(t){return t instanceof So(t).Element||t instanceof Element}function xo(t){return t instanceof So(t).HTMLElement||t instanceof HTMLElement}function Io(t){return"undefined"!=typeof ShadowRoot&&(t instanceof So(t).ShadowRoot||t instanceof ShadowRoot)}var Po={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},i=e.elements[t];xo(i)&&bo(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(t){var e=r[t];!1===e?i.removeAttribute(t):i.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var r=e.elements[t],i=e.attributes[t]||{},o=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]).reduce((function(t,e){return t[e]="",t}),{});xo(r)&&bo(r)&&(Object.assign(r.style,o),Object.keys(i).forEach((function(t){r.removeAttribute(t)})))}))}},requires:["computeStyles"]};function Eo(t){return t.split("-")[0]}var Co=Math.round;function To(t,e){void 0===e&&(e=!1);var n=t.getBoundingClientRect(),r=1,i=1;return xo(t)&&e&&(r=n.width/t.offsetWidth||1,i=n.height/t.offsetHeight||1),{width:Co(n.width/r),height:Co(n.height/i),top:Co(n.top/i),right:Co(n.right/r),bottom:Co(n.bottom/i),left:Co(n.left/r),x:Co(n.left/r),y:Co(n.top/i)}}function Ro(t){var e=To(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function Oo(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&Io(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Fo(t){return So(t).getComputedStyle(t)}function Mo(t){return["table","td","th"].indexOf(bo(t))>=0}function Do(t){return((ko(t)?t.ownerDocument:t.document)||window.document).documentElement}function jo(t){return"html"===bo(t)?t:t.assignedSlot||t.parentNode||(Io(t)?t.host:null)||Do(t)}function $o(t){return xo(t)&&"fixed"!==Fo(t).position?t.offsetParent:null}function Ao(t){for(var e=So(t),n=$o(t);n&&Mo(n)&&"static"===Fo(n).position;)n=$o(n);return n&&("html"===bo(n)||"body"===bo(n)&&"static"===Fo(n).position)?e:n||function(t){var e=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&xo(t)&&"fixed"===Fo(t).position)return null;for(var n=jo(t);xo(n)&&["html","body"].indexOf(bo(n))<0;){var r=Fo(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||e&&"filter"===r.willChange||e&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(t)||e}function No(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}var Lo=Math.max,Bo=Math.min,qo=Math.round;function Wo(t,e,n){return Lo(t,Bo(e,n))}function Xo(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function Uo(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}var Vo={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ho(t){var e,n=t.popper,r=t.popperRect,i=t.placement,o=t.offsets,a=t.position,s=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,l=!0===u?function(t){var e=t.x,n=t.y,r=window.devicePixelRatio||1;return{x:qo(qo(e*r)/r)||0,y:qo(qo(n*r)/r)||0}}(o):"function"==typeof u?u(o):o,f=l.x,d=void 0===f?0:f,p=l.y,h=void 0===p?0:p,m=o.hasOwnProperty("x"),g=o.hasOwnProperty("y"),v=go,_=po,y=window;if(c){var w=Ao(n),b="clientHeight",S="clientWidth";w===So(n)&&"static"!==Fo(w=Do(n)).position&&(b="scrollHeight",S="scrollWidth"),w=w,i===po&&(_=ho,h-=w[b]-r.height,h*=s?1:-1),i===go&&(v=mo,d-=w[S]-r.width,d*=s?1:-1)}var k,x=Object.assign({position:a},c&&Vo);return s?Object.assign({},x,((k={})[_]=g?"0":"",k[v]=m?"0":"",k.transform=(y.devicePixelRatio||1)<2?"translate("+d+"px, "+h+"px)":"translate3d("+d+"px, "+h+"px, 0)",k)):Object.assign({},x,((e={})[_]=g?h+"px":"",e[v]=m?d+"px":"",e.transform="",e))}var Go={passive:!0};var zo={left:"right",right:"left",bottom:"top",top:"bottom"};function Jo(t){return t.replace(/left|right|bottom|top/g,(function(t){return zo[t]}))}var Ko={start:"end",end:"start"};function Qo(t){return t.replace(/start|end/g,(function(t){return Ko[t]}))}function Yo(t){var e=So(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Zo(t){return To(Do(t)).left+Yo(t).scrollLeft}function ta(t){var e=Fo(t),n=e.overflow,r=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function ea(t,e){var n;void 0===e&&(e=[]);var r=function t(e){return["html","body","#document"].indexOf(bo(e))>=0?e.ownerDocument.body:xo(e)&&ta(e)?e:t(jo(e))}(t),i=r===(null==(n=t.ownerDocument)?void 0:n.body),o=So(r),a=i?[o].concat(o.visualViewport||[],ta(r)?r:[]):r,s=e.concat(a);return i?s:s.concat(ea(jo(a)))}function na(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function ra(t,e){return"viewport"===e?na(function(t){var e=So(t),n=Do(t),r=e.visualViewport,i=n.clientWidth,o=n.clientHeight,a=0,s=0;return r&&(i=r.width,o=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(a=r.offsetLeft,s=r.offsetTop)),{width:i,height:o,x:a+Zo(t),y:s}}(t)):xo(e)?function(t){var e=To(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}(e):na(function(t){var e,n=Do(t),r=Yo(t),i=null==(e=t.ownerDocument)?void 0:e.body,o=Lo(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=Lo(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-r.scrollLeft+Zo(t),c=-r.scrollTop;return"rtl"===Fo(i||n).direction&&(s+=Lo(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:s,y:c}}(Do(t)))}function ia(t,e,n){var r="clippingParents"===e?function(t){var e=ea(jo(t)),n=["absolute","fixed"].indexOf(Fo(t).position)>=0&&xo(t)?Ao(t):t;return ko(n)?e.filter((function(t){return ko(t)&&Oo(t,n)&&"body"!==bo(t)})):[]}(t):[].concat(e),i=[].concat(r,[n]),o=i[0],a=i.reduce((function(e,n){var r=ra(t,n);return e.top=Lo(r.top,e.top),e.right=Bo(r.right,e.right),e.bottom=Bo(r.bottom,e.bottom),e.left=Lo(r.left,e.left),e}),ra(t,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function oa(t){return t.split("-")[1]}function aa(t){var e,n=t.reference,r=t.element,i=t.placement,o=i?Eo(i):null,a=i?oa(i):null,s=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(o){case po:e={x:s,y:n.y-r.height};break;case ho:e={x:s,y:n.y+n.height};break;case mo:e={x:n.x+n.width,y:c};break;case go:e={x:n.x-r.width,y:c};break;default:e={x:n.x,y:n.y}}var u=o?No(o):null;if(null!=u){var l="y"===u?"height":"width";switch(a){case"start":e[u]=e[u]-(n[l]/2-r[l]/2);break;case"end":e[u]=e[u]+(n[l]/2-r[l]/2)}}return e}function sa(t,e){void 0===e&&(e={});var n=e,r=n.placement,i=void 0===r?t.placement:r,o=n.boundary,a=void 0===o?"clippingParents":o,s=n.rootBoundary,c=void 0===s?"viewport":s,u=n.elementContext,l=void 0===u?"popper":u,f=n.altBoundary,d=void 0!==f&&f,p=n.padding,h=void 0===p?0:p,m=Xo("number"!=typeof h?h:Uo(h,vo)),g="popper"===l?"reference":"popper",v=t.elements.reference,_=t.rects.popper,y=t.elements[d?g:l],w=ia(ko(y)?y:y.contextElement||Do(t.elements.popper),a,c),b=To(v),S=aa({reference:b,element:_,strategy:"absolute",placement:i}),k=na(Object.assign({},_,S)),x="popper"===l?k:b,I={top:w.top-x.top+m.top,bottom:x.bottom-w.bottom+m.bottom,left:w.left-x.left+m.left,right:x.right-w.right+m.right},P=t.modifiersData.offset;if("popper"===l&&P){var E=P[i];Object.keys(I).forEach((function(t){var e=[mo,ho].indexOf(t)>=0?1:-1,n=[po,ho].indexOf(t)>=0?"y":"x";I[t]+=E[n]*e}))}return I}function ca(t,e){void 0===e&&(e={});var n=e,r=n.placement,i=n.boundary,o=n.rootBoundary,a=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,u=void 0===c?yo:c,l=oa(r),f=l?s?_o:_o.filter((function(t){return oa(t)===l})):vo,d=f.filter((function(t){return u.indexOf(t)>=0}));0===d.length&&(d=f);var p=d.reduce((function(e,n){return e[n]=sa(t,{placement:n,boundary:i,rootBoundary:o,padding:a})[Eo(n)],e}),{});return Object.keys(p).sort((function(t,e){return p[t]-p[e]}))}function ua(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function la(t){return[po,mo,ho,go].some((function(e){return t[e]>=0}))}function fa(t,e,n){void 0===n&&(n=!1);var r,i,o=xo(e),a=xo(e)&&function(t){var e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return 1!==n||1!==r}(e),s=Do(e),c=To(t,a),u={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(o||!o&&!n)&&(("body"!==bo(e)||ta(s))&&(u=(r=e)!==So(r)&&xo(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:Yo(r)),xo(e)?((l=To(e,!0)).x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=Zo(s))),{x:c.left+u.scrollLeft-l.x,y:c.top+u.scrollTop-l.y,width:c.width,height:c.height}}function da(t){var e=new Map,n=new Set,r=[];return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||function t(i){n.add(i.name),[].concat(i.requires||[],i.requiresIfExists||[]).forEach((function(r){if(!n.has(r)){var i=e.get(r);i&&t(i)}})),r.push(i)}(t)})),r}function pa(t){var e;return function(){return e||(e=new Promise((function(n){Promise.resolve().then((function(){e=void 0,n(t())}))}))),e}}var ha={placement:"bottom",modifiers:[],strategy:"absolute"};function ma(){for(var t=arguments,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=t[r];return!n.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function ga(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,r=void 0===n?[]:n,i=e.defaultOptions,o=void 0===i?ha:i;return function(t,e,n){void 0===n&&(n=o);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},ha,o),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},a=[],s=!1,c={state:i,setOptions:function(n){u(),i.options=Object.assign({},o,i.options,n),i.scrollParents={reference:ko(t)?ea(t):t.contextElement?ea(t.contextElement):[],popper:ea(e)};var s,l,f=function(t){var e=da(t);return wo.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}((s=[].concat(r,i.options.modifiers),l=s.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t}),{}),Object.keys(l).map((function(t){return l[t]}))));return i.orderedModifiers=f.filter((function(t){return t.enabled})),i.orderedModifiers.forEach((function(t){var e=t.name,n=t.options,r=void 0===n?{}:n,o=t.effect;if("function"==typeof o){var s=o({state:i,name:e,instance:c,options:r});a.push(s||function(){})}})),c.update()},forceUpdate:function(){if(!s){var t=i.elements,e=t.reference,n=t.popper;if(ma(e,n)){i.rects={reference:fa(e,Ao(n),"fixed"===i.options.strategy),popper:Ro(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(t){return i.modifiersData[t.name]=Object.assign({},t.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var o=i.orderedModifiers[r],a=o.fn,u=o.options,l=void 0===u?{}:u,f=o.name;"function"==typeof a&&(i=a({state:i,options:l,name:f,instance:c})||i)}else i.reset=!1,r=-1}}},update:pa((function(){return new Promise((function(t){c.forceUpdate(),t(i)}))})),destroy:function(){u(),s=!0}};if(!ma(t,e))return c;function u(){a.forEach((function(t){return t()})),a=[]}return c.setOptions(n).then((function(t){!s&&n.onFirstUpdate&&n.onFirstUpdate(t)})),c}}var va=ga({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,n=t.instance,r=t.options,i=r.scroll,o=void 0===i||i,a=r.resize,s=void 0===a||a,c=So(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&u.forEach((function(t){t.addEventListener("scroll",n.update,Go)})),s&&c.addEventListener("resize",n.update,Go),function(){o&&u.forEach((function(t){t.removeEventListener("scroll",n.update,Go)})),s&&c.removeEventListener("resize",n.update,Go)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,n=t.name;e.modifiersData[n]=aa({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,n=t.options,r=n.gpuAcceleration,i=void 0===r||r,o=n.adaptive,a=void 0===o||o,s=n.roundOffsets,c=void 0===s||s,u={placement:Eo(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,Ho(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:c})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ho(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},Po,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,n=t.options,r=t.name,i=n.offset,o=void 0===i?[0,0]:i,a=yo.reduce((function(t,n){return t[n]=function(t,e,n){var r=Eo(t),i=[go,po].indexOf(r)>=0?-1:1,o="function"==typeof n?n(Object.assign({},e,{placement:t})):n,a=o[0],s=o[1];return a=a||0,s=(s||0)*i,[go,mo].indexOf(r)>=0?{x:s,y:a}:{x:a,y:s}}(n,e.rects,o),t}),{}),s=a[e.placement],c=s.x,u=s.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=a}},{name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var i=n.mainAxis,o=void 0===i||i,a=n.altAxis,s=void 0===a||a,c=n.fallbackPlacements,u=n.padding,l=n.boundary,f=n.rootBoundary,d=n.altBoundary,p=n.flipVariations,h=void 0===p||p,m=n.allowedAutoPlacements,g=e.options.placement,v=Eo(g),_=c||(v===g||!h?[Jo(g)]:function(t){if("auto"===Eo(t))return[];var e=Jo(t);return[Qo(t),e,Qo(e)]}(g)),y=[g].concat(_).reduce((function(t,n){return t.concat("auto"===Eo(n)?ca(e,{placement:n,boundary:l,rootBoundary:f,padding:u,flipVariations:h,allowedAutoPlacements:m}):n)}),[]),w=e.rects.reference,b=e.rects.popper,S=new Map,k=!0,x=y[0],I=0;I<y.length;I++){var P=y[I],E=Eo(P),C="start"===oa(P),T=[po,ho].indexOf(E)>=0,R=T?"width":"height",O=sa(e,{placement:P,boundary:l,rootBoundary:f,altBoundary:d,padding:u}),F=T?C?mo:go:C?ho:po;w[R]>b[R]&&(F=Jo(F));var M=Jo(F),D=[];if(o&&D.push(O[E]<=0),s&&D.push(O[F]<=0,O[M]<=0),D.every((function(t){return t}))){x=P,k=!1;break}S.set(P,D)}if(k)for(var j=function(t){var e=y.find((function(e){var n=S.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return x=e,"break"},$=h?3:1;$>0;$--){if("break"===j($))break}e.placement!==x&&(e.modifiersData[r]._skip=!0,e.placement=x,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name,i=n.mainAxis,o=void 0===i||i,a=n.altAxis,s=void 0!==a&&a,c=n.boundary,u=n.rootBoundary,l=n.altBoundary,f=n.padding,d=n.tether,p=void 0===d||d,h=n.tetherOffset,m=void 0===h?0:h,g=sa(e,{boundary:c,rootBoundary:u,padding:f,altBoundary:l}),v=Eo(e.placement),_=oa(e.placement),y=!_,w=No(v),b="x"===w?"y":"x",S=e.modifiersData.popperOffsets,k=e.rects.reference,x=e.rects.popper,I="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,P={x:0,y:0};if(S){if(o||s){var E="y"===w?po:go,C="y"===w?ho:mo,T="y"===w?"height":"width",R=S[w],O=S[w]+g[E],F=S[w]-g[C],M=p?-x[T]/2:0,D="start"===_?k[T]:x[T],j="start"===_?-x[T]:-k[T],$=e.elements.arrow,A=p&&$?Ro($):{width:0,height:0},N=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},L=N[E],B=N[C],q=Wo(0,k[T],A[T]),W=y?k[T]/2-M-q-L-I:D-q-L-I,X=y?-k[T]/2+M+q+B+I:j+q+B+I,U=e.elements.arrow&&Ao(e.elements.arrow),V=U?"y"===w?U.clientTop||0:U.clientLeft||0:0,H=e.modifiersData.offset?e.modifiersData.offset[e.placement][w]:0,G=S[w]+W-H-V,z=S[w]+X-H;if(o){var J=Wo(p?Bo(O,G):O,R,p?Lo(F,z):F);S[w]=J,P[w]=J-R}if(s){var K="x"===w?po:go,Q="x"===w?ho:mo,Y=S[b],Z=Y+g[K],tt=Y-g[Q],et=Wo(p?Bo(Z,G):Z,Y,p?Lo(tt,z):tt);S[b]=et,P[b]=et-Y}}e.modifiersData[r]=P}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,n=t.state,r=t.name,i=t.options,o=n.elements.arrow,a=n.modifiersData.popperOffsets,s=Eo(n.placement),c=No(s),u=[go,mo].indexOf(s)>=0?"height":"width";if(o&&a){var l=function(t,e){return Xo("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:Uo(t,vo))}(i.padding,n),f=Ro(o),d="y"===c?po:go,p="y"===c?ho:mo,h=n.rects.reference[u]+n.rects.reference[c]-a[c]-n.rects.popper[u],m=a[c]-n.rects.reference[c],g=Ao(o),v=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,_=h/2-m/2,y=l[d],w=v-f[u]-l[p],b=v/2-f[u]/2+_,S=Wo(y,b,w),k=c;n.modifiersData[r]=((e={})[k]=S,e.centerOffset=S-b,e)}},effect:function(t){var e=t.state,n=t.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=e.elements.popper.querySelector(r)))&&Oo(e.elements.popper,r)&&(e.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,n=t.name,r=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,a=sa(e,{elementContext:"reference"}),s=sa(e,{altBoundary:!0}),c=ua(a,r),u=ua(s,i,o),l=la(c),f=la(u);e.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:u,isReferenceHidden:l,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":f})}}]});var _a=function(t){function e(e){t.call(this,e),this._targetElementCheckingIntervalId=null,this._popper=null,this._getTargetElement=this._getTargetElement.bind(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getTargetElement=function(){return O(this._settings.target)[0]},e.prototype._initWrappers=function(t){var e=this._initBaseWrapper();e.css({display:"block",textAlign:"left",maxHeight:"100%",maxWidth:"100%",zIndex:99999998});var n=this._initAnimationWrapper();return n.css({position:"relative",zIndex:1}),n.append(e),t.append(n),{$animationWrapper:n,$baseWrapper:e}},e.prototype._initPopper=function(t){var e=this;e._popper=va(e._getTargetElement(),t,{placement:e._settings.element_position,modifiers:[{name:"offset",options:{offset:function(t){return function(t,e,n){var r=0,i=0;return!function(t){return-1!==t.indexOf("top")||-1!==t.indexOf("bottom")}(t)?function(t){return-1!==t.indexOf("left")||-1!==t.indexOf("right")}(t)&&(i=e,r=n):(i=n,r=e),function(t){return-1!==t.indexOf("end")}(t)&&(r*=-1),[r,i]}(t.placement,e._settings.element_horizontal_offset,e._settings.element_vertical_offset)}}}]})},e.prototype._clearPopper=function(){this._popper&&(this._popper.destroy(),this._popper=null)},e.prototype.onRender=function(){var t=this;return new Promise((function(e){var n=setInterval((function(){t._getTargetElement()&&(clearInterval(n),e())}),100)}))},e.prototype.onShow=function(t,e){var n=this;return new Promise((function(r){var i=n._initWrappers(e),o=i.$baseWrapper,a=i.$animationWrapper;o.append(t),n._initPopper(a[0]),n._runAnimation(a,n._settings.animation_in,(function(){n._targetElementCheckingIntervalId=setInterval((function(){var t=n._getTargetElement();!t&&e.filterVisible().length&&n._popper&&(e.hide(),n._clearPopper()),!t||e.filterVisible().length||n._popper||(e.show(),n._initPopper(a[0]))}),100),r()}))}))},e.prototype.onClose=function(t){var e=this,n=e._getAnimationWrapper(t),r=e._getBaseWrapper(t);return new Promise((function(t){e._runAnimation(n,e._settings.animation_out,(function(){r.remove(),n.css({position:"static",height:0,minHeight:0,overflow:"visible"}),e._clearPopper(),e._targetElementCheckingIntervalId&&clearInterval(e._targetElementCheckingIntervalId),t()}))})).catch((function(){e._clearPopper()}))},e}(oo),ya=Yt(Qr,{__constructor:function(t){this.__base(t);var e=t.form.settings.behavior_settings.partscreen||{},n=this._getDeviceSettings(e);this.settings=r.defaults({},n,e,{animation_in:"fadeIn",animation_out:"fadeOut",paranja_opacity:.3,paranja_color:"black",position:"center",horizontal_offset:0,vertical_offset:0,allow_overlay:!1,target:"window",element_position:"right",element_horizontal_offset:0,element_vertical_offset:0}),"desktop"===this._device||n.hasOwnProperty("horizontal_offset")||(this.settings.horizontal_offset=0),"desktop"===this._device||n.hasOwnProperty("vertical_offset")||(this.settings.vertical_offset=0);var i={id:this.formId,settings:this.settings,runAnimation:this._runAnimation};this._positioner="window"===this.settings.target?new fo(i):new _a(i)},_positioner:null,shouldRender:function(){return this._positioner.shouldRender()},onRender:function(){return this._positioner.onRender()},onShow:function(t,e){var n=this._getForm(t),r=this._getContainer(t);Promise.resolve(this._positioner.onShow(n,r,e.close)).then((function(){n.find("."+Bt.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){e.close(O(this).data("popmechanic-close"))}))}))},onClose:function(t){var e=this._getContainer(t);return this._positioner.onClose(e)}}),wa=Yt(Jr,{__constructor:function(t){this.__base(t);var e=r.defaults({},t.form.settings.behavior_settings.popup,{paranja_opacity:.3,animation_type:"slide",animation_settings:{from:"top"}});this.animationType=e.animation_type,this.animationSettings=e.animation_settings,this.paranjaOpacity=e.paranja_opacity},_prepareAnimation:function(t){if("slide"===this.animationType){var e={};e["margin-"+this.animationSettings.from]=-Math.max(window.innerWidth,window.innerHeight),t.css(e)}else this._initialOpacity=t.css("opacity")||1,t.css({opacity:0})},_runAnimation:function(t,e){var n={};"slide"===this.animationType?n["margin-"+this.animationSettings.from]=0:n.opacity=this._initialOpacity,t.animate(n,{duration:Bt.ANIMATION_SPEED,queue:!1,always:e})},onRender:function(t,e,n){var r=this._filterForm(t),i=O('<div class="'+Bt.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=i,n.append(i),this._$paranja=O('<div class="'+Bt.CSS_PREFIX+'js-paranja" id="'+Bt.CSS_PREFIX+"paranja-"+this.formId+'">').css({display:"block",position:"absolute",top:"0",left:"0",bottom:"0",right:"0","background-color":"black",opacity:"0",pointerEvents:"all","z-index":1e6}),i.append(this._$paranja),i.css({position:"relative","text-align":"center",margin:"0",top:0,left:0,right:0}),r.css({display:"inline-block","z-index":100000002,position:"relative","vertical-align":"middle","text-align":"left"}),this._prepareAnimation(i)},onShow:function(t,e){var n=this._getForm(t),r=this._$formWrapper,i=this._getContainer(t),o=this._$paranja,a=this;ne(),this._$formWrapper.append(n),setTimeout((function(){i.css({position:"fixed",top:0,left:0,right:0,bottom:0,height:"auto","min-height":0,overflow:"auto","z-index":1e8}),a._$vaHelper=O("<div></div>"),a._$vaHelper.css({height:window.innerHeight,display:"inline-block",width:0,"vertical-align":"middle"}).appendTo(r),O(window).on("resize",(function(){a._$vaHelper.css({height:window.innerHeight})})),o.animate({opacity:a.paranjaOpacity},{duration:Bt.ANIMATION_SPEED,queue:!1}),a._runAnimation(a._$formWrapper,(function(){o.on("click",(function(){e.close(!1)})),n.find("."+Bt.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){e.close(O(this).data("popmechanic-close"))}))})),O(document).on("keyup",(function(t){27==t.keyCode&&e.close()}))}),10)},onClose:function(t){var e=this,n=this._getContainer(t);return new Promise((function(r){t.animate({top:"-50%"},Bt.ANIMATION_SPEED,(function(){e._$paranja.animate({opacity:"0"},Bt.ANIMATION_SPEED,(function(){e._$paranja.remove(),e._$vaHelper.remove(),e._$formWrapper.remove(),n.css({position:"static",height:0,"min-height":0}),re(),r()}))}))}))},onSuccess:function(){},onFail:function(){}}),ba=Yt(Jr,{onSuccess:function(t){return new Promise((function(e){t.addClass(Bt.CSS_PREFIX+"success"),setTimeout(e,6e3)}))}});function Sa(t,e){return void 0===e&&(e=0),Math.floor(e+Math.random()*(t-e))}var ka=function(t){return"https://picsum.photos/"+Sa(300,200)+"/"+Sa(300,200)+"?image="+t},xa=function(t){var e=t.shopId,n=t.listName,r=t.consoleNotificator,i=t.trackerName,o=t.trySendGa4Event,a=t.measurementId;this._shopId=e,this._listName=n,this._consoleNotificator=r,this._trackerName=i,this._measurementId=a,this._trySendGa4Event=o};xa.prototype.selectItem=function(t,e,n){},xa.prototype.viewItemList=function(t,e,n){};var Ia=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._transform=function(t,e){try{return{item_id:t.ids[this._shopId],item_name:t.displayName,item_list_name:this._listName,item_brand:t.manufacturer?t.manufacturer.name:"",price:t.price,index:e+1,quantity:1}}catch(t){return void this._consoleNotificator.log(t)}},e.prototype._sendProductEvent=function(t,e){var n=e.product,r=e.index,i=e.props,o=this._transform(n,r);if(o){var a={item_list_name:this._listName,items:[o]},s={};this._measurementId&&Object.assign(s,{send_to:this._measurementId}),i&&Object.assign(s,i);var c={ecommerce:a};Object.keys(s).length&&Object.assign(c,{common:s});try{this._trySendGa4Event(t,c)}catch(t){this._consoleNotificator.log(t)}}},e.prototype.selectItem=function(t,e,n){this._sendProductEvent("select_item",{product:t,index:e,props:n})},e.prototype.viewItemList=function(t,e,n){this._sendProductEvent("view_item_list",{product:t,index:e,props:n})},e}(xa),Pa=function(t,e){void 0===e&&(e={});var n=e.common,r=e.ecommerce;if(window.gtag){var i={};return n&&Object.assign(i,n),r&&Object.assign(i,r),Object.keys(i).length?void window.gtag("event",t,i):void window.gtag("event",t)}if(window.dataLayer){var o={};return n&&Object.assign(o,n),r&&Object.assign(o,{ecommerce:r}),void window.dataLayer.push(Object.assign({event:t},o))}throw Error("no google analytics on site")},Ea=function(t){this._formId=t};Ea.prototype.log=function(t){Ee.log("form #"+this._formId+" Google Analytics integration failed:",t)};var Ca={location:"",ids:[]},Ta=[];function Ra(){return!!Math.floor(Math.random()+.5)}function Oa(t,e){var n,r="Product №"+Sa(1e5),i=Sa(1e5,1),o=Ra?Math.round(i*(1+.5*Math.random())):i;return"number"!=typeof t&&(t=Sa(70,50)),{ids:(n={mindboxId:Sa(1e4)},n[e]=Sa(1e4),n),name:r,displayName:r,description:Array(Sa(6,4)).fill("lorem ipsum").join(" "),code:"Category",url:"#",pictureUrl:ka(t),price:i,oldPrice:o,manufacturer:{name:"Mfr"}}}var Fa=Yt(Jr,{__constructor:function(t,e){void 0===e&&(e={trySendGa4Event:Pa}),this.__base(t,e),this.view=t,this.behaviorSettings=r.defaults({},t.form.settings.behavior_settings.reco_data,{shopId:"website",operations:[],productIdsCode:null,filterByOtherReco:!1,returnOptimizedPictures:!1,priceLocale:"ru-RU",ga:{enabled:"1"===t.form.settings.settings.enableGA,trackerName:t.form.settings.settings.gaTrackerName||"",listName:t.form.settings.settings.gaListName||"",measurementId:t.form.settings.settings.gaMeasurementId||""}}),this.currentEntityDataIds=[],this.onBeforeRenderRejectIsDebuggable=!1,this.behaviorSettings.shopId=function(t){if(!t)return"";var e=t[0],n=t.slice(1);return""+e.toLowerCase()+n}(this.behaviorSettings.shopId),this._reportedMbError=!1,this.recommendations=[],this._handleSuccess=this._handleSuccess.bind(this),this._handleError=this._handleError.bind(this),this._reportMbError=this._reportMbError.bind(this),this._parseMbError=this._parseMbError.bind(this),this._processQueue=this._processQueue.bind(this),this._sendRequest=this._sendRequest.bind(this),this._reportSlaSuccess=this._reportSlaSuccess.bind(this),this._reportSlaFailure=this._reportSlaFailure.bind(this),this._setProductPriceAndDiscount=this._setProductPriceAndDiscount.bind(this),this._getEntityDataIds=this._getEntityDataIds.bind(this),this._logError=this._logError.bind(this),this._trackClick=this._trackClick.bind(this);var n=this.behaviorSettings.ga.enabled?Ia:xa;this._gaTracker=new n({shopId:this.behaviorSettings.shopId,consoleNotificator:new Ea(this.formId),trackerName:this.behaviorSettings.ga.trackerName,listName:this.behaviorSettings.ga.listName,measurementId:this.behaviorSettings.ga.measurementId,trySendGa4Event:this._dependencies.trySendGa4Event})},onInit:function(){this._setRecoType(this.behaviorSettings)},onBeforeRender:function(t,e){var n=this;n.behaviorSettings.recoType||n._setRecoType(this.behaviorSettings);var i=n.behaviorSettings.operations.filter((function(t){return!t.disabled}));return this._getEntityDataIds(e,i[0]&&i[0].recoType).then((function(t){return n.currentEntityDataIds=t,function(){var t=Promise.resolve();n.sendArea=e.attr("data-popmechanic-area")||window.mindboxAreaId;try{if(window.mindbox&&-1===location.href.indexOf("pm-dummy")){try{t=Promise.all(i.map((function(t){return n._processQueue([t.id],t.recoType,t.limit,0)}))).then((function(t){return r.chain(t).flatten().map((function(t){return t.ids.mindboxId=t.ids.mindboxId||t.ids.productId,t})).uniq(!1,(function(t){return t.ids.mindboxId})).value()})).then(n._handleSuccess).catch(n._handleError)}catch(t){n._logError(t)}window.mindboxInitialized||n._reportSlaSuccess()}else location.href.indexOf("pm-dummy")>-1?(n._handleSuccess(n._getFakeRecommendations()),n._reportSlaSuccess()):n._reportSlaSuccess()}catch(t){n._logError(t),n.recommendations=[],n._reportSlaFailure(encodeURIComponent(t.message))}return t}()}))},onClose:function(){},_trackClick:function(t){try{window.mindbox("async",{operation:"popmechanic-widget-click-"+this.formId,data:{clicked:{product:{ids:t.ids}}},onSuccess:function(){},onError:function(){}})}catch(t){this._logError(t)}},getSettings:function(){return{recommendations:this.recommendations,gaTracker:this._gaTracker,tracking:{click:this._trackClick}}},_setRecoType:function(t){t.operations.forEach((function(t){switch(t.recoTarget){case"Offer":t.recoType="product";break;case"Category":t.recoType="category";break;default:t.recoType="personal"}})),this.behaviorSettings.recoType=this.behaviorSettings.operations[0]?this.behaviorSettings.operations[0].recoType:"personal"},_setProductPriceAndDiscount:function(t){var e=r.extend({},t);e.customFields=e.customFields||{},e.oldPrice&&e.oldPrice<=e.price&&(e.oldPrice=null),e.discount=null,e.oldPrice&&e.oldPrice!==e.price&&(e.discount=(100*(e.oldPrice-e.price)/e.oldPrice).toFixed(0)+"%");try{e.formattedPrice=e.price.toLocaleString(this.behaviorSettings.priceLocale),e.oldPrice&&(e.formattedOldPrice=e.oldPrice.toLocaleString(this.behaviorSettings.priceLocale))}catch(t){}return e},_filterProductListByOtherReco:function(t){var e=location.href.split("#")[0];if(Ca.location!==e||location.href.indexOf(".mindbox.ru")>-1||location.href.indexOf(".directcrm.ru")>-1)return t;var n=Ca.ids;return t.filter((function(t){return-1===n.indexOf(t.ids.mindboxId)}))},_saveProductIdsToFilter:function(t){var e=location.href.split("#")[0];(Ca.location!==e||location.href.indexOf(".mindbox.ru")>-1||location.href.indexOf(".directcrm.ru")>-1)&&(Ca={location:e,ids:[]});var n=r.map(t,(function(t){return t.ids.mindboxId}));Ca.ids=r.union(Ca.ids,n)},_handleSuccess:function(t){var e=this;try{e.currentEntityDataIds.length&&"category"!==e.behaviorSettings.recoType&&(t=t.filter((function(t){var n=t.ids[e.behaviorSettings.shopId];return void 0!==n&&-1===e.currentEntityDataIds.indexOf(n.toString())})))}catch(t){e._logError(t)}var n=e.behaviorSettings.filterByOtherReco?e._filterProductListByOtherReco(t):t;if(e._saveProductIdsToFilter(n),e.recommendations=n.map(e._setProductPriceAndDiscount),!e.recommendations.length)return Promise.reject("no data from mindbox")},_handleError:function(t){return this.recommendations=[],this._reportedMbError||"no data from mindbox"===t?this._reportSlaSuccess():this._reportSlaFailure(t||"request error"),this._logError(t||"request error"),Promise.reject(t)},_logError:function(t){Oe.log("reco widget "+this.formId+": ",t)},_processQueue:function(t,e,n,r){var i=this;if(!t||r>t.length)return Promise.resolve([]);var o=t[r],a=i._getRequestParams(e,n);return i._sendRequest(o,e,a).catch((function(o){return i._logError(o),i._processQueue(t,e,n,r+1)}))},_getRequestParams:function(t,e){var n,r,i=this.behaviorSettings.shopId,o={recommendation:{returnOptimizedPictures:!!this.behaviorSettings.returnOptimizedPictures,limit:e}};if(this.sendArea&&(o.recommendation.area={ids:{externalId:this.sendArea}}),"product"===t){var a=this.currentEntityDataIds[0];o.recommendation.product={ids:(n={},n[i]=a,n)}}if("category"===t){var s=this.currentEntityDataIds[0];o.recommendation.productCategory={ids:(r={},r[i]=s,r)}}return o},_sendRequest:function(t,e,n){var r=this;return t?ln.getMindboxIsReadyPromise().then((function(){return new Promise((function(i,o){var a=!1;window.mindbox("sync",{operation:t,data:n,onSuccess:function(t){a=!0,i(t.recommendations||[])},onError:function(t){a=!0;var i=r._parseMbError(t,e,n);r._reportMbError(i),o(t)}}),setTimeout((function(){a||r._reportSlaSuccess()}),1e3)}))})).catch((function(){return[]})):Promise.resolve([])},_parseMbError:function(t,e,n){var r="unknownError",i={},o=/^Unknown endpoint: "([^"]+)"/,a=this.behaviorSettings.shopId;return o.test(t.errorMessage)?(r="endpointInvalid",i={endpoint:t.errorMessage.replace(o,"$1"),site:document.location.host}):"product"===e&&/Продукт не найден/.test(t.message)?(r="productNotFound",void 0===(i={productId:n.recommendation.product.ids[a]}).productId&&(i.productId="undefined")):"category"===e&&/Категория продуктов не найдена/.test(t.message)&&(r="categoryNotFound",void 0===(i={categoryId:n.recommendation.productCategory.ids[a]}).categoryId&&(i.categoryId="undefined")),{type:r,payload:i,url:document.location.href}},_reportMbError:function(t){var e=Bt.WEB_URL;if("unknownError"!==t.type){this._reportedMbError=!0;try{O.ajax({type:"post",url:e+window.PopMechanic.client+"/report/"+this.formId+"/",data:JSON.stringify(t),contentType:"application/json",dataType:"json"})}catch(t){this._logError(t)}}else this._reportedMbError=!1},_getFakeRecommendations:function(){var t=this;if(!Ta.length){Ta=[];var e=r.reduce(t.behaviorSettings.operations,(function(t,e){return e.disabled||"number"!=typeof e.limit?t:t+e.limit}),0);Ta=r.times(e,(function(e){return Oa(e+50,t.behaviorSettings.shopId)}))}return Ta},_reportSlaSuccess:function(t){this.view.form.reportSlaSuccess(t)},_reportSlaFailure:function(t){this.view.form.reportSlaFailure(t)},_getEntityDataIds:function(t,e){var n=this;return new Promise((function(r){try{if("string"==typeof n.behaviorSettings.productIdsCode){var i=new Function(n.behaviorSettings.productIdsCode)();r(i)}}catch(t){}var o=t.attr("data-popmechanic-argument");o&&"ID продукта в mindbox"!==o&&r(o.split(",")),(!e||"product"!==e&&"category"!==e)&&r([]),lr().then((function(t){var i=n.behaviorSettings.shopId,o=[];t&&t[e]&&t[e].ids[i]&&(o=[t[e].ids[i]]),r(o)}),(function(){r([])}))}))}}),Ma="https://personalization-speedtest-stable.mindbox.ru";var Da=function(){if(!function(){var t=Boolean(window.MindboxEndpointSettings),e=Boolean(window.PopMechanic&&window.PopMechanic.isSlaTrackingOn);return t&&e}())return 0;if("hidden"===document.visibilityState)return window.PopMechanic.tabVisibility.duration;var t=Date.now()-window.PopMechanic.tabVisibility.lastVisibilityStart;return window.PopMechanic.tabVisibility.duration+t},ja=0,$a=function(){this._startTrackingAt=null,this._lastPauseAt=null,this._pauseDuration=0,this._currentRecoSearchBlockTime=0,this._handleVisibilityChange=this._handleVisibilityChange.bind(this)};$a.prototype.startTracking=function(){0===this._currentRecoSearchBlockTime&&(0===ja&&window.PopMechanic.pauseWatchdog&&(window.PopMechanic.pauseWatchdog(),window.PopMechanic.watchdogPaused=!0),document.addEventListener("visibilitychange",this._handleVisibilityChange),this._startTrackingAt=Date.now())},$a.prototype.stopTracking=function(){0===this._currentRecoSearchBlockTime&&(document.removeEventListener("visibilitychange",this._handleVisibilityChange),null!==this._startTrackingAt&&(this._currentRecoSearchBlockTime=Date.now()-this._startTrackingAt-this._pauseDuration,0===ja&&(ja=this._currentRecoSearchBlockTime,window.PopMechanic._saveWatchdogFirstRecoSearchBlockTime&&window.PopMechanic._saveWatchdogFirstRecoSearchBlockTime(ja),window.PopMechanic.resumeWatchdog&&(window.PopMechanic.watchdogPaused=!1,window.PopMechanic.resumeWatchdog(Da())))))},$a.prototype._pauseTracking=function(){this._lastPauseAt=Date.now()},$a.prototype._resumeTracking=function(){null!==this._lastPauseAt&&(this._pauseDuration+=Date.now()-this._lastPauseAt,this._lastPauseAt=null)},$a.prototype._handleVisibilityChange=function(){"hidden"===document.visibilityState?this._pauseTracking():this._resumeTracking()},$a.prototype.getCurrentRecoSearchBlockTime=function(){return this._currentRecoSearchBlockTime},$a.getFirstRecoSearchBlockTime=function(){return ja},Ue("destroy",$a.resetFirstRecoSearchBlockTime=function(){ja=0});var Aa=parseInt("30000",10);function Na(){if(!window.PopMechanic.sampleSent){window.PopMechanic.sampleSent=!0;var t=$a.getFirstRecoSearchBlockTime(),e=ln.getTabVisibilityDuration(),n=e-t,r=window.PopMechanic.initReadyTs,i=window.PopMechanic.targetingReadyTs,o=navigator&&navigator.connection&&navigator.connection.downlink,a=ln.getDeviceType(),s=navigator&&navigator.webdriver,c=Ma+"/check-reco?result=unknown&t="+n+"&t1="+r+"&t2="+i+"&tl="+e+"&ts="+t+"&dl="+("number"==typeof o?o:"unknown")+"&dt="+a+"&wd="+(s?"1":"0")+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&_="+ +Date.now();navigator&&navigator.sendBeacon(c,"")}}var La=[],Ba=Yt(Jr,{__constructor:function(t,e){this.__base(t,e),this.form=t.form,this.unloadReporter=t.form.init.unloadReporter},onTargetingReady:function(t){if(!this.form.isControlGroup){if(window.PopMechanic.slaRequired=!0,La.push(this.formId),"function"==typeof window.PopMechanic._saveWatchdogInfo){var e=$a.getFirstRecoSearchBlockTime();window.PopMechanic._saveWatchdogInfo(La,e)}t.form.reportSlaSuccess=this._reportSlaSuccess.bind(this),t.form.reportSlaFailure=this._reportSlaFailure.bind(this),this.unloadReporter.enable()}},_reportSlaSuccess:function(t){if(La=r.without(La,this.formId),"function"==typeof window.PopMechanic._saveWatchdogInfo){var e=$a.getFirstRecoSearchBlockTime();window.PopMechanic._saveWatchdogInfo(La,e)}if(0===La.length){var n=this.form.recoBlockSearchTimeTracker?this.form.recoBlockSearchTimeTracker.getCurrentRecoSearchBlockTime():0;!function(t,e,n){if(!window.PopMechanic.sampleSent){var r=$a.getFirstRecoSearchBlockTime(),i=ln.getTabVisibilityDuration(),o=i-r;if(o>Aa)return ln.reportFailure("timeout",e,[],r);window.PopMechanic.sampleSent=!0;var a=ln.getTabInvisibilityDuration(),s=window.PopMechanic.tabVisibility.startedInvisible,c=window.PopMechanic.initReadyTs,u=window.PopMechanic.targetingReadyTs,l=navigator&&navigator.connection&&navigator.connection.downlink,f=ln.getDeviceType(),d=navigator&&navigator.webdriver;(new Image).src=Ma+"/check-reco?result=success"+(t?"&reason="+t:"")+"&t="+o+"&t1="+c+"&t2="+u+"&tl="+i+"&ti="+a+"&ts="+r+"&tcs="+n+"&si="+(s?"1":"0")+"&dl="+("number"==typeof l?l:"unknown")+"&dt="+f+"&wd="+(d?"1":"0")+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&fid="+e+"&_="+ +Date.now()}}(t,this.formId,n)}},_reportSlaFailure:function(t,e){var n="";"object"==typeof e?n=e.message||JSON.stringify(e):"string"==typeof e&&(n=e),ln.reportFailure(t,this.formId,[],0,n)}});var qa={top:"fadeInUp",bottom:"fadeInDown",left:"fadeInLeft",right:"fadeInRight","top-left":"fadeInUp","top-right":"fadeInUp","bottom-left":"fadeInDown","bottom-right":"fadeInDown"},Wa={top:"fadeOutUp",bottom:"fadeOutDown",left:"fadeOutLeft",right:"fadeOutRight","top-left":"fadeOutUp","top-right":"fadeOutUp","bottom-left":"fadeOutDown","bottom-right":"fadeOutDown"},Xa=Yt(Jr,{__constructor:function(t){this.__base(t),this.settings=r.defaults({},t.form.settings.behavior_settings.scrollbox,{direction:"bottom",horizontal_offset:0,vertical_offset:0}),this.settings.animation_in||(this.settings.animation_in=qa[this.settings.direction]),this.settings.animation_out||(this.settings.animation_out=Wa[this.settings.direction]),this.staticStyles=r.extend({},function(t){return-1!==t.direction.indexOf("top")?{top:0,"margin-top":t.vertical_offset}:-1!==t.direction.indexOf("bottom")?{bottom:0,"margin-bottom":t.vertical_offset}:{top:"50%",transform:"translate(0, -50%)"}}(this.settings),function(t){return-1!==t.direction.indexOf("left")?{left:0,"margin-left":t.horizontal_offset}:-1!==t.direction.indexOf("right")?{right:0,"margin-right":t.horizontal_offset}:{left:"50%",transform:"translate(-50%, 0)"}}(this.settings))},onRender:function(t,e,n){this._filterForm(t);var i=O('<div class="'+Bt.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=i,n.append(i);var o={display:"block","z-index":100000002,position:"fixed","text-align":"left"};r.extend(o,this.staticStyles),i.css(o)},onShow:function(t,e){var n=this._getForm(t);this._$formWrapper.append(n),this._runAnimation(n,this.settings.animation_in),n.find("."+Bt.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){e.close(O(this).data("popmechanic-close"))}))},onClose:function(t){var e=this,n=this._getForm(t);return new Promise((function(r){e._runAnimation(n,e.settings.animation_out,(function(){t.css({position:"static",height:0,"min-height":0}),r()}))}))},onSuccess:function(){},onFail:function(){}});var Ua={seconds:function(t){return Math.floor(t%60)},minutes:function(t){return Math.floor(t/60)%60},hours:function(t){return Math.floor(t/3600)%24},days:function(t){return Math.floor(t/86400)}},Va=Yt(Jr,{__constructor:function(t){this.__base(t),this._updateLoop=null,this._showTime=Math.floor(xe()/1e3),this._settings=t.form&&t.form.settings&&t.form.settings.behavior_settings&&t.form.settings.behavior_settings.timer||{}},_getTimers:function(t,e){if(!r.isArray(t))return[];var n=this;return r.chain(t).filter((function(t){return"timer"===t.type})).map((function(t){var r="object"==typeof e[t.machine_name]?e[t.machine_name]:JSON.parse(e[t.machine_name]);return{id:t.machine_name,settings:r,end:n._getEndTime(r)}})).value()},_getEndTime:function(t){switch(t.type){case"end":return t.end.date;case"range":return"visit"===t.range.start?this._showTime+t.range.duration:t.range.start+t.range.duration;case"cycle":if(!t.cycle||!t.cycle.day||!t.cycle.day.length)return 0;var e=new Date,n=(24*e.getUTCDay()*60*60+60*e.getUTCHours()*60+60*e.getUTCMinutes()+e.getUTCSeconds())%604800,i=t.cycle.time.split(":");i=60*i[0]*60+60*i[1]+60*t.cycle.local;var o=r.chain(t.cycle.day).map((function(t){return(24*t*60*60+i)%604800})).sortBy(r.identity).value(),a=o.filter((function(t){return t<=n})),s=!a.length,c=s?r.last(o):r.last(a),u=n-c+(s?604800:0);return Math.round(new Date/1e3)-u+t.cycle.duration;default:return 0}},_updateValues:function(t,e,n){var r=this,i=Math.floor(Date.now()/1e3);e.forEach((function(e){Object.keys(Ua).forEach((function(o){var a="[data-"+Bt.CSS_PREFIX+'timer="'+e.id+":"+o+'"]',s=t.find(a),c=e.end-i,u=Ua[o];s.each((function(){var t;try{t=parseInt(O(this).data("popmechanicDigit"),10)}catch(t){}var e,n="number"!=typeof(e=u(c))||e<=0?"00":e<10?"0"+e:""+e;0!==t&&1!==t||(n=n[t]),O(this).html('<span class="'+Bt.CSS_PREFIX+'timer-digit">'+n.split("").join('</span><span class="'+Bt.CSS_PREFIX+'timer-digit">')+"</span>")})),c<=0&&r._settings.close_on_end&&n()}))}))},onBeforeRender:function(t){var e=Math.floor(Date.now()/1e3);this.timers=this._getTimers(t.form.template.parameters,t.form.settings.settings);var n=r.any(this.timers,(function(t){return t.end<e}));if(this._settings.close_on_end&&n)return Promise.reject("Form #"+this.formId+": timer has expired")},onShow:function(t,e){var n=this;n.$view=t,this._updateLoop=setInterval((function(){n._updateValues(t,n.timers,(function(){setTimeout((function(){e.close()}),3e3)}))}),100)},onClose:function(){clearInterval(this._updateLoop)}}),Ha=function(t){var e=t+1;return{count:1,priceOfLine:1e3*e,product:{ids:{website:e}}}},Ga=function(t){var e=1e3*t,n=t+1;return{id:n,price:e,priceWithDiscount:.75*e,name:"Product №"+n,quantity:1,pictureUrl:ka(t),url:"#",brand:"Brand",brandId:120,hasDiscount:!0,category:"Category",categoryId:229,tags:["tag 1"]}},za=Yt(Jr,{__constructor:function(t,e){this.__base(t,e),this._cart=[],this._popmechanicCart=null,this.getSettings=this.getSettings.bind(this),this.onBeforeRender=this.onBeforeRender.bind(this)},onBeforeRender:function(){var t,e=this;return this._dependencies.dummyIsRequired?(this._cart=r.times(3,Ha),this._popmechanicCart=(t=r.times(3,Ga),{total:r.reduce(t,(function(t,e){return t+parseInt(e.price,10)}),0),totalWithDiscount:r.reduce(t,(function(t,e){return t+parseInt(e.priceWithDiscount,10)}),0),products:t}),Promise.resolve()):Promise.all([ln.waitPromisesOrDelay([this._dependencies.getCart().catch((function(){return[]}))],1e3),ln.waitPromisesOrDelay([this._dependencies.getPopmechanicCart().catch((function(){return null}))],1e3)]).then((function(t){e._cart=t[0]&&t[0][0]||[],e._popmechanicCart=t[1]&&t[1][0]||null}))},getSettings:function(){return{cart:this._cart||[],popmechanicCart:this._popmechanicCart||null}}}),Ja={},Ka=function(t){return Ja[t]||(Ja[t]=new Promise((function(e,n){try{window.MindboxScripts[t](),e()}catch(t){n(t)}}))),Ja[t]},Qa={},Ya=function(t){return Qa[t]||(Qa[t]=new Promise((function(e,n){var r=document.createElement("script");r.onload=e,r.onerror=function(t){return n(t)},r.src=t,document.head.appendChild(r)}))),Qa[t]},Za=Yt(Jr,{onBeforeRender:function(){return window.MindboxScripts&&window.MindboxScripts.executeTnsJs?Ka("executeTnsJs").catch((function(t){throw console.error('Error executing "MindboxScripts.executeTnsJs" script:',t),t})):Ya("https://static.popmechanic.ru/media/popmechanic/tns-2.9.2.js?v=2").catch((function(t){throw console.error("Error loading tns-slider script:",t),t}))}}),ts={"banner-h":ai,"banner-v":ai,"copy-code":ui,"form-container":mi,"lead-on-close":eo,"post-text":ba,"reco-data":Fa,"reco-sla":Ba,always:Kr,banner:ai,banner_h:ai,banner_v:ai,button:ci,copy_code:ui,embedded:fi,fullscreen:gi,humble:vi,info:_i,lead:to,lead_on_close:eo,multiscreen:no,partscreen:ya,popup:wa,post_text:ba,reco_data:Fa,reco_sla:Ba,scrollbox:Xa,social:di,timer:Va,cart:za,tns:Za,"tns-legacy":Yt(Jr,{onBeforeRender:function(){return window.MindboxScripts&&window.MindboxScripts.executeTnsNewJs?Ka("executeTnsNewJs").catch((function(t){throw console.error('Error executing "MindboxScripts.executeTnsNewJs" script:',t),t})):Ya("https://static.popmechanic.ru/media/popmechanic/tns-new.js").catch((function(t){throw console.error("Error loading tns-slider script:",t),t}))}})},es={dummyIsRequired:PopMechanic.dummyIsRequired,getCart:ur,getPopmechanicCart:dn,trySendGa4Event:Pa};var ns,rs={getInstances:function(t,e){return t.map((function(t){if(ts[t])return new ts[t](e,es)}))}};(ns=O).fn.fontSpy=function(t,e){var n=ns("html"),r=ns("body");if("string"!=typeof t||""===t)throw"A valid fontName is required. fontName must be a string and must not be an empty string.";var i={font:t,fontClass:t.toLowerCase().replace(/\s/g,""),success:function(){},failure:function(){},testFont:"Courier New",testString:"QW@HhsXJ",glyphs:"",delay:50,timeOut:1e3,callback:ns.noop},o=ns.extend(i,e),a=ns("<span>"+o.testString+o.glyphs+"</span>").css("position","absolute").css("top","-9999px").css("left","-9999px").css("visibility","hidden").css("fontFamily",o.testFont).css("fontSize","250px");r.append(a);var s=a.outerWidth();a.css("fontFamily",o.font+","+o.testFont);var c=function(){var t=a.outerWidth();s!==t?(o.callback(),n.addClass(o.fontClass),o&&o.success&&o.success(),a.remove()):o.timeOut<0?(n.addClass("no-"+o.fontClass),o&&o.failure&&o.failure(),o.callback(new Error("FontSpy timeout")),a.remove()):(setTimeout(c,o.delay),o.timeOut=o.timeOut-o.delay)};c()};var is=O.fn.fontSpy,os=["first_name","last_name","email"],as=Yt({_resources:[],_success:!1,__constructor:function(t){var e=t.template;this.id=e.id,this.html=t.settings.html||e.html,this.css=t.settings.css||e.css,this.behaviors=e.behaviors||[],this.fonts=e.fonts,this.isTargetingEventSent=!1,this.form=t,this.data=e,this.init()},init:function(){this.behaviors=rs.getInstances(this.behaviors,this),this.behaviorsReady=this.form.isControlGroup?Promise.resolve():this._behaviorsOnInit(),this.form.subscribeIntegrations()},_behaviorsOnInit:function(){var t=this,e=this.behaviors.map((function(e){return e.onInit(t)})).filter((function(t){return!!t}));return Promise.all(e)},_getSettings:function(t){var e=r.extend({},this.form.settings.settings,{desktop:te.desktop(),tablet:te.tablet(),mobile:te.mobile(),formId:this.form.id});if(t)return e;var n=[e].concat(this.behaviors.map((function(t){return t.getSettings()})).filter((function(t){return!!t})));return r.extend.apply(r,n)},_extractImports:function(){var t=this._getSettings(!0),e=r.template(this.css)(t).matchAll(/(?:@import)\s(?:url\()?\s?["'](.*?)["']\s?\)?(?:[^;]*);?/gi);Array.from(e).forEach((function(t){t[0];var e=t[1];O("head").append('<link href="'+e+'" rel="stylesheet"/>')}))},_extractFonts:function(){var t=this._getSettings(!0),e=r.template(this.css)(t).match(/@font-face\s{[\s\S]*?}/gi);return e?e.map((function(t){return{name:t.split("font-family:")[1].split(";")[0].trim(),body:t}})):null},_prefetchFonts:function(){var t=this,e=this._extractFonts(),n=this._getSettings(!0);e&&(Zt.append("<style>"+r.template(e.map((function(t){return t.body})).join("\n"))(n)+"</style>"),e.forEach((function(e){t._resources.push(new Promise((function(t){is(e.name,{fontClass:"pm-"+e.name+"-loaded",success:t,fail:t}),setTimeout(t,5e3)})))})))},_prefetchUrl:function(t){var e,n=new Promise((function(n){if(t.indexOf(".ttf")>-1||t.indexOf(".svg")>-1||t.indexOf(".eot")>-1||t.indexOf(".woff")>-1)return n();(e=new Image).onload=n,e.onerror=n,setTimeout(n,5e3),e.src=t}));this._resources.push(n)},_prefetch:function(){var t="",e=/url\((.*?)\)|src="(.*?)"/g;try{var n,r=this._render();for(t=r.html(),r.remove(),this._extractImports();n=e.exec(t);){var i=n[1].replace(/'|"/g,"");this._prefetchUrl(i)}this._prefetchFonts()}catch(t){Oe.log("Warning: prefetch error in #"+this.form.id,t)}},_getCssTemplate:function(t){return le(r.template(this.css)(t),this.form.id)},_getCssReset:function(){var t;return le((t=this.form.id,r.template(ue)({wrapperId:"#"+oe(t)})),this.form.id)},_getHtmlTemplate:function(t){return pe(r.template(this.html)(t),this.form.id).replace(/%([\w.]+?)%/g,(function(t,e){return os.indexOf(e)>-1||0===e.indexOf("customs")?"<span data-popmechanic-var="+e+"></span>":t}))},_setDeviceClasses:function(t){te.mobile()&&t.addClass(Bt.CSS_PREFIX+"mobile"),te.tablet()&&t.addClass(Bt.CSS_PREFIX+"tablet"),te.desktop()&&t.addClass(Bt.CSS_PREFIX+"desktop")},_render:function(){var t,e,n;return t=this._getSettings(),e=O('<style id="'+Bt.CSS_PREFIX+"css-"+this.form.id+'">'+this._getCssTemplate(t)+"</style>"),(n=O(this._getHtmlTemplate(t))).addClass(Bt.CSS_PREFIX+"js-form"),this._setDeviceClasses(n),this.data.need_reset?O('<style id="'+Bt.CSS_PREFIX+"reset-"+this.form.id+'">'+this._getCssReset(t)+"</style>").add(e).add(n):e.add(n)},_handler:function(t,e){var n,i,o=function(){};if(!t)return o;n=this._getSettings();try{i=r.template(t)(n),o=new Function("form","settings",i)}catch(n){return Oe.log("Error creating form#"+this.form.id+", "+e+" handler",i,t,n),o}return function(r){try{return o.call(this,r,n)}catch(n){Oe.log("Error in form#"+r.id+", "+e+" handler",t,n)}}},onTargetingReady:function(){var t=this;if(t.form.containerId){var e=window.PopMechanic.getModel&&window.PopMechanic.getModel(t.form.containerId);if(e&&!e.inTargeting)return}if(t.behaviors.forEach((function(e){try{e.onTargetingReady(t)}catch(t){}})),t.data.on_targeting_ready)try{t.onTargetingReady=t._handler(t.data.on_targeting_ready,"on_targeting_ready"),t.onTargetingReady(t.form)}catch(t){}if(t.data.on_child_ready)try{t.onChildReady=t._handler(t.data.on_child_ready,"on_child_ready")}catch(t){}He("targeting",{form:t.form}),t.isTargetingEventSent=!0,t._prefetch()},controlGroupIsShownNotify:function(){Oe.isDebugging()&&console.log("Form "+this.form.id+" control group is shown")},controlGroupShow:function(){},variantShow:function(){},show:function(t){return this.form.isControlGroup?this.controlGroupShow(t):this.variantShow(t)},success:function(){},close:function(){},terminate:function(){}}),ss=/\/scripts\/v1\/tracker\.js/,cs=[ss,/\/js\/(bydomain|byendpoint)\//,/\/service\/loader\.js/,/\/scripts\/modules\/(personalization|helpers)\.js/,/\/init\/\d+\/(domain_and_endpoint|endpoint|no_endpoint|domain|no_domain)/,/\/js\/service\/v2\/forms\.js/,/\/media\/popmechanic\/(jssha256|tns-2\.9\.2|tns-new)\.js/,/\/js\/service\/styles\.css/,/\/v3\/js\/operations\/sync.+operation=popmechanic-check-segment/,/\/v3\/js\/operations\/sync.+operation=popmechanic-widget-.+-reco/],us=function(){var t=function(){var t=performance.getEntriesByType("navigation")[0],e=performance.getEntriesByType("resource").filter((function(t){return cs.some((function(e){return e.test(t.name)}))})),n=e.find((function(t){return ss.test(t.name)}));return{navTiming:t,resources:e,trackerPerf:n}}(),e=t.navTiming,n=t.resources,r=t.trackerPerf;if(!r)return null;var i={c:window.PopMechanic.client,eid:window.MindboxActualEndpointId,hst:encodeURIComponent(location.hostname),dmn:encodeURIComponent(location.hostname.split(".").reverse().splice(0,2).reverse().join(".")),vs:document.visibilityState},o={pg_dcl:Math.round(e.domContentLoadedEventEnd),pg_pl:Math.round(e.loadEventEnd)},a=Math.round(performance.now()),s=a-Math.round(r.responseEnd),c=function(t){return t.reduce((function(t,e){for(var n=Math.floor(e.domainLookupStart||e.startTime),r=Math.floor(e.responseEnd),i=n;i<r;i++)t.add(i);return t}),new Set).size}(n),u={ff_sh_ft:a,ff_sh_ut:c,ff_atr_sh_ft:s,ff_atr_sh_ut:c-(r.domainLookupStart?Math.round(r.responseEnd)-Math.round(r.domainLookupStart):Math.round(r.duration)),ff_tit:ln.getTabInvisibilityDuration()};return Object.assign({},i,o,u)},ls=!1,fs=function(){if(!ls)try{var t=us();t&&(!function(t){var e=Object.entries(t).reduce((function(t,e){return t+"&"+e[0]+"="+e[1]}),Ma+"/client-stats?");(new Image).src=e}(t),ls=!0)}catch(t){console.debug("Could not send time metrics",t)}},ds=Yt(as,{_resources:[],_success:!1,__constructor:function(t){this.__base(t),this.close=this.close.bind(this)},init:function(){var t=this.form;-1===this.behaviors.indexOf("button")&&t.button_template&&t.button_template.id&&this.behaviors.push("button"),this.__base()},variantShow:function(t){var e,n=se(this.form.id),i=this;this._$elem||ce(this.form.id)||(this._closed=!1,i.form.cancelConditions(),Promise.all(this._resources).then((function(){return i.behaviorsReady})).then((function(){return!(!t&&!window.PopMechanic.isTesting)||(!i.form.newTargeting||i.form.newTargeting.double_check?zr.check(i.form):i.form.inTargeting)})).then((function(o){if(o)return Promise.all(i.behaviors.map((function(t){return Promise.resolve(t.onBeforeRender(i,n)).catch((function(e){return t.onBeforeRenderRejectIsDebuggable&&Oe.isDebugging()?Promise.resolve():Promise.reject(e)}))}))).then((function(){return!1})).catch((function(t){return Oe.log("onBeforeRender error:",t),!0})).then((function(o){if(!o){return(t?Promise.resolve(!0):Promise.all([i.form.checkFrequency(),i.form.checkAccountFrequency()]).then((function(t){var e=t[0],n=t[1];return!!e&&(n?(qe.push({type:"show_start",form:i.form.id,behaviors:i.form.template.behaviors}),!0):(i.form.report("frequency_exceed"),!1))})).catch((function(t){return console.error("Error checking frequency:",t),!0}))).then((function(t){if(t&&r.every(i.behaviors,(function(t){return t.shouldRender()})))return i.onShow=i._handler(i.data.on_show,"on_show"),e=i._render(),i._$container=n,i._$elem=e,Promise.all(i.behaviors.map((function(t){return t.onRender(e,i,n)})).concat(i.form.integrationsOnRender())).then((function(){ce(i.form.id)||(n.append(e),i.behaviors.forEach((function(t){t.onShow(n,i,n)})),i.form.inTargeting||i.form.report("bucket"),i.form.reportShow(),we.setLastShown(i.form.id),"function"==typeof window.PopMechanic.onFormShow&&window.PopMechanic.onFormShow({form:i.form}),i.onShow(i.form),fs())})).catch((function(){e.remove()}))}))}}));i.form.report("targeting_excluded")})))},controlGroupShow:function(t){var e=se(this.form.id),n=this;n.form.cancelConditions();(t||window.PopMechanic.isTesting?Promise.resolve(!0):!n.form.newTargeting||n.form.newTargeting.double_check?zr.check(n.form):Promise.resolve(n.form.inTargeting)).then((function(i){return i?!!t||Promise.all(n.behaviors.map((function(t){return Promise.resolve(t.onBeforeRender(n,e)).catch((function(e){return t.onBeforeRenderRejectIsDebuggable&&Oe.isDebugging()?Promise.resolve():Promise.reject(e)}))}))).then((function(){return!1})).catch((function(t){return Oe.log("onBeforeRender error:",t),!0})).then((function(t){if(!t)return Promise.all([n.form.checkFrequency(),n.form.checkAccountFrequency()]).then((function(t){var e=t[0],r=t[1];return!!e&&(r?i:(n.form.report("frequency_exceed"),!1))})).catch((function(t){return console.error("Error checking frequency:",t),i})).then((function(t){if(t&&r.every(n.behaviors,(function(t){return t.shouldRender()})))return n.form.integrationsOnRender().then((function(){n.form.inTargeting||n.form.report("bucket"),n.controlGroupIsShownNotify(),n.form.reportShow(),fs()}))}))})):(n.form.report("targeting_excluded"),!1)}))},success:function(){var t=this;return this._success=!0,Promise.all(this.behaviors.map((function(e){return e.onSuccess(t._$container,t)}))).then((function(){t.close()}),(function(){t.close()}))},close:function(t){this.terminate(this.form.reportClose,t,!1)},destroy:function(){this.terminate(!1,!1,!0)},terminate:function(t,e,n){var r=this;function i(){r._$elem&&(r._$elem.remove(),r._$elem=null)}r._closed||(Promise.all(this.behaviors.map((function(t){return Promise.resolve(t.onBeforeClose(r._$container,r,{showSuccess:!!e,isBeingDestroyed:n}),(function(){}))}))).then((function(){if(!r._closed)return r._closed=!0,Promise.all(r.behaviors.map((function(t){return t.onClose(r._$container,r,{success:r._success,isBeingDestroyed:n})})))})).then(i,i),"function"==typeof t&&t(),"function"==typeof window.PopMechanic.onFormClose&&window.PopMechanic.onFormClose(this._success),r.onClose=r._handler(r.data.on_close,"on_close"),r.onClose(r.form))}}),ps=Yt({__constructor:function(t,e){var n=t.template;this.id=n.id,this.html=n.html,this.css=n.css,this.behaviors=n.behaviors,this.form=t,this.data=n,this.behaviors=rs.getInstances(e,this),this._behaviorsOnInit()},init:function(){var t=this;this._$elem=O("[data-popmechanic-form="+this.form.id+"]"),this._$elem.each((function(){var e=O(this);e.on("submit",(function(t){t.preventDefault()})),we.isContactsSent(t.form.getLeadType())?e.addClass(Bt.CSS_PREFIX+"submitted"):t.behaviors.forEach((function(n){n.onShow(e,t)}))}))},success:function(t){var e=this;return this._success=!0,Promise.all(this.behaviors.map((function(t){return t.onSuccess(e._$elem,e)}))).then((function(){e.close()}),(function(){e.close()}))},close:function(){}}),hs=null,ms=0,gs={};function vs(t){return function(t){var e,n,r,i,o=!1,a=[],s=[],c=0,u=0,l={};function f(){gs.delta<l.delta.speed&&(r||(r=!0,h(),setTimeout((function(){r=!1}),l.delta.timeout))),function(t,e){return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout((function(){t.apply(r,i)}),e)}}((function(){h()}),l.debounce)()}function d(){h(),addEventListener("scroll",f,!1),addEventListener("resize",f,!1)}function p(){removeEventListener("scroll",f,!1),removeEventListener("resize",f,!1)}function h(){i||(a.forEach((function(t,e){var n,r,i;t&&(n=t,r=l.bounds,(i=n.getBoundingClientRect()).top+i.height>=0&&i.left+i.width>=0&&i.bottom-i.height<=(window.innerHeight||document.documentElement.clientHeight)+r&&i.right-i.width<=(window.innerWidth||document.documentElement.clientWidth)+r)?s[e]&&(s[e]=!1,c++,l.appear&&l.appear(t),l.disappear||l.reappear||(a[e]=null)):(!1===s[e]&&(l.disappear&&l.disappear(t),u++,l.reappear||(a[e]=null)),s[e]=!0)})),l.reappear||l.appear&&(!l.appear||c!==e)||l.disappear&&(!l.disappear||u!==e)||(i=!0,p(),l.done&&l.done()))}function m(){var t;if(!o&&(o=!0,l.init&&l.init(),t="function"==typeof l.elements?l.elements():l.elements)){e=t.length;for(var n=0;n<e;n+=1)a.push(t[n]),s.push(!0);d()}}var g=function(t){l={init:(t=t||{}).init,elements:t.elements,appear:t.appear,disappear:t.disappear,done:t.done,reappear:t.reappear,bounds:t.bounds||0,debounce:t.debounce||50,delta:{speed:t.deltaSpeed||50,timeout:t.deltaTimeout||500}},addEventListener("DOMContentLoaded",m,!1);var e=!1;Function("/*@cc_on return document.documentMode===10@*/")()&&(e=!0);var r="complete"===document.readyState||"loaded"===document.readyState;return e?r&&m():(r||"interactive"===document.readyState)&&m(),{trigger:function(){h()},pause:function(){p()},resume:function(){d()},destroy:function(){a=[],n&&clearTimeout(n),p()}}};if("undefined"==typeof module||void 0===module.exports)return g;module.exports=g}()(t)}addEventListener("scroll",(function(){var t=window.scrollY||window.pageYOffset;null!=hs&&(gs.velocity=t-hs,gs.delta=gs.velocity>=0?gs.velocity:-1*gs.velocity),hs=t,ms&&clearTimeout(ms),ms=setTimeout((function(){hs=null}),30)}),!1);var _s=Yt(as,{_success:!1,_appear:null,$target:null,__constructor:function(t){this.__base(t)},init:function(){var t=this.form;this.placement=t.embed_selector?t.placement:"end",this.__base()},controlGroupShow:function(){var t,e=this;return Promise.resolve(e.form.getTargetElement&&e.form.getTargetElement()).then((function(n){t=n,e.onTargetingReady()})).then((function(){return window.PopMechanic.isTesting||zr.check(e.form)})).then((function(n){return n?Promise.all(e.behaviors.map((function(n){return Promise.resolve(n.onBeforeRender(e,t)).catch((function(t){return n.onBeforeRenderRejectIsDebuggable&&Oe.isDebugging()?Promise.resolve():Promise.reject(t)}))}))).then((function(){return!1})).catch((function(t){return Oe.log("onBeforeRender error:",t),!0})).then((function(r){if(!r)return e.form.checkFrequency().then((function(t){return!!t&&n})).catch((function(t){return console.error("Error checking frequency:",t),n})).then((function(t){if(t)return e.form.integrationsOnRender()})).then((function(){var n=Bt.CSS_PREFIX+"form-"+e.form.id+"-control-group";li({$target:t,$element:O('<div id="'+n+'" style="visibility: hidden; width: 0; height: 0; padding: 0; margin: 0; overflow: hidden;"></div>'),placement:e.placement}),fs(),e._appear=vs({elements:function(){return O("#"+n).get()},appear:function(){e.controlGroupIsShownNotify(),e.form.reportShow(),this._appear&&this._appear.destroy()}})}))})):(e.form.report("targeting_excluded"),!1)}))},variantShow:function(){var t,e=this,n=null,r=ae(e.form.id);return Promise.resolve(e.form.getTargetElement&&e.form.getTargetElement()).then((function(t){t&&(n=t)})).then((function(){e.onTargetingReady()})).then((function(){return e.behaviorsReady})).then((function(){return window.PopMechanic.isTesting||zr.check(e.form)})).then((function(i){if(i)return Promise.all(e.behaviors.map((function(t){return Promise.resolve(t.onBeforeRender(e,n)).catch((function(e){return t.onBeforeRenderRejectIsDebuggable&&Oe.isDebugging()?Promise.resolve():Promise.reject(e)}))}))).then((function(){return!1})).catch((function(t){return Oe.log("onBeforeRender error:",t),!0})).then((function(i){if(!i)return e.form.checkFrequency().catch((function(t){return console.error("Error checking frequency:",t),!0})).then((function(i){if(i)return qe.push({type:"show_start",form:e.form.id,behaviors:e.form.template.behaviors}),e.onShow=e._handler(e.data.on_show,"on_show"),e.onClose=e._handler(e.data.on_close,"on_close"),t=e._render(),r.append(t),e._$elem=r,Promise.all(e.behaviors.map((function(t){return Promise.resolve(t.onRender(e._$elem,e))})).concat(e.form.integrationsOnRender())).then((function(){var t;e.behaviors.forEach((function(t){t.onShow(e._$elem,e,n)})),e.onShow(e.form),fs(),window.PopMechanic.leads&&window.PopMechanic.leads.some((function(n){return n.form===e.form.id&&(t=n,!0)}))&&e.success(t,!0)})).then((function(){e._appear=vs({elements:function(){return O("#"+Bt.CSS_PREFIX+"form-"+e.form.id).get()},appear:function(){e.form.reportShow(),we.setLastShownWithId(e.form.id),this._appear&&this._appear.destroy()}})}))}))}));e.form.report("targeting_excluded")}))},success:function(t){var e=this;return this._success=!0,Promise.all(this.behaviors.map((function(n){return n.onSuccess(e._$elem,e,t)})))},close:function(t){this.terminate(this.form.reportClose,t,!1)},destroy:function(){this.terminate(!1,!1,!0)},terminate:function(t,e,n){var r=this;function i(){r._$elem&&(r._$elem.remove(),r._$elem=null);for(var t="#"+ie(r.form.id.toString());O(t).length;)O(t).remove()}r.form.terminate(),r._$elem&&Promise.all(this.behaviors.map((function(t){return Promise.resolve(t.onBeforeClose(r._$container,r,{showSuccess:!!e,isBeingDestroyed:n})).catch((function(){}))}))).then((function(){if(!r._closed)return r._closed=!0,Promise.all(r.behaviors.map((function(t){return t.onClose(r._$elem,r,{success:r._success,isBeingDestroyed:n})})))})).then(i,i),"function"==typeof t&&t(),"function"==typeof window.PopMechanic.onFormClose&&window.PopMechanic.onFormClose(this._success),r.onClose=r._handler(r.data.on_close,"on_close"),r.onClose(r.form)}}),ys={init:function(t){return t.isStatic()?ys.initStatic(t):t.isEmbedded()?ys.initEmbedded(t):ys.initNormal(t)},initNormal:function(t){var e=new ds(t,t.template.behaviors),n=function(r){r&&(t.clearTargetingChange(n),e.onTargetingReady())};return t.ignoresTargeting()?n(!0):t.onTargetingChange(n),e},initStatic:function(t){var e=new ps(t,t.template.behaviors);return e.init(),e},initEmbedded:function(t){var e=window.PopMechanic.initAt,n=new _s(t),r=function(i){i&&e===window.PopMechanic.initAt&&(n.show(),t.clearTargetingChange(r))};return t.onTargetingChange(r),n}};var ws,bs=Bt.JS_PREFIX+"la",Ss=[],ks=function(t){ws=t;try{sessionStorage[bs]=t}catch(t){}},xs=function(){try{return parseInt(sessionStorage[bs],10)}catch(t){}return ws},Is=r.throttle((function(){ks(Date.now())}),500);setInterval((function(){if(Ss.length){var t=Date.now()-xs(),e=Ss.filter((function(e){return e.delay<=t}));Ss=Ss.filter((function(e){return e.delay>t})),e.forEach((function(t){setTimeout((function(){t.handler.apply(this,t.args)}),0)}))}}),500),document.addEventListener("mousemove",Is,!1),document.addEventListener("mousedown",Is,!1),document.addEventListener("keydown",Is,!1),document.addEventListener("touchmove",Is,!1),document.addEventListener("touchstart",Is,!1),document.addEventListener("scroll",Is,!1),Is(),Ue("destroy",(function(){Ss=[]}));var Ps={setTimeout:function(t,e,n){var r={handler:t,delay:e,args:n};return Ss.push(r),r},clearTimeout:function(t){t.handler=r.identity}};function Es(t){return function(e){e(t)}}var Cs=[function(t){if(t.delay)return function(e){setTimeout(e,1e3*parseInt(t.delay,10),!0)}},function(t){if(t.inactive)return function(e){try{Ps.setTimeout(e,1e3*parseInt(t.inactive,10),[!0])}catch(t){console.log(t)}}},function(t){if(t.mouseleave&&"0"!==t.mouseleave)return function(t){var e=r.debounce((function(){t(!1)}),100);O(document).on("mouseout",(function(e){e.relatedTarget||"INPUT"===e.target.nodeName||t(!0)})),O(document).on("mouseenter",e),O(document).on("mousemove",e)}},function(t){if(t.pages){var e=parseInt(t.pages,10);return we.history.length>=e?Es(!0):function(t){var n=setInterval((function(){we.history.length>=e&&(clearInterval(n),t(!0))}),1e3)}}},function(t){if(t.pages_session){var e=parseInt(t.pages_session,10);return Se.get.session.pgs>=e?Es(!0):function(t){var n=setInterval((function(){Se.get.session.pgs>=e&&(clearInterval(n),t(!0))}),1e3)}}},function(t){if(t.read){var e=parseInt(t.read,10);return function(t){var n=r.debounce((function(){var n=window.pageYOffset,r=O(document).height()-window.innerHeight;(0===r||n/r*100>e)&&t(!0)}),100);O(window).scroll(n),O(document).height()-window.innerHeight>0?window.pageYOffset/O(document).height()*100>=e&&t(!0):t(!0)}}},function(t){if(t.returned&&"0"!==t.returned)return function(t){return Se.get.udata.vst>1?t(!0):t(!1)}},function(t){if(t.session_time){var e;try{e=parseInt(sessionStorage[Bt.JS_PREFIX+"session-start"],10)}catch(t){}e||(e=Date.now()),sessionStorage[Bt.JS_PREFIX+"session-start"]=e;var n=1e3*parseInt(t.session_time,10)-(Date.now()-e);return function(t){setTimeout(t,Math.max(n,0),!0)}}}];function Ts(t,e){if(void 0===t&&(t={}),void 0===e&&(e="or"),t.only_forced)return Es(!1);if(t.immediate)return Es(!0);var n=Cs.map((function(e){return e(t)})).filter(r.identity);return 0===n.length?Es(!0):"and"===e?function(t){return function(e){var n=t.map((function(){return!1})),i=r.every(n);t.forEach((function(t,o){t((function(t){n[o]=t;var a=r.every(n);a!==i&&e(i=a)}))}))}}(n):"or"===e?function(t){return function(e){var n=t.map((function(){return!1})),i=r.any(n);t.forEach((function(t,o){t((function(t){n[o]=t;var a=r.any(n);a!==i&&e(i=a)}))}))}}(n):void 0}function Rs(t){var e=window.PopMechanic.getModel(t);return e?Promise.resolve(e.containerId||null):Xe.getById(t).then((function(t){return t?t.containerId:null}))}var Os=qe.getLast;function Fs(t){return r.some(t,(function(t){return r.includes(["embedded"],t)}))}function Ms(t){return!t.behaviors||!Fs(t.behaviors)}var Ds={checkForm:function(t,e){return r.isEmpty(t)||r.every(t,(function(t){return!1===t||null===t}))?Promise.resolve(!0):Promise.resolve().then((function(){return Os({form:e,type:"show_start"})})).then((function(n){var r,i=Pe();return r=n?n.ts:+we.getLastShown(e),(!t.once_lifetime||!n)&&((!t.once_session||!n||n.vst!==i)&&!(t.minimal_timeout&&Date.now()-r<1e3*t.minimal_timeout))})).catch((function(){var n=+we.getLastShown(e),r=Date.now();return(!t.once_lifetime||!n)&&(!(t.once_session&&r-n<18e5)&&!(t.minimal_timeout&&r-n<1e3*t.minimal_timeout))}))},checkAccount:function(t,e){return r.isEmpty(t)||r.every(t,r.isNull)?Promise.resolve(!0):Rs(e).then((function(n){if(n)return!0;var r=Pe(),i=Date.now(),o=i-864e5,a=i-6048e5,s=i-2592e6,c={day:0,week:0,month:0,session:0},u=[];return qe.forEach("ts",IDBKeyRange.lowerBound(s),(function(t){if(!("show_start"!==t.type||t.behaviors&&Fs(t.behaviors))){var e=Rs(t.form).then((function(e){e||(t.ts>o&&(c.day+=1),t.ts>a&&(c.week+=1),t.ts>s&&(c.month+=1),t.vst===r&&(c.session+=1))}));u.push(e)}})).then((function(){return Promise.all(u)})).then((function(){return!(t.session&&c.session>=t.session)&&(!(t.day&&c.day>=t.day)&&(!(t.week&&c.week>=t.week)&&(!(t.month&&c.month>=t.month)&&(!t.minimal_timeout||(e=1e3*t.minimal_timeout,Promise.resolve().then((function(){return Os({type:"show_start"},Ms)})).then((function(t){var n=t?t.ts:+we.getLastShown();return Date.now()-n>=e})))))));var e})).catch((function(){var n=+we.getLastShown(e),r=864e5,i=Date.now()-n;return!(t.session&&n&&i<18e5)&&(!(t.day&&n&&i<r)&&(!(t.week&&n&&i<6048e5)&&(!(t.month&&n&&i<2592e6)&&!(t.minimal_timeout&&i<1e3*t.minimal_timeout))))}))}))}},js=Yt({__constructor:function(t){this.form=t},getTargetElement:null,terminate:function(){}}),$s={embedded:Yt(js,{_timeoutId:null,_selector:null,__constructor:function(t){this.__base(t),this.getTargetElement=this.getTargetElement.bind(this),this.terminate=this.terminate.bind(this),this._selector=t.embed_selector&&t.selector||"[data-"+Bt.CSS_PREFIX+"embed='"+t.id+"']"},_waitForTargetElement:function(t,e){var n=this;try{document.querySelectorAll(n._selector)}catch(t){return void Oe.log("form #"+n.form.id+" embed selector error:",t)}var r=O(n._selector);r.length?tr((function(){e(r)})):n._timeoutId=setTimeout((function(){n._waitForTargetElement(2*t,e)}),Math.min(t,500))},getTargetElement:function(){var t=this;return new Promise((function(e){var n=t.form.recoBlockSearchTimeTracker;n&&n.startTracking(),t._waitForTargetElement(10,(function(t){return n&&n.stopTracking(),e(t)}))}))},terminate:function(){this._timeoutId&&clearTimeout(this._timeoutId)}}),"reco-sla":Yt(js,{__constructor:function(t){this.__base(t),this.form.recoBlockSearchTimeTracker=new $a}})};var As={getInstances:function(t,e){return r.reduce(t,(function(t,n){return $s[n]&&(t[n]=new $s[n](e)),t}),{})}},Ns=new TextEncoder;function Ls(t){return crypto.subtle.digest("SHA-256",Ns.encode(t)).then((function(t){var e=new Uint8Array(t);return Array.from(e)}))}function Bs(t){return window.PopMechanic.sha256q=window.PopMechanic.sha256q||[],new Promise((function(e,n){Ya("https://static.popmechanic.ru/media/popmechanic/jssha256.js").catch((function(t){Oe.log(t),n(new Error("Error loading SHA256 script, AB tests might not work as expected"))})),window.PopMechanic.sha256q.push((function(n){var r=n.digest(t);e(r)}))}))}function qs(t,e){var n=crypto&&crypto.subtle&&crypto.subtle.digest?Ls:Bs;return Promise.resolve().then((function(){var r=t.toString().toUpperCase()+e.toUpperCase();return n(r)})).then((function(t){return((t[28]<<24|t[29]<<16|t[30]<<8|t[31])>>>0)%100})).catch((function(t){return Oe.log(t),null}))}function Ws(t,e,n){if(e<0||n>100)throw new Error("[modulusLower, modulusUpper) should be within [0, 100).");if(e>=n)throw new Error("Modulus lower bound can't be more or equal to modulus upper bound.");if(null===t)throw new Error("Couldn't calculate modulus hash for A/B test");return e<=t&&t<n}var Xs=Yt({__constructor:function(t){this.data=t,this.filters=t.filter,this.filterType=t.filter_type,this.form=t.form},shouldRunForControlGroup:function(){},shouldRunOnContactsSent:function(t){if(this.form&&this.form!==t.form)return!1;if(this.filters){var e=this.filterType||"all",n=Object.keys(this.filters);for(var r in n){if("all"===e&&t.customs[n[r]]!==this.filters[n[r]])return!1;if("any"===e&&t.customs[n[r]]===this.filters[n[r]])return!0}}return!0},shouldRunOnSendContacts:function(){return!1},skipForm:function(t){},onTargetingReady:function(t,e){},onRender:function(t){},onShow:function(t,e){},onClose:function(t,e){},sendContacts:function(t,e){},onContactsSent:function(t,e){},_interpolate:function(t,e){var n=e.form,r=e.lead,i=t;return i=(i=(i=(i=(i=(i=(i=i.replace("%url%",location.href)).replace("%domain%",location.host)).replace("%utm_source%",Se.get.current.src)).replace("%utm_medium%",Se.get.current.mdm)).replace("%utm_campaign%",Se.get.current.cmp)).replace("%utm_term%",Se.get.current.trm)).replace("%utm_content%",Se.get.current.cnt),n&&(i=(i=i.replace("%form_id%",n.id)).replace("%form_name%",n.name)),r&&(Object.keys(r).forEach((function(t){"customs"===t?Object.keys(r.customs).forEach((function(t){i=i.replace(new RegExp("%customs."+t+"%","g"),r.customs[t])})):i=i.replace(new RegExp("%"+t+"%","g"),r[t])})),i=i.replace(new RegExp("%name%","g"),[r.first_name," ",r.last_name].join(" "))),i}}),Us=Yt(Xs,{__constructor:function(t){this.__base(t),this.carrotquest=window.carrotquest,this.fields=t.fields,this.open_event=t.open_event,this.close_event=t.close_event,this.lead_event=t.lead_event},onShow:function(t,e){this.open_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this._interpolate(this.open_event,{form:e.form}))},onClose:function(t,e){this.close_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this._interpolate(this.close_event,{form:e.form}))},onContactsSent:function(t,e){var n=e.form,r=e.lead,i={},o=this;r.phone&&(i.$phone=r.phone),r.name&&(i.$name=r.name),r.email&&(i.$email=r.email),Object.keys(this.fields).forEach((function(t){i[t]=o._interpolate(o.fields[t],{form:n,lead:r})})),this.lead_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this.lead_event),this.carrotquest.identify(i)}}),Vs=function(t){var e=t.consoleNotificator,n=t.data,r=t.trySendGa4Event;this._data=n,this._consoleNotificator=e,this._trySendGa4Event=r};Vs.prototype._send=function(t,e){var n=e(t.name),r=t.parameters.reduce((function(t,n){return t[n.name]=e(n.value).slice(0,100),t}),{}),i={};this._data.measurement_id&&(i.send_to=this._data.measurement_id),Object.assign(i,r);try{this._trySendGa4Event(n,{common:i})}catch(t){this._consoleNotificator.log(t)}},Vs.prototype.onShow=function(t){this._data.events&&this._data.events.open&&this._send(this._data.events.open,t)},Vs.prototype.onClose=function(t){this._data.events&&this._data.events.close&&this._send(this._data.events.close,t)},Vs.prototype.onContactsSent=function(t){this._data.events&&this._data.events.lead&&this._send(this._data.events.lead,t)};var Hs=Yt(Xs,{__constructor:function(t,e){void 0===e&&(e={}),this.__base(t);var n=e.trySendGa4Event;void 0===n&&(n=Pa);var r={consoleNotificator:new Ea(this.data.form),data:this.data,trySendGa4Event:n};this.tracker=new Vs(r)},onShow:function(t,e){var n=this;this.tracker.onShow((function(t){return n._interpolate(t,e)}))},onClose:function(t,e){var n=this;this.tracker.onClose((function(t){return n._interpolate(t,e)}))},onContactsSent:function(t,e){var n=this;this.tracker.onContactsSent((function(t){return n._interpolate(t,e)}))}}),Gs=Yt(Xs,{_variables:[{key:"product_id",fetch:function(){return lr().then((function(t){return t.product?t.product.ids:t.productGroup?t.productGroup.ids:null}))}},{key:"product_id_value",fetch:function(){return lr().then((function(t){return t.product?dr(t.product.ids):t.productGroup?dr(t.productGroup.ids):null}))}},{key:"category_id",fetch:function(){return lr().then((function(t){return t.category?t.category.ids:null}))}},{key:"category_id_value",fetch:function(){return lr().then((function(t){return t.category?dr(t.category.ids):null}))}},{key:"cart_sum",fetch:function(){return ur().then((function(t){return r.reduce(t,(function(t,e){return t+=e.priceOfLine||e.pricePerItem*e.count||0}),0)}))}},{key:"cart_products",fetch:ur}],_methodHasVariable:function(t,e){return-1!==t.indexOf("%"+e+"%")},_getRequiredVariables:function(t){var e=this;return this._variables.filter((function(n){var r=n.key;return e._methodHasVariable(t,r)}))},_getVariablesValues:function(t){var e=this._getRequiredVariables(t),n=e.map((function(t){return Promise.resolve(t.fetch())}));return Promise.all(n).then((function(t){return r.reduce(e,(function(e,n,r){return e[n.key]=t[r],e}),{})}))},_interpolateWithVariables:function(t,e,n){var r=this._interpolate(t,e);return Object.keys(n).forEach((function(t){r=r.replace(new RegExp("%"+t+"%","g"),"(JSON.parse('"+JSON.stringify(n[t])+"'))")})),r},_executeLifecycleMethod:function(t){var e=this,n=t.methodName,r=t.params,i=this,o=this.data[n];if(o)return this._getVariablesValues(o).then((function(t){var e=i._interpolateWithVariables(o,r,t);return r.lead?new Function("lead","form",e)(r.lead,r.form):new Function("form",e)(r.form)})).catch((function(t){Oe.log(n+" error in integration#"+e.data.id+", form#"+r.form.id,t)}))},onRender:function(t){return this._executeLifecycleMethod({methodName:"on_render",params:{form:t}})},onShow:function(t,e){return this._executeLifecycleMethod({methodName:"on_show",params:{form:e.form}})},onClose:function(t,e){return this.success?this._executeLifecycleMethod({methodName:"on_close_success",params:{form:e.form}}):this._executeLifecycleMethod({methodName:"on_close_fail",params:{form:e.form}})},onContactsSent:function(t,e){return this.success=!0,this._executeLifecycleMethod({methodName:"on_success",params:{form:e.form,lead:e.lead}})},onTargetingReady:function(t,e){return this._executeLifecycleMethod({methodName:"on_targeting",params:{form:e.form}})}}),zs=Yt(Xs,{__constructor:function(t){this.__base(t),this.open_event=this.data.open_event,this.close_event=this.data.close_event,this.lead_event=this.data.lead_event},_push:function(t,e){_kmq.push(["record",t,e])},onShow:function(t,e){this.open_event&&this._push(this.open_event,{form:e.form.id})},onClose:function(t,e){this.close_event&&this._push(this.close_event,{form:e.form.id})},onContactsSent:function(t,e){var n=e.lead;this.lead_event&&this._push(this.lead_event,{form:n.form,conditions:n.conditions}),n.email&&_kmq.push(["set",{email:n.email}])}}),Js=Yt(Xs,{__constructor:function(t){this.__base(t),this.provider=t.provider,this.operation=t.operation},onContactsSent:function(t,e){var n,r=this,i=e.lead,o={};n="email"===this.provider?"email":"phone"===this.provider?"phone":"id",i.first_name&&(o.firstName=i.first_name),i.last_name&&(o.lastName=i.last_name),i.email&&(o.email=i.email),i.phone&&(o.phone=i.phone),ln.getMindboxIsReadyPromise().then((function(){r.counter=window.mindbox,r.counter||(console.log("PopMechanic Mindbox integration error: no counter presented"),r.counter=function(){}),r.counter("identify",{operation:r.operation,identificator:{provider:r.provider,identity:i[n]},data:o})}))}}),Ks=Yt(Xs,{__constructor:function(t){this.__base(t)},shouldRunForControlGroup:function(){return!0},skipForm:function(){return!(window.PushManager&&window.Notification&&"default"===window.Notification.permission)},onContactsSent:function(){ln.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("webpush.subscribe",{onGranted:function(){},onDenied:function(){}})}))}}),Qs=Yt(Xs,{__constructor:function(t){this.__base(t),this.isLead=!1,this._trackShow=this._trackShow.bind(this),this._trackClick=this._trackClick.bind(this)},shouldRunForControlGroup:function(){return!0},shouldRunOnContactsSent:function(t){return(!this.data.form||this.data.form===t.form)&&!this.isLead},onTargetingReady:function(t,e){this._trackTargeting(e)},onRender:function(t){Ue("copyCode",this._trackClick),t.template&&t.template.behaviors&&(this.isLead=-1!==t.template.behaviors.indexOf("lead"))},onShow:function(t,e){this._trackShow(e)},onContactsSent:function(t,e){this._trackClick(t,e)},_trackTargeting:function(t){var e=this;this.data&&this.data.targeting_operation&&ln.getMindboxIsReadyPromise().then((function(){window.mindbox&&(36257===window.PopMechanic.client&&[94047,76203,69978,66005,78401,89524,84863].includes(e.data.form)||5772===window.PopMechanic.client&&[97057,92427,71412,69381,68966,68865,60778,60731,60529,56731,56682,56729,42410,18172,16497,16324,12860].includes(e.data.form)||window.mindbox("async",{operation:e.data.targeting_operation,data:{omitCdpAction:t.form.isControlGroup},onSuccess:function(){},onValidationError:function(){}}))}))},_trackShow:function(t){var e=this;this.data&&this.data.show_operation&&ln.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:e.data.show_operation,data:{omitCdpAction:t.form.isControlGroup},onSuccess:function(){},onValidationError:function(){}})}))},_trackClick:function(t,e){if(this.data.form===e.form.id){var n=this;this.data&&this.data.click_operation&&ln.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:n.data.click_operation,data:{},onSuccess:function(){},onValidationError:function(){}})}))}}}),Ys={geo_city_ru:"city_ru",geo_city_en:"city_en",geo_country_ru:"country_ru",geo_country_en:"country_en",geo_geoname_id:"city_id"},Zs=Object.keys(Ys),tc=Zs.map((function(t){return"%"+t+"%"})),ec=Yt(Xs,{__constructor:function(t){this.__base(t),this.needsGeo=this._getNeedsGeo()},shouldRunOnSendContacts:function(){return!0},sendContacts:function(t){var e=this;return new Promise((function(n,r){e._getGeoPromise().then((function(){ln.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:e.data.operation,data:e._getOperationData(t),onSuccess:function(){n(t)},onValidationError:function(t){r(t)},onError:function(t){r(t)}})}))}))}))},onShow:function(){this._getGeoPromise()},_getNeedsGeo:function(){var t=[];return this.data.send_customer&&this.data.customer_extended&&this.data.customer_extended.length&&t.push.apply(t,this.data.customer_extended),this.data.issue_action&&this.data.customer_action_extended&&this.data.customer_action_extended.length&&t.push.apply(t,this.data.customer_action_extended),t.some((function(t){var e=t.value;return tc.includes(e)}))},_getOperationData:function(t){var e=this,n=this.data,i={};if(n.send_customer){var o=n.customer_extended;o&&o.length&&(i.customer=o.reduce((function(n,r){var i=r.value,o=r.systemName;return e._addOperationFieldValue(n,t,o,i)}),{}),"create"===n.mode&&(i.customer.subscriptions=n.subscriptions),r.isEmpty(i.customer)&&delete i.customer)}if(n.issue_action&&n.customer_action_extended){var a=n.customer_action_extended;a&&a.length&&(i.customerAction=a.reduce((function(n,r){var i=r.value,o=r.systemName;return e._addOperationFieldValue(n,t,o,i)}),{}),r.isEmpty(i.customerAction)&&delete i.customerAction)}return i},_addOperationFieldValue:function(t,e,n,r){var i,o,a=Qi(r.replace(/%/g,""));if("customs."===a.slice(0,8)){var s=a.slice(8);s in e.customs&&(i=e.customs[s])}else a in e?i=e[a]:"created_date"===a?i=(new Date).toISOString().split("T")[0]:"created_time"===a?i=(new Date).toISOString():Zs.includes(a)&&(i=this.geoData[Ys[a]]);if(void 0!==i){var c=null===(o=i)?"None":!0===o?"True":!1===o?"False":String(o);!function(t,e,n){var r=e.split("."),i=t;r.forEach((function(t,e){e===r.length-1?i[t]=n:i=i[t]?i[t]:i[t]={}}))}(t,n,this._interpolate(c,{lead:e}))}else console.warn("Mindbox personalization module: couldn't retrieve value for field \""+r+'". Skipping the field. It may lead to the inconsistency or data losses. Check the form template settings.');return t},_getGeoPromise:function(){var t=this;return this.needsGeo?un.getGeo().then((function(e){t.geoData=e})):Promise.resolve()}}),nc=Yt(Xs,{__constructor:function(t){this.__base(t),this.counter=window.rrApi,this.counter||(console.log("PopMechanic RetailRocket integration error: no counter presented"),this.counter=function(){})},onContactsSent:function(t,e){var n=e.lead,r={};if(n.email){(n.first_name||n.last_name)&&(r.name=[n.first_name,n.last_name].filter(Boolean).join(" ")),n.phone&&(r.phone=n.phone);try{rrApi.setEmail(n.email,r)}catch(t){window.rrApiOnReady&&window.rrApiOnReady.push((function(){rrApi.setEmail(n.email,r)}))}}}}),rc=Yt(Xs,{__constructor:function(t){this.__base(t),this.tags=t.tags,this.fields=t.fields},onContactsSent:function(t,e){var n=e.lead,r={},i={},o=this,a=this.tags.map((function(t){return o._interpolate(t,{form:e.form,lead:n})}));if(Object.keys(this.fields).forEach((function(t){i[t]=o._interpolate(o.fields[t],{form:e.form,lead:n})})),i.email=n.email,n.first_name&&(r.firstName=n.first_name),n.last_name&&(r.lastName=n.last_name),n.email&&(r.email=n.email),n.phone&&(r.phone=n.phone),this.counter=window.SP,!this.counter)return console.log("PopMechanic Sailplay integration error: no counter presented"),void(this.counter=function(){});try{this.counter.api.users.update(r),this.counter.api.customVariables.add(i),this.counter.tags({action:"add",tags:a,email:n.email})}catch(t){console.log("PopMechanic Sailplay integration error:"),console.log(t)}}}),ic=Yt(Xs,{__constructor:function(t){this.__base(t),this.openGoal=this.data.open_event,this.closeGoal=this.data.close_event,this.leadGoal=this.data.lead_event},getCounter:function(){var t=/^yaCounter/,e=this;return this.data.counter?this.counter=window["yaCounter"+this.data.counter]:Object.keys(window).some((function(n){t.test(n)&&(e.counter=window[n])})),this.counter||console.log("PopMechanic Yandex.Metrika integration failed: no counter found on site"),this.counter},onShow:function(){this.getCounter();try{this.openGoal&&this.counter.reachGoal(this.openGoal)}catch(t){console.log(t)}},onClose:function(){this.getCounter();try{this.closeGoal&&this.counter.reachGoal(this.closeGoal)}catch(t){console.log(t)}},onContactsSent:function(){this.getCounter();try{this.leadGoal&&this.counter.reachGoal(this.leadGoal)}catch(t){console.log(t)}}});var oc=function(t,e,n){this.init=n,this.id=t.id,this.name=t.name,this.settings_splits=t.settings_splits,this.settings={},this.salt=t.salt,this.control_group=t.control_group,this.variants=t.variants,this.newTargeting=t.test_group?t.test_group.new_targeting:t.new_targeting,this.template_id=t.template,this.template=null,this.button_template_id=t.button_template,this.button_template=null,this.conditions=t.conditions,this.frequency=t.frequency||{},this.accountFrequency=t.accountFrequency||{},this.test_group=t.test_group,this.inTargeting=!1,this.inSplitTest=!1,this.embed_selector=t.embed_selector,this.selector=t.selector,this.placement=t.placement,this._targetingCb=[],this.custom_fields=t.custom_fields,this.containerId=t.container_id,this.childForms=t.child_forms||[],this.behaviors={},this.getTargetElement=null,this.isControlGroup=!1,this.isTransactional=t.is_transactional,this._isAbTest=!(!this.salt||!window.PopMechanic.mindboxDeviceUUID),this.isReadyPromise=this.initAsync(e),this.reportClose=this.reportClose.bind(this),this.reportShow=this.reportShow.bind(this),this._getTargetElementCreator=this._getTargetElementCreator.bind(this),this.setBehaviors=this.setBehaviors.bind(this),this.subscribeIntegrations=this.subscribeIntegrations.bind(this),this.integrationsOnRender=this.integrationsOnRender.bind(this)};oc.prototype.initAsync=function(t){var e=this;return Promise.resolve(0).then((function(){return e.salt&&qs(window.PopMechanic.mindboxDeviceUUID,e.salt)})).then((function(t){e.modulusHash=t}),(function(t){Oe.log(t),e.modulusHash=null})).then((function(){e._setSettings(),e._integrations=t.reduce((function(t,n){if(n&&(!n.form||n.form===e.id)){var r=function(t){switch(t.integration_type){case"yandexmetrika":return new ic(t);case"googleanalytics":return new Hs(t);case"carrotquest":return new Us(t);case"mindbox":return new Js(t);case"mindbox_push":return new Ks(t);case"mindbox_tracking":return new Qs(t);case"mindbox_server_json":return new ec(t);case"kissmetrics":return new zs(t);case"sailplay":return new rc(t);case"retailrocket":return new nc(t);case"javascript":return new Gs(t)}}(n);!r||e.isControlGroup&&!r.shouldRunForControlGroup()||t.push(r)}return t}),[]),e.sendContactsIntegrations=e.getSendContactsIntegrations()}))},oc.prototype.isStatic=function(){return"static"===this.template.template_type||-1!==this.template.behaviors.indexOf("static")},oc.prototype.isEmbedded=function(){return"embedded"===this.template.template_type||-1!==this.template.behaviors.indexOf("embedded")},oc.prototype.setBehaviors=function(){this.behaviors=As.getInstances(this.template.behaviors,this),this.getTargetElement=this._getTargetElementCreator()},oc.prototype._getFormVariant=function(){var t=this,e=window.PopMechanic.formHash,n=this.variants[0];if(!this._isAbTest)return n;if(e){var r=document.location.toString();if(-1!==r.indexOf("form-variant-id=")){var i=r.split("form-variant-id=")[1].split("&")[0],o=this.variants.find((function(t){return t.ab_test_variant_internal_id===i}));if(o)return o}return n}return this.variants.find((function(t){return t.is_winner}))||this.variants.find((function(e){try{return Ws(t.modulusHash,e.modulus_lower_inclusive,e.modulus_upper_exclusive)}catch(t){return Oe.log(t),!1}}))||n},oc.prototype._setSettings=function(){var t=this._getFormVariant();if(!window.PopMechanic.formHash&&this._isAbTest&&this.control_group)try{Ws(this.modulusHash,this.control_group.modulus_lower_inclusive,this.control_group.modulus_upper_exclusive)&&(this.isControlGroup=!0)}catch(t){Oe.log(t)}this.settings=t.view_settings,this.button_template_id=this.settings.button_template,this.settings.conditions_splits=this.settings_splits[0].conditions_splits},oc.prototype.setControlGroup=function(t){this.isControlGroup=t},oc.prototype.setConditions=function(t){this.conditions=r.find(this.settings.conditions_splits,(function(e){return e.id===t})),this.conditions||(window.PopMechanic.isTesting||this.isEmbedded()?this.conditions={conditions:{delay:0}}:this.conditions={conditions:{reject:!0}})},oc.prototype.isAlways=function(){return-1!==this.template.behaviors.indexOf("always")},oc.prototype.ignoresTargeting=function(){return!(!this.conditions||!this.conditions.conditions||"ignore_targeting"!==this.conditions.conditions.only_forced)},oc.prototype.checkFrequency=function(){return window.PopMechanic.isTesting?Promise.resolve(!0):Ds.checkForm(this.frequency,this.id)},oc.prototype.checkAccountFrequency=function(){return this.frequency.priority||window.PopMechanic.isTesting?Promise.resolve(!0):Ds.checkAccount(this.accountFrequency,this.id)},oc.prototype.checkTargeting=function(t){var e=this;if(!e._integrations.some((function(t){return t.skipForm(e)}))){var n=r.once((function(){36257===window.PopMechanic.client&&[94047,76203,69978,66005,78401,89524,84863].includes(e.id)||5772===window.PopMechanic.client&&[97057,92427,71412,69381,68966,68865,60778,60731,60529,56731,56682,56729,42410,18172,16497,16324,12860].includes(e.id)||yi({type:"bucket",form:e.id,settings:e.settings?e.settings.id:0,conditions:e.conditions?e.conditions.id:""})}));return Promise.resolve(e.getTargetElement&&e.getTargetElement()).then((function(){return!!window.PopMechanic.isTesting||zr.check(e,(function(r){e.setInTargeting(r),r&&n(),t&&t(e,r)}))})).catch((function(){return!1})).then((function(t){return e.setInTargeting(t),t&&n(),t}))}},oc.prototype.cancelConditions=function(){},oc.prototype.checkConditions=function(){var t,e,n,i,o=this,a=(t=o.conditions.conditions,e=o.conditions.combinator,n=Ts(t,e),i=!1,new Promise((function(t){n((function(e){(i=i||e)&&t()}))}))),s=new Promise((function(t,e){o.cancelConditions=e}));return Promise.race([a,s]).then(r.constant(!0)).catch(r.constant(!1))},oc.prototype.setInTargeting=function(t){t!==this.inTargeting&&(this.inTargeting=t,this._targetingCb.forEach((function(e){e(t)})))},oc.prototype.onTargetingChange=function(t){if("function"==typeof t){this._targetingCb.push(t),this.inTargeting&&setTimeout((function(){t(!0)}),0)}},oc.prototype.clearTargetingChange=function(t){this._targetingCb=r.without(this._targetingCb,t)},oc.prototype.getLeadType=function(){var t=this.template.behaviors;return t.indexOf("lead")>-1?"lead":t.indexOf("info")>-1?"info-"+this.id:void 0},oc.prototype.getTestGroupId=function(){return this.test_group&&this.test_group.id?this.test_group.id:"form-"+this.id},oc.prototype.setTemplate=function(t){this.template=t,"embedded"===this.template.template_type&&-1===this.template.behaviors.indexOf("embedded")&&this.template.behaviors.push("embedded"),(r.includes(this.template.behaviors,"banner-h")||r.includes(this.template.behaviors,"banner-v"))&&(this.template.behaviors=r.without(this.template.behaviors,"banner")),this.setBehaviors()},oc.prototype.setButtonTemplate=function(t){this.button_template=t},oc.prototype.setInSplitTest=function(t){this.inSplitTest=t};var ac={show:"formShow",close:"formClose"};function sc(t,e,n){void 0===n&&(n=10);var i,o,a=[],s=0,c=function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(Array.prototype.slice.call(t,r,r+=e));return n}(t,n),u=new Promise((function(t,e){i=t,o=e}));return requestAnimationFrame((function t(){if(s>=c.length)return i(r.flatten(a,1));try{var n=c[s];a.push(r.map(n,e)),s+=1,requestAnimationFrame(t)}catch(t){o(t)}})),u}oc.prototype.report=function(t,e){var n={form:this.id,settings:this.settings?this.settings.id:"",conditions:this.conditions?this.conditions.id:"",type:t};e&&r.merge(n,e),yi(n),He(ac[t]||t,{form:this})},oc.prototype.reportShow=function(){this.report("show")},oc.prototype.reportClose=function(){this.report("close")},oc.prototype.reportSlaSuccess=function(){},oc.prototype.reportSlaFailure=function(){},oc.prototype._getTargetElementCreator=function(){var t=r.chain(this.behaviors).values().reverse().find((function(t){return!!t.getTargetElement})).value();return t?t.getTargetElement:null},oc.prototype.terminate=function(){r.forEach(this.behaviors,(function(t){t.terminate()}))},oc.prototype.pushToHistory=function(){Xe.add({id:this.id,form:{containerId:this.containerId}})},oc.prototype.subscribeIntegrations=function(){var t=this;this._integrations.forEach((function(e){Ue("lead",(function(n,r){r.form.id===t.id&&e.shouldRunOnContactsSent(r.lead)&&e.onContactsSent(n,r)})),Ue("targeting",(function(n,r){r.form.id===t.id&&e.onTargetingReady(n,r)})),Ue("formShow",(function(n,r){r.form.id===t.id&&e.onShow(n,r)})),Ue("formClose",(function(n,r){r.form.id===t.id&&e.onClose(n,r)}))}))},oc.prototype.getSendContactsIntegrations=function(){return this._integrations.filter((function(t){return t.shouldRunOnSendContacts()}))},oc.prototype.integrationsOnRender=function(){var t=this;return Promise.all(this._integrations.map((function(e){return Promise.resolve(e.onRender(t))})))};var cc=function(t,e){this.hash=e,this.id=t.global_ab_test_internal_id,this.internalId=t.internal_id,this.salt=t.salt,this.variants=t.variants,this.currentVariant=this._getCurrentVariant(),this.isControlGroup=!!this.currentVariant&&this.currentVariant.is_control_group,this.testLogic=this._getTestLogic()};cc.prototype.getFormIds=function(t){return this.currentVariant?"WithFormsOnly"===this.testLogic?this._getWithFormsOnlyLogicForms(t):"WithoutFormsAvailable"===this.testLogic?this._getWithoutFormsAvailableLogicForms(t):(Oe.log('Variants of a/b test (global_ab_test_internal_id="'+this.id+'") are corrupted. Skipping the test.'),t):t},cc.prototype._getCurrentVariant=function(){var t=this;if(null!==this.hash)return r.find(this.variants,(function(e){try{return Ws(t.hash,e.modulus_lower_inclusive,e.modulus_upper_exclusive)}catch(t){return Oe.log(t),!1}}))},cc.prototype._getTestLogic=function(){return this.variants.every((function(t){return t.form_selection_kind}))?"WithFormsOnly":this.variants.every((function(t){return!t.form_selection_kind}))?"WithoutFormsAvailable":"Corrupted"},cc.prototype._getAllForms=function(){if(this.allForms)return this.allForms;var t=this.variants.map((function(t){return r.pluck(t.forms,"id")}));return this.allForms=r.uniq(r.flatten(t)),this.allForms},cc.prototype._getCurrentVariantForms=function(){return this.currentVariant?r.pluck(this.currentVariant.forms,"id"):[]},cc.prototype._getOtherVariantsForms=function(){var t=this._getAllForms(),e=this._getCurrentVariantForms();return r.difference(t,e)},cc.prototype._getWithFormsOnlyLogicForms=function(t){var e=this,n=this.variants.reduce((function(n,i){if(i.internal_id===e.currentVariant.internal_id)return n;var o="all"===i.form_selection_kind?t:r.pluck(i.forms,"id");return r.union(n,o)}),[]),i=r.difference(t,n),o="all"===this.currentVariant.form_selection_kind?t:this._getCurrentVariantForms();return r.union(i,o)},cc.prototype._getWithoutFormsAvailableLogicForms=function(t){if(this.currentVariant.is_control_group)return Oe.log('Control group of global a/b test (global_ab_test_internal_id="'+this.id+'") is used'),[];var e=this._getOtherVariantsForms();return r.difference(t,e)};var uc={exports:{}};
/*!
	 Copyright 2018 Google Inc. All Rights Reserved.
	 Licensed under the Apache License, Version 2.0 (the "License");
	 you may not use this file except in compliance with the License.
	 You may obtain a copy of the License at

	     http://www.apache.org/licenses/LICENSE-2.0

	 Unless required by applicable law or agreed to in writing, software
	 distributed under the License is distributed on an "AS IS" BASIS,
	 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 See the License for the specific language governing permissions and
	 limitations under the License.
	*/!function(t,e){
/*! lifecycle.es5.js v0.1.1 */
t.exports=function(){var t=void 0;try{new EventTarget,t=!1}catch(e){t=!1}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(){function t(){n(this,t),this._registry={}}return r(t,[{key:"addEventListener",value:function(t,e){this._getRegistry(t).push(e)}},{key:"removeEventListener",value:function(t,e){var n=this._getRegistry(t),r=n.indexOf(e);r>-1&&n.splice(r,1)}},{key:"dispatchEvent",value:function(t){return t.target=this,Object.freeze(t),this._getRegistry(t.type).forEach((function(e){return e(t)})),!0}},{key:"_getRegistry",value:function(t){return this._registry[t]=this._registry[t]||[]}}]),t}(),s=t?EventTarget:a,c=t?Event:function t(e){n(this,t),this.type=e},u=function(t){function e(t,r){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.newState=r.newState,i.oldState=r.oldState,i.originalEvent=r.originalEvent,i}return i(e,c),e}(),l="active",f="passive",d="hidden",p="frozen",h="terminated",m="object"===("undefined"==typeof safari?"undefined":e(safari))&&safari.pushNotification,g=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],v=function(t){return t.preventDefault(),t.returnValue="Are you sure?"},_=[[l,f,d,h],[l,f,d,p],[d,f,l],[p,d],[p,l],[p,f]].map((function(t){return t.reduce((function(t,e,n){return t[e]=n,t}),{})})),y=function(){return document.visibilityState===d?d:document.hasFocus()?l:f};return new(function(t){function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),r=y();return t._state=r,t._unsavedChanges=[],t._handleEvents=t._handleEvents.bind(t),g.forEach((function(e){return addEventListener(e,t._handleEvents,!0)})),m&&addEventListener("beforeunload",(function(e){t._safariBeforeUnloadTimeout=setTimeout((function(){e.defaultPrevented||e.returnValue.length>0||t._dispatchChangesIfNeeded(e,d)}),0)})),t}return i(e,s),r(e,[{key:"addUnsavedChanges",value:function(t){!this._unsavedChanges.indexOf(t)>-1&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",v),this._unsavedChanges.push(t))}},{key:"removeUnsavedChanges",value:function(t){var e=this._unsavedChanges.indexOf(t);e>-1&&(this._unsavedChanges.splice(e,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",v))}},{key:"_dispatchChangesIfNeeded",value:function(t,e){if(e!==this._state)for(var n=function(t,e){for(var n,r=0;n=_[r];++r){var i=n[t],o=n[e];if(i>=0&&o>=0&&o>i)return Object.keys(n).slice(i,o+1)}return[]}(this._state,e),r=0;r<n.length-1;++r){var i=n[r],o=n[r+1];this._state=o,this.dispatchEvent(new u("statechange",{oldState:i,newState:o,originalEvent:t}))}}},{key:"_handleEvents",value:function(t){switch(m&&clearTimeout(this._safariBeforeUnloadTimeout),t.type){case"pageshow":case"resume":this._dispatchChangesIfNeeded(t,y());break;case"focus":this._dispatchChangesIfNeeded(t,l);break;case"blur":this._state===l&&this._dispatchChangesIfNeeded(t,y());break;case"pagehide":case"unload":this._dispatchChangesIfNeeded(t,t.persisted?p:h);break;case"visibilitychange":this._state!==p&&this._state!==h&&this._dispatchChangesIfNeeded(t,y());break;case"freeze":this._dispatchChangesIfNeeded(t,p)}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),e}())}()}(uc);var lc=uc.exports,fc=function(t){void 0===t&&(t=Na),this.enabled=!1,this.onUnload=t,this._listener=this._listener.bind(this),lc.addEventListener("statechange",this._listener)};fc.prototype.enable=function(){this.enabled=!0},fc.prototype.destroy=function(){var t=this;return new Promise((function(e){t.enabled=!1,lc.removeEventListener("statechange",t._listener),e()}))},fc.prototype._listener=function(t){"terminated"===t.newState&&this.enabled&&this.onUnload()};var dc=Yt({abTests:[],forms:[],pluginData:[],formsMap:{},formsReady:null,__constructor:function(t){var e=this,n=t.data,i=t.deviceUUID,o=t.onTargetingChange,a=r.identity,s=r.identity;this.formsReady=new Promise((function(t,e){a=t,s=e})),this.onTargetingChange=o,this._data=n,this.unloadReporter=new fc,this._data.contacts?window.PopMechanic.leads=this._data.contacts:window.PopMechanic.leads=[],this._abTests=null,Promise.all((n.global_ab_tests||[]).map((function(t){return function(t,e){return Promise.resolve().then((function(){return qs(e,t.salt)})).then((function(e){return new cc(t,e)}),(function(e){return Oe.log(e),new cc(t,null)}))}(t,i)}))).then((function(t){e._abTests=t,e._setAbTestsGlobal()})).then((function(){return e._setFormsAsync()})).then(a,(function(t){yi({type:"exception",url:location.href}),s(t)}))},_setAbTestsGlobal:function(){var t=this._abTests;function e(e){"function"==typeof e&&e(t)}try{e(window.PopMechanic.onAbTestsReady)}catch(t){Oe.log("onAbTestsReady error:",t)}Object.defineProperty(window.PopMechanic,"onAbTestsReady",{configurable:!0,set:e})},_getAbTestsForms:function(){var t=this;if(!this._abTests.length)return this.forms;var e=this._abTests.map((function(e){return e.getFormIds(t.allFormIds)}));return r.intersection.apply(r,e).map((function(e){return t.formsMap[e]})).filter(r.isObject)},_getTransactionalForms:function(){return this.forms.filter((function(t){return t.isTransactional}))},_getActiveForms:function(){var t=this._getAbTestsForms(),e=this._getTransactionalForms();return r.union(t,e)},_selectFormFromGroup:function(t,e){if(!t.length)return null;if(1===t.length)return t[0];if(!we.formsChanged(e,t)){var n=we.getForm(e);return r.find(t,(function(t){return t.id===n}))}var i=r.sample(t);return we.setForms(e,t),we.setForm(e,i.id),i},_setFormsAsync:function(){var t=this;return sc(this._data.forms,(function(e){var n=new oc(r.extend({},e,{accountFrequency:t._data.frequency}),t._data.integrations||[],t);return n.isReadyPromise.then((function(){n.setTemplate(t.getTemplate(n.template_id)),n.setButtonTemplate(t.getButtonTemplate(n.button_template_id)),n.pushToHistory()})),n})).then((function(t){return Promise.all(t.map((function(t){return t.isReadyPromise}))).then((function(){return t}))})).then((function(e){t.formsMap=r.indexBy(e,"id");var n=r.groupBy(e,(function(t){return t.getTestGroupId()}));return r.map(n,t._selectFormFromGroup).filter(r.isObject)})).then((function(e){t.forms=e,t.allFormIds=r.pluck(e,"id"),e.forEach((function(t){t.setInSplitTest(!0);var e=t.test_group?t.test_group.conditions_splits:t.settings.conditions_splits;if(we.conditionsSplitsChanged(t.id,e)){var n=r.sample(e);n&&we.setConditionsSplit(t.id,n.id)}t.setConditions(we.getConditionsSplit(t.id))}))})).then((function(){var e=t._getActiveForms();return r.difference(t.forms,e).forEach((function(t){return t.setControlGroup(!0)})),window.PopMechanic.initReadyTs=ln.getTabVisibilityDuration(),sc(t.forms,(function(e){e.checkTargeting(t.onTargetingChange)}))})).then((function(){t.pluginData=r.map(t.formsMap,(function(t){return{id:t.id,name:t.name,isEmbedded:t.isEmbedded()||t.isStatic(),testGroup:{id:t.getTestGroupId(),name:t.test_group?t.test_group.name:""},inSplitTest:!!t.inSplitTest,inTargeting:t.inTargeting}}))}))},getTemplate:function(t){return r.find(this._data.templates,(function(e){return e.id===t}))||{}},getButtonTemplate:function(t){return r.find(this._data.button_templates,(function(e){return e.id===t}))||{}},destroy:function(){return this.unloadReporter.destroy()}}),pc=window.PopMechanic,hc=null,mc=null,gc={},vc=!0;window.PopMechanic.sbjs=Se,window.PopMechanic.$=O,window.PopMechanic._=r,window.PopMechanic.Promise=Promise;try{Ie()}catch(t){}function _c(t){var e,n,r=t.config,i=t.deviceUUID;Oe.log("initial config",r),vc=!0,window.PopMechanic.initAt=Date.now(),window.PopMechanic.initReadyTs=0,window.PopMechanic.targetingReadyTs=0,i&&(window.PopMechanic.customs=window.PopMechanic.customs||{},window.PopMechanic.customs.mindboxDeviceUUID=i,window.PopMechanic.mindboxDeviceUUID=i),n={url:location.href,ts:Date.now(),vst:Se.get.udata.vst},Be.push(n).then((function(t){if(!t)return Promise.reject();fn().then((function(e){return e?Be.enrich(t,{pagetype:e.type,product:e.product,category:e.category}):Promise.reject()})).then((function(){return Sr()}),(function(){return Sr()})),fr().then((function(e){return e?Be.enrich(t,{productItem:gr(e),categoryIds:e.category?e.category.ids:null}):Promise.reject()})).then((function(){return kr()}),(function(){return kr()}))})).catch((function(t){Sr(),kr(),Oe.log(t)})),e=new dc({data:r,deviceUUID:i,onTargetingChange:function(t,n){e.formsReady.then((function(){if(n&&!gc[t.id]){var e=ys.init(t);e&&(gc[t.id]=e)}if(window.PopMechanic.targetingReadyTs=ln.getTabVisibilityDuration(),window.PopMechanic.debugMode)try{window.postMessage({source:Bt.CSS_PREFIX+"script",type:"SET_IN_TARGETING",data:{clientId:window.PopMechanic.client,formId:t.id,inTargeting:n}},"*")}catch(t){}}))}}),window.PopMechanic.initModel=e,e.formsReady.then((function(){yi({type:"pageview",url:location.href}),Ue("lead",(function(t,e){try{window.PopMechanic.onContactsSent(e.lead)}catch(t){}})),window.PopMechanic.show=function(t,n){var r=e.formsMap[t];if(!r||r.isEmbedded()||r.isStatic())return!1;var i=gc[r.id];if(!i){if(!(i=new ds(e.formsMap[t],e.formsMap[t].template.behaviors)))return!1;gc[r.id]=i}var o=i.form.getLeadType();return!(we.isContactsSent(o)&&!n)&&(i.show(!0),i)},window.PopMechanic.getModel=function(t){return e.formsMap[t]},window.PopMechanic.getView=function(t){return gc[t]},window.PopMechanic.embed=function(t,n){if(void 0===n&&(n={}),e.formsMap[t]){var r="string"==typeof n?{selector:n}:n;r.selector&&(e.formsMap[t].selector=r.selector,e.formsMap[t].embed_selector=!0);var i=ys.init(e.formsMap[t]);r.force&&i.show(!0)}},window.PopMechanic.watchHash?(hc=window.location.href,mc=setInterval(wc,300)):!1!==window.PopMechanic.watchLocation&&(hc=window.location.pathname,mc=setInterval(yc,300)),e.forms.forEach((function(t){if(!gc[t.id]){var e=ys.init(t);e&&(gc[t.id]=e)}})),pc.isTesting&&r.forms.forEach((function(t){t.container_id||window.PopMechanic.show(t.id,!0)})),window.PopMechanic.loaded=!0,window.PopMechanic.onLoad&&"function"==typeof window.PopMechanic.onLoad&&window.PopMechanic.onLoad();try{window.postMessage({source:Bt.CSS_PREFIX+"script",type:"SET_LOADED",data:{clientId:window.PopMechanic.client,forms:e.pluginData}},"*")}catch(t){}O("html").addClass(Bt.CSS_PREFIX+"loaded"),vc=!1}))}function yc(){var t=window.location.pathname;t!==hc&&(hc=t,window.PopMechanic.update())}function wc(){var t=window.location.href;t!==hc&&(hc=t,window.PopMechanic.update())}function bc(){He("destroy"),r.forEach(gc,(function(t){t&&"function"==typeof t.destroy&&t.destroy()})),gc={},Ve("lead"),Ve("formShow"),Ve("formClose"),Ve("targeting"),window.PopMechanic.initModel.destroy(),window.PopMechanic.loaded=!1,window.PopMechanic.sampleSent=!1,clearInterval(mc),O("#"+Bt.CSS_PREFIX+"snippet").html(""),O("[data-popmechanic-embed]").html(""),O("html").removeClass(Bt.CSS_PREFIX+"loaded"),re(),window.PopMechanic.restartWatchdog()}Se.init({prefix:"popmechanic_"}),O.ajaxSettings.xhrFields={withCredentials:!!pc.formHash},O.ajaxSettings.global=!1,ln.getSettings().then(_c),window.PopMechanic.update=function(){vc||(vc=!0,bc(),window.PopMechanic.initStartedAt=Date.now(),ln.resetTabVisibilityDuration(),ls=!1,Se.init({prefix:"popmechanic_"}),ln.getSettings(!1).then(_c))},window.PopMechanic.destroy=bc,window.addEventListener("message",(function(t){t.source===window&&t.data&&"popmechanic-extension"===t.data.source&&"SHOW"===t.data.type&&window.PopMechanic.show(t.data.id,!0)}))}();
